<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE queries [
	<!ELEMENT queries (query*)>
	<!ELEMENT query (use-case+,description,paginacao?,command+,projecao?,ordenacoes?)>
	<!ELEMENT use-case    (#PCDATA)>
	<!ELEMENT description (#PCDATA)>
	<!ELEMENT command     (#PCDATA)>
	<!ELEMENT parametros  (#PCDATA)>
	<!ELEMENT projecao  (#PCDATA)>
	<!ELEMENT paginar  (#PCDATA)>
	<!ELEMENT paginacao (#PCDATA)>
	<!ELEMENT colunaCodigo    (#PCDATA)>
	<!ELEMENT colunaDescricao    (#PCDATA)>
	<!ELEMENT numeroOcorrenciasPorPagina    (#PCDATA)>
	<!ELEMENT primeiraCondicao    (#PCDATA)>
	<!ELEMENT ascendente    (#PCDATA)>
	<!ELEMENT ordenacoes (ordenacao+)>
	<!ELEMENT ordenacao (#PCDATA)>
	<!ELEMENT sql  (#PCDATA)>
	<!ATTLIST ordenacao chave CDATA    #REQUIRED>
	<!ATTLIST ordenacao default CDATA    #IMPLIED>
	<!ATTLIST command parametros CDATA    #IMPLIED>
	<!ATTLIST command paginar CDATA    #IMPLIED>
	<!ATTLIST use-case name CDATA    #REQUIRED>
	<!ATTLIST query name CDATA    #REQUIRED>
	<!ATTLIST paginacao colunaCodigo CDATA    #REQUIRED>
	<!ATTLIST paginacao colunaDescricao CDATA    #REQUIRED>
	<!ATTLIST paginacao numeroOcorrenciasPorPagina CDATA    #REQUIRED>
	<!ATTLIST paginacao primeiraCondicao CDATA    #REQUIRED>
	<!ATTLIST paginacao ascendente CDATA    #REQUIRED>
	<!ATTLIST paginacao hint CDATA    #REQUIRED>
	<!ATTLIST paginacao hintAuxiliar CDATA   #IMPLIED>
]>

  <queries>
	<query name="PESQUISAR_TIPO_ATUALIZACAO_RENOVACAO">
		<use-case name="Manter tipo de atualizacao renovacao" />
		<description>Pesquisa os tipos de atualizacao renovacao</description>
		<command>
		<![CDATA[
		
			FROM br.com.sicoob.capes.negocio.entidades.TipoAtualizacaoRenovacao tipoAtualizacaoRenovacao
			WHERE 1 = 1
				<j:if test="${criterios.filtro.ativo != null}">
                	AND tipoAtualizacaoRenovacao.ativo = <bancoob:valorOql valor="${criterios.filtro.ativo}" tipo="Boolean" />
				</j:if>
				<j:if test="${criterios.filtro.codigo != null}">
                	AND tipoAtualizacaoRenovacao.codigo = <bancoob:valorOql valor="${criterios.filtro.codigo}" tipo="Short" />
				</j:if>
				<j:if test="${criterios.filtro.descricao != null}">
                	AND tipoAtualizacaoRenovacao.descricao LIKE <bancoob:valorOql valor="${criterios.filtro.descricao}" tipo="LikeDireita" />
				</j:if>
		]]>
		</command>
		<ordenacoes>
			<ordenacao chave="codigo" default="true">
				<![CDATA[ORDER BY codigo]]>
			</ordenacao>
			<ordenacao chave="descricao" default="false">
				<![CDATA[ORDER BY descricao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="CONSULTA_PESSOA_POR_DOCUMENTO">
		<use-case name="Pesquisar pessoa"></use-case>
		<description>Pesquisa de pessoa por documento</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.Pessoa p
   			WHERE p.cpfCnpj = <bancoob:valorOql valor="${documento}" tipo="String" />
			]]>
		</command>
	</query>

	<query name="CONSULTA_PESSOA_COMPARTILHADA_POR_DOCUMENTO">
		<use-case name="Pesquisar pessoa"></use-case>
		<description>Pesquisa de pessoa por documento</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.vigente.PessoaCompartilhamento p
   			WHERE 
                p.pessoa.cpfCnpj = <bancoob:valorOql valor="${documento}" tipo="String" />
            <j:if test="${codCompartilhamentoCadastro != null}">
   			AND p.compartilhamento.codigo = <bancoob:valorOql valor="${codCompartilhamentoCadastro}" tipo="Short" /> 
            </j:if>
			]]>
		</command>
	</query>

	<query name="PESQUISAR_PESSOA">
		<use-case name="Manter pessoa."></use-case>
		<description>Pesquisa as pessoas</description>
		<command>
			<![CDATA[
			SELECT pc
			FROM br.com.sicoob.capes.negocio.entidades.vigente.PessoaCompartilhamento pc 
			inner join pc.transicoes transicoes
			WHERE 1 = 1
			<j:if test="${criterios.tipoProcura == 'POR NOME'}">
				AND pc.nomePessoa like <bancoob:valorOql valor="${criterios.procurarPor}"  tipo="LikeDireita" />
			</j:if>
			<j:if test="${criterios.tipoProcura == 'POR CPF/CNPJ'}">
				AND pc.pessoa.cpfCnpj = <bancoob:valorOql valor="${criterios.procurarPor}" tipo="String" />
			</j:if>
			<j:if test="${criterios.tipoProcura == 'POR APELIDO'}">
				AND pc.nomeApelido like <bancoob:valorOql valor="${criterios.procurarPor}"  tipo="LikeDireita" />
			</j:if>
			<j:if test="${criterios.filtro != null and criterios.filtro.idInstituicao != null}">
				AND transicoes.instituicao.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.idInstituicao}" tipo="Integer" />			
			</j:if>
			]]>
		</command>
		<ordenacoes>
			<ordenacao chave="nomePessoa" default="true">
				<![CDATA[order by nomePessoa]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISA_OBSERVACAO_ANOTACAO">
		<use-case name="Pesquisar observação anotação."></use-case>
		<description>Pesquisar observação anotação</description>
		<command>
      <![CDATA[
      SELECT to
      FROM br.com.sicoob.capes.negocio.entidades.ObservacaoAnotacao to
      WHERE 1 = 1
      <j:if test="${criterios.filtro.tipoObservacaoAnotacao != null and criterios.filtro.tipoObservacaoAnotacao.codigo != null}">
          AND to.tipoObservacaoAnotacao.codigo = <bancoob:valorOql valor="${criterios.filtro.tipoObservacaoAnotacao.codigo}" tipo="Short" />
      </j:if>
      ]]>
		</command>
		<ordenacoes>
			<ordenacao chave="descricao" default="true">
        <![CDATA[order by descricao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISAR_PESSOA_NUMERO_REGISTROS">
		<use-case name="Manter pessoa."></use-case>
		<description>Pesquisa as pessoas por instituicao </description>
		<command>
			<![CDATA[
			SELECT count(*)
			FROM br.com.sicoob.capes.negocio.entidades.vigente.PessoaCompartilhamento p 
			inner join p.transicoes transicoes
			WHERE 1 = 1
			<j:if test="${criterios.tipoProcura == 'POR NOME'}">
				AND p.nomePessoa like <bancoob:valorOql valor="${criterios.procurarPor}"  tipo="LikeDireita" />
			</j:if>
			<j:if test="${criterios.tipoProcura == 'POR CPF/CNPJ'}">
				AND p.pessoa.cpfCnpj = <bancoob:valorOql valor="${criterios.procurarPor}" tipo="String" />
			</j:if>
			<j:if test="${criterios.tipoProcura == 'POR APELIDO'}">
				AND p.nomeApelido like <bancoob:valorOql valor="${criterios.procurarPor}"  tipo="LikeDireita" />
			</j:if>					
			<j:if test="${criterios.filtro != null and criterios.filtro.idInstituicao != null}">
				AND transicoes.instituicao.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.idInstituicao}" tipo="Integer" />			
			</j:if>					
			]]>
		</command>
	</query>

	<query name="LISTAR_PESSOA_POR_NOME_PESSOA_INSTITUICAO">
		<use-case name="Manter pessoa."></use-case>
		<description>Pesquisa as pessoas</description>
		<command>
			<![CDATA[
			SELECT pessoa
			FROM br.com.sicoob.capes.negocio.entidades.Pessoa pessoa 
			inner join pessoa.transicoes transicoes
			WHERE 1 = 1

			<j:if test="${criterios.procurarPor != null and criterios.procurarPor != ''}">
				AND pessoa.nomePessoa like <bancoob:valorOql valor="${criterios.procurarPor}"  tipo="LikeDireita" />
			</j:if>
			<j:if test="${criterios.filtro.idInstituicao != null}">
				AND transicoes.instituicao.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.idInstituicao}" tipo="Integer" />			
			</j:if>					
			<j:if test="${criterios.filtro.idUnidadeInst != null}">
				AND transicoes.instituicao.idUnidadeInst = <bancoob:valorOql valor="${criterios.filtro.idUnidadeInst}" tipo="Integer" />			
			</j:if>		
			]]>
		</command>
		<ordenacoes>
			<ordenacao chave="nomePessoa" default="true">
				<![CDATA[order by nomePessoa]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISAR_TIPO_FORMA_CONSTITUICAO_ESFERAADM_POR_FILTRO">
		<use-case name="Consultar tipos de formas constituição esfera"></use-case>
		<description>Pesquisa as anotações por filtro</description>
		<command>
      <![CDATA[
      FROM br.com.sicoob.capes.negocio.entidades.TipoFormaConstituicaoEsferaAdministrativa entidade
        WHERE 1 = 1
        <j:if test="${criterios.filtro.id.codigoEsferaAdministrativa != null}">
            AND entidade.id.codigoEsferaAdministrativa = <bancoob:valorOql valor="${criterios.filtro.id.codigoEsferaAdministrativa}" tipo="Short" />
        </j:if>
      
        <j:if test="${criterios.filtro.id.codigoTipoFormaConstituicao != null}">
        	AND entidade.id.codigoTipoFormaConstituicao = <bancoob:valorOql valor="${criterios.filtro.id.codigoTipoFormaConstituicao}" tipo="Short" />
        </j:if>
      ]]>
		</command>
		<ordenacoes>
			<ordenacao chave="padrao" default="true">
        <![CDATA[order by entidade.id.codigoTipoFormaConstituicao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISA_ANOTACOES_POR_FILTRO">
		<use-case name="Manter anotações"></use-case>
		<description>Pesquisa as anotações por filtro</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.Anotacao anotacao
   			WHERE 1 = 1
   			<j:if test="${criterios.filtro.pessoaCompartilhamento != null and criterios.filtro.pessoaCompartilhamento.idPessoaCompartilhamento != null}">
   				AND	anotacao.pessoaCompartilhamento.idPessoaCompartilhamento = <bancoob:valorOql valor="${criterios.filtro.pessoaCompartilhamento.idPessoaCompartilhamento}" tipo="Long" />
			</j:if>
   			<j:if test="${criterios.filtro.origemInformacao != null and criterios.filtro.origemInformacao.idOrigemInfo != null}">
				AND anotacao.origemInformacao.idOrigemInfo = <bancoob:valorOql valor="${criterios.filtro.origemInformacao.idOrigemInfo}" tipo="Short" />
			</j:if>
  			<j:if test="${criterios.anotacoesBaixadas != null and criterios.anotacoesBaixadas}">
				AND anotacao.dataHoraBaixa != null
			</j:if>
  			<j:if test="${criterios.anotacoesBaixadas != null and not criterios.anotacoesBaixadas}">
				AND anotacao.dataHoraBaixa = null
			</j:if>	
			<j:if test="${criterios.filtro.tipoAnotacao != null and criterios.filtro.tipoAnotacao.codTipoAnotacao != null}">
				AND anotacao.tipoAnotacao.codTipoAnotacao = <bancoob:valorOql valor="${criterios.filtro.tipoAnotacao.codTipoAnotacao}" tipo="Integer" />
			</j:if>
			]]>
		</command>
		<ordenacoes>
			<ordenacao chave="padrao" default="true">
				<![CDATA[order by anotacao.dataHoraBaixa desc, 
							anotacao.origemInformacao.descOrigemInfo asc, 
							anotacao.tipoAnotacao.codTipoAnotacao]]>
			</ordenacao>
			<ordenacao chave="nome" default="false">
				<![CDATA[order by anotacao.pessoaCompartilhamento.nomePessoa]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISA_RELATORIO_ANOTACOES">
		<use-case name="Relatório de anotações"></use-case>
		<description>Pesquisa as anotações para geração de relatório
		</description>
		<command>
			<![CDATA[
			SELECT anotacao
			FROM br.com.sicoob.capes.negocio.entidades.Anotacao anotacao
			INNER JOIN anotacao.pessoaCompartilhamento pessoaCompartilhamento
		<j:if test="${criterios.idInstituicaoPessoa != null}">
			INNER JOIN pessoaCompartilhamento.transicoes transicao
		</j:if>
   			WHERE pessoaCompartilhamento.compartilhamento.codigo = <bancoob:valorOql valor="${criterios.codigoCompartilhamento}" tipo="Short" />
		<j:if test="${criterios.anotacoesBaixadas != null and criterios.anotacoesBaixadas}">
			AND anotacao.dataHoraBaixa != null
		</j:if>
		<j:if test="${criterios.anotacoesBaixadas != null and not criterios.anotacoesBaixadas}">
			AND anotacao.dataHoraBaixa = null
		</j:if>	
		<j:if test="${criterios.filtro.pessoaCompartilhamento.pessoa.tipoPessoa != null and criterios.filtro.pessoaCompartilhamento.pessoa.tipoPessoa.codTipoPessoa != null}">
			AND pessoaCompartilhamento.pessoa.tipoPessoa.codTipoPessoa = <bancoob:valorOql valor="${criterios.filtro.pessoaCompartilhamento.pessoa.tipoPessoa.codTipoPessoa}" tipo="Short" />
		</j:if>					
		<j:if test="${criterios.filtro.pessoaCompartilhamento.pessoa.cpfCnpj != null and not empty criterios.filtro.pessoaCompartilhamento.pessoa.cpfCnpj}">
			AND pessoaCompartilhamento.pessoa.cpfCnpj = <bancoob:valorOql valor="${criterios.filtro.pessoaCompartilhamento.pessoa.cpfCnpj}" tipo="String" />
		</j:if>					
		<j:if test="${criterios.filtro.tipoAnotacao != null}">
			AND anotacao.tipoAnotacao.codTipoAnotacao = <bancoob:valorOql valor="${criterios.filtro.tipoAnotacao.codTipoAnotacao}" tipo="Integer" />
		</j:if>					
		<j:if test="${criterios.dataInicio != null}">
			AND anotacao.dataHoraAnotacao &gt;= <bancoob:valorOql valor="${criterios.dataInicio}" tipo="Date" />
		</j:if>					
		<j:if test="${criterios.dataFim != null}">
			AND anotacao.dataHoraAnotacao &lt;= <bancoob:valorOql valor="${criterios.dataFim}" tipo="Date" />
		</j:if>
		<j:if test="${criterios.idInstituicaoPessoa != null}">
			AND transicao.instituicao.idInstituicao = <bancoob:valorOql valor="${criterios.idInstituicaoPessoa}" tipo="Integer" />
		</j:if>
			order by pessoaCompartilhamento.nomePessoa asc, anotacao.dataHoraOcorrencia
			]]>
		</command>
	</query>

	<query name="LISTAR_ANOTACOES_SISBR_ATIVAS_POR_FILTRO">
		<use-case name="Manter anotações"></use-case>
		<description>Pesquisa as anotações do sisbr por filtro</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.AnotacaoSisbr anotacao
			WHERE anotacao.pessoaCompartilhamento.idPessoaCompartilhamento = <bancoob:valorOql valor="${criterios.filtro.pessoaCompartilhamento.idPessoaCompartilhamento}" tipo="Long" />   			
			AND anotacao.dataHoraBaixa = null
			AND anotacao.origemInformacao.idOrigemInfo = <bancoob:valorOql valor="${criterios.filtro.origemInformacao.idOrigemInfo}" tipo="Short" />
			<j:if test="${criterios.filtro.tipoAnotacao != null}">
				AND anotacao.tipoAnotacao.codTipoAnotacao = <bancoob:valorOql valor="${criterios.filtro.tipoAnotacao.codTipoAnotacao}" tipo="Integer" />
			</j:if>		
			<j:if test="${criterios.filtro.instituicaoModalidadeProduto != null and criterios.filtro.instituicaoModalidadeProduto.idInstituicao != null}">
				AND anotacao.instituicaoModalidadeProduto.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.instituicaoModalidadeProduto.idInstituicao}" tipo="Integer" />
			</j:if>
			<j:if test="${criterios.filtro.idProduto != null}">
				AND anotacao.idProduto = <bancoob:valorOql valor="${criterios.filtro.idProduto}" tipo="Integer" />
			</j:if>
			<j:if test="${criterios.filtro.idModalidadeProduto != null}">
				AND anotacao.idModalidadeProduto = <bancoob:valorOql valor="${criterios.filtro.idModalidadeProduto}" tipo="Integer" />
			</j:if>
			<j:if test="${criterios.filtro.numeroContrato != null}">
				AND anotacao.numeroContrato = <bancoob:valorOql valor="${criterios.filtro.numeroContrato}" tipo="String" />
			</j:if>
			<j:if test="${criterios.dataVencimento != null}">
				AND anotacao.dataVencimento = <bancoob:valorOql valor="${criterios.dataVencimento}" tipo="Date" />
			</j:if>
			]]>
		</command>
		<ordenacoes>
			<ordenacao chave="padrao" default="true">
				<![CDATA[order by anotacao.tipoAnotacao.codTipoAnotacao]]>
			</ordenacao>
		</ordenacoes>
	</query>


	<query name="PESQUISAR_TIPO_ANOTACAO">
		<use-case name="Manter tipo de anotações."></use-case>
		<description>Pesquisa os tipos de anotação</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.TipoAnotacao tipoAnotacao
			WHERE 1=1
			<j:if test="${criterios.filtro.codTipoAnotacao != null}">
				AND tipoAnotacao.codTipoAnotacao = <bancoob:valorOql valor="${criterios.filtro.codTipoAnotacao}" tipo="Integer" />
			</j:if>
			<j:if test="${criterios.filtro.descTipoAnotacao != null}">
				AND descTipoAnotacao like <bancoob:valorOql valor="${criterios.filtro.descTipoAnotacao}" tipo="LikeDireita" />
			</j:if>
			<j:if test="${criterios.filtro.categoriaAnotacao != null and criterios.filtro.categoriaAnotacao.idCategoriaAnotacao != null}">
				AND tipoAnotacao.categoriaAnotacao.idCategoriaAnotacao = <bancoob:valorOql valor="${criterios.filtro.categoriaAnotacao.idCategoriaAnotacao}" tipo="Short" />
			</j:if>
			<j:if test="${criterios.filtro.tipoCaptura != null and criterios.filtro.tipoCaptura.idTipoCaptura != null}">
				AND tipoAnotacao.tipoCaptura.idTipoCaptura = <bancoob:valorOql valor="${criterios.filtro.tipoCaptura.idTipoCaptura}" tipo="Short" />
			</j:if>
			<j:if test="${criterios.filtro.idTipoAplicacao != null}">
				AND tipoAnotacao.idTipoAplicacao = <bancoob:valorOql valor="${criterios.filtro.idTipoAplicacao}" tipo="Short" />
			</j:if>
			]]>
		</command>
		<ordenacoes>
			<ordenacao chave="codTipoAnotacao" default="true">
				<![CDATA[order by tipoAnotacao.codTipoAnotacao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISAR_TIPO_EMAIL_INCLUINDO_AMBOS">
		<use-case name="Manter tipo de e-mail" />
		<description>Pesquisa os tipos de e-mail</description>
		<command>
		<![CDATA[
		
		FROM br.com.sicoob.capes.negocio.entidades.TipoEmail tipoEmail
		WHERE 1 = 1
			<j:if test="${criterios.filtro.tipoPessoaContato != null}">
				AND tipoEmail.tipoPessoaContato.codigo in (<bancoob:valorOql valor="${criterios.filtro.tipoPessoaContato.codigo}" tipo="Short" />, 2)
			</j:if>
		]]>
		</command>
		<ordenacoes>
			<ordenacao chave="codigo" default="true">
				<![CDATA[ORDER BY codigo]]>
			</ordenacao>
			<ordenacao chave="descricao" default="false">
				<![CDATA[ORDER BY descricao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISAR_TIPO_EMAIL">
		<use-case name="Manter tipo de e-mail" />
		<description>Pesquisa os tipos de e-mail</description>
		<command>
		<![CDATA[
		
		FROM br.com.sicoob.capes.negocio.entidades.TipoEmail tipoEmail
		WHERE 1 = 1
			<j:if test="${criterios.filtro.tipoPessoaContato != null}">
				AND tipoEmail.tipoPessoaContato.codigo in (<bancoob:valorOql valor="${criterios.filtro.tipoPessoaContato.codigo}" tipo="Short" />)
			</j:if>
			<j:if test="${criterios.filtro.codigo != null}">
				AND tipoEmail.codigo = <bancoob:valorOql valor="${criterios.filtro.codigo}" tipo="Short" />
			</j:if>
			<j:if test="${criterios.filtro.descricao != null}">
				AND tipoEmail.descricao LIKE <bancoob:valorOql valor="${criterios.filtro.descricao}" tipo="LikeDireita" />
			</j:if>
		]]>
		</command>
		<ordenacoes>
			<ordenacao chave="codigo" default="true">
				<![CDATA[ORDER BY codigo]]>
			</ordenacao>
			<ordenacao chave="descricao" default="false">
				<![CDATA[ORDER BY descricao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISAR_PROXIMO_CODIGO_TIPO_EMAIL">
		<use-case name="Manter tipo de e-mail" />
		<description>Pesquisa o próximo código disponível para a tabela de
			TipoEmail
		</description>
		<command>
			<![CDATA[
			SELECT a.CODTIPOEMAIL + 1
			from cli.TIPOEMAIL a
			left join cli.TIPOEMAIL b on a.CODTIPOEMAIL + 1 = b.CODTIPOEMAIL
			where b.CODTIPOEMAIL is null
			fetch first 1 row only
			]]>
		</command>
	</query>

	<query name="PESQUISAR_TIPO_ENDERECO_INCLUINDO_AMBOS">
		<use-case name="Manter tipo de endereço" />
		<description>Pesquisa os tipos de endereço</description>
		<command>
		<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.TipoEndereco tipoEndereco
			WHERE 1=1
				<j:if test="${criterios.filtro.tipoPessoaContato != null}">
					AND tipoEndereco.tipoPessoaContato.codigo in (<bancoob:valorOql valor="${criterios.filtro.tipoPessoaContato.codigo}" tipo="Short" />, 2)
				</j:if>
		  ]]>
		</command>
		<ordenacoes>
			<ordenacao chave="codigo" default="true">
				<![CDATA[ORDER BY codigo]]>
			</ordenacao>
			<ordenacao chave="descricao" default="false">
				<![CDATA[ORDER BY descricao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISAR_TIPO_ENDERECO">
		<use-case name="Manter tipo de endereço" />
		<description>Pesquisa os tipos de endereço</description>
		<command>
		<![CDATA[
				
			FROM br.com.sicoob.capes.negocio.entidades.TipoEndereco tipoEndereco
			WHERE 1=1
				<j:if test="${criterios.filtro.tipoPessoaContato != null}">
					AND tipoEndereco.tipoPessoaContato.codigo in (<bancoob:valorOql valor="${criterios.filtro.tipoPessoaContato.codigo}" tipo="Short" />)
				</j:if>
				<j:if test="${criterios.filtro.codigo != null}">
					AND tipoEndereco.codigo = <bancoob:valorOql valor="${criterios.filtro.codigo}" tipo="Short" />
				</j:if>
				<j:if test="${criterios.filtro.descricao != null}">
					AND tipoEndereco.descricao LIKE <bancoob:valorOql valor="${criterios.filtro.descricao}" tipo="LikeDireita" />
				</j:if>
		  ]]>
		</command>
		<ordenacoes>
			<ordenacao chave="codigo" default="true">
				<![CDATA[ORDER BY codigo]]>
			</ordenacao>
			<ordenacao chave="descricao" default="false">
				<![CDATA[ORDER BY descricao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISAR_PROXIMO_CODIGO_TIPO_ENDERECO">
		<use-case name="Manter tipo de endereço" />
		<description>Pesquisa o próximo código disponível para a tabela de
			TipoEndereco
		</description>
		<command>
			<![CDATA[
			SELECT a.CODTIPOENDERECO + 1
			from cli.TIPOENDERECO a
			left join cli.TIPOENDERECO b on a.CODTIPOENDERECO + 1 = b.CODTIPOENDERECO
			where b.CODTIPOENDERECO is null
			fetch first 1 row only
			]]>
		</command>
	</query>

	<query name="PESQUISAR_NACIONALIDADE">
		<use-case name="Manter nacionalidade" />
		<description>Pesquisa os nacionalidade</description>
		<command>
      <![CDATA[
        FROM br.com.sicoob.capes.negocio.entidades.Nacionalidade nacionalidade
        WHERE 1=1
        <j:if test="${criterios.filtro.codigo != null}">
        	AND nacionalidade.codigo = <bancoob:valorOql valor="${criterios.filtro.codigo}" tipo="Short" />     
        </j:if>
        <j:if test="${criterios.filtro.descricao != null}">
        	AND nacionalidade.descricao like <bancoob:valorOql valor="${criterios.filtro.descricao}" tipo="LikeDireitaEsquerda" />     
        </j:if>
      ]]>
		</command>
		<ordenacoes>
			<ordenacao chave="codigo" default="false">
        <![CDATA[ORDER BY codigo]]>
			</ordenacao>
			<ordenacao chave="descricao" default="true">
        <![CDATA[ORDER BY descricao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISAR_PROXIMO_CODIGO_NACIONALIDADE">
		<use-case name="Manter nacionalidade" />
		<description>Pesquisa o próximo código disponível para a tabela de
			nacionalidade
		</description>
		<command>
      <![CDATA[
      SELECT a.CODNACIONALIDADE + 1
      from cli.NACIONALIDADE a
      left join cli.NACIONALIDADE b on a.CODNACIONALIDADE + 1 = b.CODNACIONALIDADE
      where b.CODNACIONALIDADE is null
      fetch first 1 row only
      ]]>
		</command>
	</query>

	<query name="PESQUISAR_TIPO_TELEFONE_INCLUINDO_AMBOS">
		<use-case name="Manter tipo de telefone" />
		<description>Pesquisa os tipos de telefone</description>
		<command>
		<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.TipoTelefone tipoTelefone
			WHERE 1 = 1
				<j:if test="${criterios.filtro.tipoPessoaContato != null}">
                	AND tipoTelefone.tipoPessoaContato.codigo in (<bancoob:valorOql valor="${criterios.filtro.tipoPessoaContato.codigo}" tipo="Short" />, 2)
				</j:if>
				<j:if test="${criterios.filtro.ativo != null}">
                	AND tipoTelefone.ativo = <bancoob:valorOql valor="${criterios.filtro.ativo}" tipo="Boolean" />
				</j:if>
		]]>
		</command>
		<ordenacoes>
			<ordenacao chave="codigo" default="true">
				<![CDATA[ORDER BY codigo]]>
			</ordenacao>
			<ordenacao chave="descricao" default="false">
				<![CDATA[ORDER BY descricao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISAR_TIPO_TELEFONE">
		<use-case name="Manter tipo de telefone" />
		<description>Pesquisa os tipos de telefone</description>
		<command>
		<![CDATA[
		
			FROM br.com.sicoob.capes.negocio.entidades.TipoTelefone tipoTelefone
			WHERE 1 = 1
				<j:if test="${criterios.filtro.tipoPessoaContato != null}">
                	AND tipoTelefone.tipoPessoaContato.codigo in (<bancoob:valorOql valor="${criterios.filtro.tipoPessoaContato.codigo}" tipo="Short" />)
				</j:if>
				<j:if test="${criterios.filtro.ativo != null}">
                	AND tipoTelefone.ativo = <bancoob:valorOql valor="${criterios.filtro.ativo}" tipo="Boolean" />
				</j:if>
				<j:if test="${criterios.filtro.codigo != null}">
                	AND tipoTelefone.codigo = <bancoob:valorOql valor="${criterios.filtro.codigo}" tipo="Short" />
				</j:if>
				<j:if test="${criterios.filtro.descricao != null}">
                	AND tipoTelefone.descricao LIKE <bancoob:valorOql valor="${criterios.filtro.descricao}" tipo="LikeDireita" />
				</j:if>

		]]>
			<!-- <j:if test="${criterios.filtro.numMinDigitos != null}"> AND tipoTelefone.numMinDigitos 
				in (<bancoob:valorOql valor="${criterios.filtro.numMinDigitos}" tipo="Short" 
				/>) </j:if> -->
		</command>
		<ordenacoes>
			<ordenacao chave="codigo" default="true">
				<![CDATA[ORDER BY codigo]]>
			</ordenacao>
			<ordenacao chave="descricao" default="false">
				<![CDATA[ORDER BY descricao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISAR_PROXIMO_CODIGO_TIPO_TELEFONE">
		<use-case name="Manter tipo de telefone" />
		<description>Pesquisa o próximo código disponível para a tabela de
			TipoTelefone
		</description>
		<command>
			<![CDATA[
			SELECT a.CODTIPOTELEFONE + 1
			from cli.TIPOTELEFONE a
			left join cli.TIPOTELEFONE b on a.CODTIPOTELEFONE + 1 = b.CODTIPOTELEFONE
			where b.CODTIPOTELEFONE is null
			fetch first 1 row only
			]]>
		</command>
	</query>

	<query name="PESQUISA_TIPO_ANOTACAO_ATIVO_POR_CAPTURA">
		<use-case name="Manter anotações."></use-case>
		<description>Pesquisa os tipos de anotação por tipo de captura
		</description>
		<command>
      <![CDATA[
        SELECT tipoAnotacao
        FROM br.com.sicoob.capes.negocio.entidades.TipoAnotacao tipoAnotacao
        INNER JOIN tipoAnotacao.tipoCaptura tipoCaptura
        LEFT JOIN tipoAnotacao.cooperativasAnotacao cooperativasAnotacao
        WHERE tipoCaptura.idTipoCaptura = <bancoob:valorOql valor="${criterios.filtro.tipoCaptura.idTipoCaptura}" tipo="Short" />
  	      AND tipoAnotacao.ativo = TRUE
  	      AND (tipoAnotacao.validaUsoAnotacao = FALSE OR cooperativasAnotacao.pk.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.instituicao.idInstituicao}" tipo="Integer" />)
  	      AND tipoAnotacao.idTipoAplicacao IN (3, <bancoob:valorOql valor="${criterios.filtro.idTipoAplicacao}" tipo="Short" />)
        ORDER BY tipoAnotacao.codTipoAnotacao ASC
      ]]>
		</command>
	</query>

	<query name="LISTAR_SUMARIO_ANOTACOES_POR_PESSOA">
		<use-case name="Manter anotações." />
		<description>Pesquisa os tipos de anotação por tipo de captura
		</description>
		<command>
      <![CDATA[
        SELECT
            O.IDORIGEMINFO,
            CASE
                WHEN TCO.DESCTIPOCONSULTAORIGEM IS NOT NULL
                THEN O.DESCORIGEMINFO
                        || '-'
                        || TCO.DESCTIPOCONSULTAORIGEM
                ELSE O.DESCORIGEMINFO
            END                                                DESCORIGEMINFO,
            COALESCE(MAX(A.DATAHORAANOTACAO), CURRENT_DATE) AS DATAULTIMA,
            CASE
                WHEN A.IDTIPOANOTACAO IS NULL
                THEN 'Não Consultado'
                WHEN (A.QTDANOTACAO > 0 OR A.VALORANOTACAO > 0) 
                THEN 'Possui Restrição'
                ELSE 'Nada Consta'
            END AS SITUACAO_ANOTACAO,
            C.IDCATEGORIAANOTACAO,
            C.DESCCATEGORIAANOTACAO,
            COALESCE(SUM(A.QTDANOTACAO), 0) AS QUANTIDADE,
            SUM(A.VALORANOTACAO)            AS VALOR
        FROM
            CLI.ANOTACAO A
        INNER JOIN
            CLI.TIPOANOTACAO TA
        ON
            A.IDTIPOANOTACAO = TA.CODTIPOANOTACAO
        AND A.IDPESSOACOMPARTILHAMENTO = <bancoob:valor valor="${idPessoaCompartilhamento}" tipo="Long" />
        AND A.DATAHORABAIXA IS NULL
        INNER JOIN
            CLI.CATEGORIAANOTACAO C
        ON
            C.IDCATEGORIAANOTACAO = TA.IDCATEGORIAANOTACAO
        LEFT JOIN
            CLI.TIPOCONSULTAORIGEM TCO
        ON
            A.CODTIPOCONSULTAORIGEM = TCO.CODTIPOCONSULTAORIGEM
        RIGHT JOIN
            CLI.ORIGEMINFO O
        ON
            O.IDORIGEMINFO = A.IDORIGEMINFO
        GROUP BY
            O.IDORIGEMINFO,
            O.DESCORIGEMINFO,
            C.IDCATEGORIAANOTACAO,
            C.DESCCATEGORIAANOTACAO,
            TCO.DESCTIPOCONSULTAORIGEM,
            TA.IDCATEGORIAANOTACAO,
            CASE
                WHEN A.IDTIPOANOTACAO IS NULL
                THEN 'Não Consultado'
                WHEN (A.QTDANOTACAO > 0 OR A.VALORANOTACAO > 0) 
                THEN 'Possui Restrição'
                ELSE 'Nada Consta'
            END
        ORDER BY
            O.DESCORIGEMINFO
      ]]>
		</command>
	</query>

	<query name="CONSULTA_TRANSICAO_PESSOA_COMPARTILHAMENTO">
		<use-case name="Manter pessoa compartilhamento."></use-case>
		<description>Pesquisa a pessoa em transição</description>
		<command>
			<![CDATA[
			SELECT pessoa
			FROM br.com.sicoob.capes.negocio.entidades.vigente.PessoaCompartilhamento pessoa
			inner join pessoa.transicoes transicoes
			WHERE 1 = 1
			<j:if test="${criterios.idPessoaLegado != null}">
				AND transicoes.idPessoaLegado = <bancoob:valorOql valor="${criterios.idPessoaLegado}" tipo="Integer" />			
			</j:if>
			<j:if test="${criterios.pessoaCompartilhamento != null}">
				AND transicoes.pessoaCompartilhamento.idPessoaCompartilhamento = <bancoob:valorOql valor="${criterios.pessoaCompartilhamento.idPessoaCompartilhamento}" tipo="Long" />			
			</j:if>
			<j:if test="${criterios.instituicao.idInstituicao != null}">
				AND transicoes.instituicao.idInstituicao = <bancoob:valorOql valor="${criterios.instituicao.idInstituicao}" tipo="Integer" />			
			</j:if>								
      ]]>
		</command>
	</query>

	<query name="CONSULTA_TRANSICAO_PESSOA_POR_FILTRO">
		<use-case name="Consumir replicação"></use-case>
		<description>Pesquisa a transição</description>
		<command>
			<![CDATA[
			SELECT transicao 
			FROM br.com.sicoob.capes.negocio.entidades.TransicaoPessoa transicao
			WHERE 1 = 1
			<j:if test="${criterios.pessoaCompartilhamento != null}">
				AND transicao.pessoaCompartilhamento.idPessoaCompartilhamento = <bancoob:valorOql valor="${criterios.pessoaCompartilhamento.idPessoaCompartilhamento}" tipo="Long" />			
			</j:if>
			<j:if test="${criterios.idPessoaLegado != null}">
				AND transicao.idPessoaLegado = <bancoob:valorOql valor="${criterios.idPessoaLegado}" tipo="Integer" />			
			</j:if>
			<j:if test="${criterios.instituicao.idInstituicao != null}">
				AND transicao.instituicao.idInstituicao = <bancoob:valorOql valor="${criterios.instituicao.idInstituicao}" tipo="Integer" />			
			</j:if>					
			<j:if test="${criterios.instituicao.idUnidadeInst != null}">
				AND transicao.instituicao.idUnidadeInst = <bancoob:valorOql valor="${criterios.instituicao.idUnidadeInst}" tipo="Integer" />			
			</j:if>							
			]]>
		</command>
	</query>

	<query name="CONSULTA_TIPO_ANOTACAO_POR_CODIGO">
		<use-case name="Lançar anotação"></use-case>
		<description>Pesquisa a transição</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.TipoAnotacao tipo
			WHERE 1 = 1
			<j:if test="${criterios.codTipoAnotacao != null}">
				AND tipo.codTipoAnotacao = <bancoob:valorOql valor="${criterios.codTipoAnotacao}" tipo="Integer" />			
			</j:if>						
			]]>
		</command>
	</query>

	<query name="CONSULTA_TIPO_AUTORIZACAO_POR_DESCRICAO">
		<use-case name="Autorizar Alterações" />
		<description>Pesquisa a transição</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.TipoAutorizacao tipo
			WHERE (1 = 1)
			<j:if test="${criterios.filtro != null}">
				AND tipo.descTipoAutorizacao LIKE <bancoob:valorOql valor="${criterios.filtro}"  tipo="LikeDireita" /> 
			</j:if>
			]]>
		</command>
		<ordenacoes>
			<ordenacao chave="descTipoAutorizacao" default="true">
				<![CDATA[order by descTipoAutorizacao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISA_REFERENCIA_POR_PESSOA">
		<use-case name="Manter Referencia" />
		<description>Recupera as referencias da pessoa</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.vigente.Referencia referencia
			WHERE referencia.pessoa.idPessoaCompartilhamento = <bancoob:valorOql valor="${criterios.filtro.pessoa.idPessoaCompartilhamento}" tipo="Long" />
			]]>
		</command>
		<projecao>SELECT referencia</projecao>
	</query>

	<query name="PESQUISA_RESPONSAVEL_CADASTRO_POR_PESSOA">
		<use-case name="AUTORIZAR CADASTRO" />
		<description>Recupera o responsavel pelo cadastro da pessoa
		</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.vigente.ResponsavelCadastro responsavelCadastro
			WHERE responsavelCadastro.pessoa.id = <bancoob:valorOql valor="${criterios.filtro.pessoa.idPessoa}" tipo="Integer" />
			]]>
		</command>
	</query>

	<query name="PESQUISAR_TRANSICAO_PESSOA">
		<use-case name="Manter instituição gestora do cadastro"></use-case>
		<description>Pesquisa as transições</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.TransicaoPessoa transicao
			WHERE transicao.pessoaCompartilhamento.idPessoaCompartilhamento = <bancoob:valorOql valor="${criterios.filtro.pessoaCompartilhamento.idPessoaCompartilhamento}" tipo="Long" />
			]]>
		</command>
	</query>

	<query name="CONSULTAR_RESPONSAVEL_CADASTRO_POR_PESSOA">
		<use-case name="AUTORIZAR CADASTRO" />
		<description>Recupera o responsavel pelo cadastro da pessoa
		</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.vigente.ResponsavelCadastro responsavelCadastro
			WHERE responsavelCadastro.idPessoaCompartilhamento = <bancoob:valorOql valor="${criterios.idPessoaCompartilhamento}" tipo="Long" />
			]]>
		</command>
	</query>

	<query name="PESQUISA_FONTE_RENDA_POR_PESSOA_COMPARTILHAMENTO">
		<use-case name="Manter fonte de renda."></use-case>
		<description>Pesquisa as fonte de rendas</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.vigente.FonteRenda fonte
			WHERE fonte.pessoaCompartilhamento.idPessoaCompartilhamento = <bancoob:valorOql valor="${criterios.filtro.pessoaCompartilhamento.idPessoaCompartilhamento}" tipo="Long" />
			]]>
		</command>
		<ordenacoes>
			<ordenacao chave="idFonteRenda" default="true">
				<![CDATA[order by idFonteRenda]]>
			</ordenacao>
		</ordenacoes>
	</query>


	<query name="PESQUISA_TIPO_FONTE_RENDA">
		<use-case name="Manter tipo de fonte de renda."></use-case>
		<description>Pesquisa os tipos de fonte de rendas</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.TipoFonteRenda tipo
			<j:if test="${criterios.filtro.codTipoPessoa != null}">
				INNER JOIN tipo.tiposPessoa tipoPessoa
				WHERE tipoPessoa.codTipoPessoa = <bancoob:valorOql valor="${criterios.filtro.codTipoPessoa}" tipo="Short" />
			</j:if>	
			]]>
		</command>
		<projecao>SELECT tipo</projecao>
		<ordenacoes>
			<ordenacao chave="padrao" default="true">
				<![CDATA[order by tipo.codigo]]>
			</ordenacao>
		</ordenacoes>
	</query>
	<query name="PESQUISAR_PROXIMO_CODIGO_TIPO_FONTE_RENDA">
		<use-case name="Manter tipo de fonte de renda" />
		<description>Pesquisa o próximo código disponível para a tabela de
			TipoFonteRenda
		</description>
		<command>
			<![CDATA[
			SELECT a.CODTIPOFONTERENDA + 1
			from cli.TIPOFONTERENDA a
			left join cli.TIPOFONTERENDA b on a.CODTIPOFONTERENDA + 1 = b.CODTIPOFONTERENDA
			where b.CODTIPOFONTERENDA is null
			fetch first 1 row only
			]]>
		</command>
	</query>

	<query name="PESQUISA_BEM_POR_PESSOA">
		<use-case name="Manter bem" />
		<description>Recupera os bens da pessoa</description>
		<command>
			<![CDATA[
			<j:if test="${criterios.procurarPor == 'POR BEM IMOVEL'}">
				FROM br.com.sicoob.capes.negocio.entidades.bemantigo.BemImovel bem
			</j:if>
			<j:if test="${criterios.procurarPor == 'POR BEM'}">
				FROM br.com.sicoob.capes.negocio.entidades.bemantigo.Bem bem
			</j:if>

			<j:if test="${criterios.tipoProcura == 'FETCH'}">
					left outer join fetch bem.bensOnus
					left outer join fetch bem.bensPosse
					left outer join fetch bem.bensRegistro
			</j:if>

			WHERE 1 = 1 
			<j:if test="${criterios.filtro != null}">
				and bem.pessoaCompartilhamento.id = <bancoob:valorOql valor="${criterios.filtro.pessoaCompartilhamento.idPessoaCompartilhamento}" tipo="Long" />
			</j:if>
			<j:if test="${criterios.filtro.codLocalizacao != null}">
				and bem.codLocalizacao = <bancoob:valorOql valor="${criterios.filtro.codLocalizacao}" tipo="String" />
			</j:if>
			]]>
		</command>
		<ordenacoes>
			<ordenacao chave="dataHoraInicio" default="true">
				<![CDATA[order by bem.dataHoraInicio]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISA_BEM_DIFERENTE_DE_IMOVEL_POR_PESSOA">
		<use-case name="Manter bem" />
		<description>Recupera os bens da pessoa</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.bemantigo.Bem bem
				
				<j:if test="${criterios.tipoProcura == 'FETCH'}">
					left outer join fetch bem.bensOnus
					left outer join fetch bem.bensPosse
					left outer join fetch bem.bensRegistro
				</j:if>
				
				WHERE 1 = 1 
			<j:if test="${criterios.filtro != null}">
				and bem.pessoaCompartilhamento.id = <bancoob:valorOql valor="${criterios.filtro.pessoaCompartilhamento.idPessoaCompartilhamento}" tipo="Long" />
			</j:if>
				and bem.subTipo.tipoBem.id != 1
			]]>
		</command>
		<ordenacoes>
			<ordenacao chave="dataHoraInicio" default="true">
				<![CDATA[order by bem.dataHoraInicio]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISA_CERTIDAO_POR_PESSOA">
		<use-case name="Manter Certidao" />
		<description>Recupera as certidoes da pessoa</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.vigente.Certidao certidao
			WHERE certidao.pessoa.idPessoaCompartilhamento = <bancoob:valorOql valor="${criterios.filtro.pessoa.idPessoaCompartilhamento}" tipo="Long" />
			]]>
		</command>
		<ordenacoes>
			<ordenacao chave="dataHoraInicio" default="true">
				<![CDATA[order by certidao.dataHoraInicio]]>
			</ordenacao>
		</ordenacoes>
	</query>


	<query name="PESQUISAR_TIPO_PESSOA_CONTATO">
		<use-case name="Manter Certidao" />
		<description>Recupera os tipo pessoa contato</description>
		<command>
      <![CDATA[
      FROM br.com.sicoob.capes.negocio.entidades.vigente.TipoPessoaContato tipoPessoaContato
      ]]>
		</command>
		<ordenacoes>
			<ordenacao chave="descricao" default="true">
        <![CDATA[order by tipoPessoaContato.descricao]]>
			</ordenacao>
		</ordenacoes>
	</query>


	<query name="PESQUISA_ENDERECO_POR_FILTROS">
		<use-case name="Manter Endereço" />
		<description>Recupera os enderecos da pessoa pelos parâmetros (CODCEP,
			DESCLOGRADOURO, DESCNUMERO, IDLOCALIDADE, NOMEBAIRRO).</description>
		<command>
    <![CDATA[
    SELECT COUNT(1) as CONTADOR
	FROM CLI.ENDERECOPESSOA E
	WHERE REPLACE(E.DESCLOGRADOURO, ' ', '') = REPLACE(<bancoob:valor valor="${descricao}" />, ' ', '')
		AND REPLACE(E.DESCNUMERO, ' ', '') = REPLACE(<bancoob:valor valor="${numero}" />, ' ', '')
		AND REPLACE(E.CODCEP, ' ', '') = REPLACE(<bancoob:valor valor="${cep}" />, ' ', '')
		AND REPLACE(E.NOMEBAIRRO, ' ', '') = REPLACE(<bancoob:valor valor="${bairro}" />, ' ', '')
		AND E.IDLOCALIDADE = <bancoob:valor valor="${idLocalidade}" />
		AND E.IDPESSOACOMPARTILHAMENTO = <bancoob:valor valor="${idPessoaCompartilhamento}" />
		<j:if test="${idEnderecoPessoa != null}">
			AND (E.IDENDERECOPESSOA != <bancoob:valor valor="${idEnderecoPessoa}" />
				AND 
				E.IDENDERECOPESSOA != (
					SELECT A.IDREGISTROANTIGO
					FROM CLI.AUTORIZACAO A
					WHERE A.IDREGISTRONOVO = E.IDENDERECOPESSOA
					AND A.DESCTIPOAUTORIZACAO = 'ENDERECO'
				)
			)
		</j:if>
     ]]>
		</command>
	</query>

	<query name="PESQUISA_ENDERECO_POR_PESSOA_COMPARTILHAMENTO">
		<use-case name="Manter Endereço" />
		<description>Recupera os enderecos da pessoa</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.vigente.Endereco endereco
			WHERE endereco.pessoaCompartilhamento.idPessoaCompartilhamento = <bancoob:valorOql valor="${criterios.filtro.pessoaCompartilhamento.idPessoaCompartilhamento}" tipo="Long" />
			<j:if test="${criterios.tipoProcura == 'VIGENTES'}">
				AND endereco.dataHoraInicio IS NOT NULL
			</j:if>
			]]>
		</command>
	</query>

	<query name="PESQUISA_TELEFONE_POR_PESSOA_COMPARTILHAMENTO">
		<use-case name="Manter Telefone" />
		<description>Recupera os telefones da pessoa</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.vigente.Telefone telefone
			WHERE telefone.pessoaCompartilhamento.idPessoaCompartilhamento = <bancoob:valorOql valor="${criterios.filtro.pessoaCompartilhamento.idPessoaCompartilhamento}" tipo="Long" />
			]]>
		</command>
	</query>

	<query name="PESQUISA_TELEFONE_POR_FILTROS">
		<use-case name="Validar Telefone" />
		<description>Recupera os telefones da pessoa</description>
		<command>
		<![CDATA[
		SELECT COUNT(1) AS CONTADOR
		FROM CLI.TELEFONEPESSOA AS TP
		WHERE	
			REPLACE(TP.NUMTELEFONE, ' ', '') = REPLACE(<bancoob:valor valor="${numTelefone}" />, ' ', '') 
			AND TP.IDPESSOACOMPARTILHAMENTO = <bancoob:valor valor="${idPessoaCompartilhamento}" />
			<j:if test="${numDDD != null}">
				AND REPLACE(TP.NUMDDD, ' ', '') = REPLACE(<bancoob:valor valor="${numDDD}" />, ' ', '')
			</j:if>
	        <j:if test="${numRamal != null}">
				AND REPLACE(TP.NUMRAMAL, ' ', '') = REPLACE(<bancoob:valor valor="${numRamal}" />, ' ', '')
			</j:if>
			<j:if test="${idTelefonePessoa != null}">
				AND TP.IDTELEFONEPESSOA != <bancoob:valor valor="${idTelefonePessoa}" />
			</j:if>
		]]>
		</command>
	</query>

	<query name="PESQUISA_EMAIL_POR_FILTROS">
		<use-case name="Validar Email" />
		<description>Verifica os emails existentes de uma pessoa</description>
		<command>
		<![CDATA[
		SELECT COUNT(1) AS CONTADOR
		FROM CLI.EMAILPESSOA EP
		WHERE REPLACE(EP.DESCEMAIL, ' ', '') = REPLACE(<bancoob:valor valor="${descEmail}" />, ' ', '')
			AND EP.IDPESSOACOMPARTILHAMENTO = <bancoob:valor valor="${idPessoaCompartilhamento}" />
			<j:if test="${idEmail != null}">
				AND EP.IDEMAILPESSOA != <bancoob:valor valor="${idEmail}" />
			</j:if>
		]]>
		</command>
	</query>

	<query name="PESQUISA_EMAIL_POR_PESSOA_COMPARTILHAMENTO">
		<use-case name="Manter Email" />
		<description>Recupera os emails da pessoa</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.vigente.Email email
			WHERE email.pessoaCompartilhamento.idPessoaCompartilhamento = <bancoob:valorOql valor="${criterios.filtro.pessoaCompartilhamento.idPessoaCompartilhamento}" tipo="Long" />
			]]>
		</command>
	</query>

	<query name="PESQUISA_EMPREENDIMENTO">
		<use-case name="Manter empreendimento" />
		<description>Recupera os empreendimentos</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.Empreendimento em
			WHERE 1=1
			
			<j:if test="${criterios.filtro != null}">
				<j:if test="${criterios.filtro.codigo != null}">
					and em.codigo = <bancoob:valorOql valor="${criterios.filtro.codigo}" tipo="Integer" />
				</j:if>
				
				<j:if test="${criterios.filtro.descricao != null}">
					AND em.descricao like '%${criterios.filtro.descricao}%'
				</j:if>
				
				<j:if test="${criterios.filtro.finalidade != null}">
					and em.finalidade.codigo = <bancoob:valorOql valor="${criterios.filtro.finalidade.codigo}" tipo="Short" />
				</j:if>
			</j:if>
			]]>
		</command>
		<projecao>SELECT em</projecao>
		<ordenacoes>
			<ordenacao chave="descricao" default="true">
				<![CDATA[order by em.descricao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISA_CIDADANIA">
		<use-case name="Cidadania" />
		<description>Recupera os empreendimentos</description>
		<command>
      <![CDATA[
      FROM br.com.sicoob.capes.negocio.entidades.Cidadania cd
      WHERE 1=1
      
      <j:if test="${idPessoaCompartilhamento != null}">
        and cd.pk.idPessoaCompartilhamento = <bancoob:valorOql valor="${idPessoaCompartilhamento}" tipo="Long" />
      </j:if>
        
      ]]>
		</command>
		<projecao>SELECT cd</projecao>
		<ordenacoes>
			<ordenacao chave="descricao" default="true">
        <![CDATA[order by cd.nacionalidade.descricao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISA_ENDERECO_FISCAL">
		<use-case name="Endereço fiscal" />
		<description>Recupera os endereços fiscais</description>
		<command>
      <![CDATA[
      FROM br.com.sicoob.capes.negocio.entidades.EnderecoFiscal ef
      WHERE 1=1
               
      <j:if test="${idPessoaCompartilhamento != null}">
        and ef.pk.idPessoaCompartilhamento = <bancoob:valorOql valor="${idPessoaCompartilhamento}" tipo="Long" />
      </j:if>
      
      ]]>
		</command>
		<projecao>SELECT em</projecao>
		<ordenacoes>
			<ordenacao chave="descricao" default="true">
        <![CDATA[order by ef.nacionalidade.descricao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISA_ID_EMPREENDIMENTO">
		<use-case name="Manter empreendimento" />
		<description>Recupera o proximo id do empreendmento</description>
		<command>
			<![CDATA[
			SELECT (MAX(em.codigo) + 1)
			FROM br.com.sicoob.capes.negocio.entidades.Empreendimento em
			WHERE em.codigo &lt; 10000000
			]]>
		</command>
	</query>

	<query name="PESQUISA_SUBTIPO_BEM_POR_FILTRO">
		<use-case name="Manter subtipo de bem" />
		<description>Recupera os subtipos de bem por filtro</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.bemantigo.SubTipoBem subTipo
				INNER JOIN subTipo.tipoBem tipoBem
			]]>
		</command>
		<projecao>SELECT subTipo</projecao>
		<ordenacoes>
			<ordenacao chave="descricao" default="true">
				<![CDATA[ORDER BY tipoBem.descricao asc, subTipo.descricao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISA_SUBTIPO_BEM_POR_TIPO">
		<use-case name="Manter Bem" />
		<description>Recupera os subtipos do tipo do bem</description>
		<command>
			<![CDATA[
			SELECT subTipo
			FROM br.com.sicoob.capes.negocio.entidades.bemantigo.SubTipoBem subTipo
			<j:if test="${criterios.filtro != null}">
			WHERE
				subTipo.codTipoBem = <bancoob:valorOql valor="${criterios.filtro.tipoBem.codigo}" tipo="Short" />
				and exists (
						SELECT sit FROM br.com.sicoob.capes.negocio.entidades.bemantigo.SituacaoBem sit
						JOIN sit.subtipos subTipoSit
						WHERE 1 = 1 
							and subTipoSit.codigo = subTipo.codigo
				) 
			</j:if>
			]]>
		</command>
		<ordenacoes>
			<ordenacao chave="descricao" default="true">
				<![CDATA[ORDER BY subTipo.tipoBem.descricao asc, subTipo.descricao]]>
			</ordenacao>
		</ordenacoes>
	</query>
	<query name="PESQUISAR_PROXIMO_CODIGO_SUBTIPO_BEM">
		<use-case name="Manter subtipo de bem" />
		<description>Pesquisa o próximo código disponível para a tabela de
			SubTipoBem
		</description>
		<command>
			<![CDATA[
			SELECT a.CODSUBTIPOBEM + 1
			from cli.SUBTIPOBEM a
			left join cli.SUBTIPOBEM b on a.CODSUBTIPOBEM + 1 = b.CODSUBTIPOBEM
			where b.CODSUBTIPOBEM is null
			fetch first 1 row only
			]]>
		</command>
	</query>

	<query name="PESQUISA_UNIDADE_MEDIDA_POR_FILTRO">
		<use-case name="Manter Bem" />
		<description>Recupera as unidades de medida</description>
		<command>
			<![CDATA[
			SELECT um
			FROM br.com.sicoob.capes.negocio.entidades.UnidadeMedida um
			WHERE 1 = 1 
			<j:if test="${criterios.filtro != null}">
				and um.codigo = <bancoob:valorOql valor="${criterios.filtro.codigo}" tipo="Short" />
			</j:if>
			order by um.descricao
			]]>
		</command>
	</query>

	<query name="PESQUISA_SITUACAO_BEM_POR_SUBTIPO">
		<use-case name="Manter Bem" />
		<description>Recupera as situacoes do subtipo</description>
		<command>
			<![CDATA[
			SELECT sit FROM br.com.sicoob.capes.negocio.entidades.bemantigo.SituacaoBem sit
			JOIN sit.subtipos subTipo
			WHERE 1 = 1 
			<j:if test="${criterios.filtro != null}">
				and subTipo.codigo = <bancoob:valorOql valor="${criterios.filtro.codigo}" tipo="Short" />
			</j:if>
			order by sit.codigo
			]]>
		</command>
	</query>

	<query name="PESQUISA_ORGAO_EMISSOR_CERTIDAO">
		<use-case name="Manter tipo de certidão" />
		<description>Pesquisa os órgãos emissores de certidões </description>
		<command>
			<![CDATA[FROM br.com.sicoob.capes.negocio.entidades.OrgaoEmissorCertidao emissor]]>
		</command>
		<ordenacoes>
			<ordenacao chave="descricao" default="true">
				<![CDATA[ORDER BY emissor.descricao]]>
			</ordenacao>
			<ordenacao chave="codigo" default="false">
				<![CDATA[ORDER BY emissor.codigo]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISA_SUB_TIPO_CERTIDAO">
		<use-case name="Manter tipo de certidão" />
		<description>Pesquisa os subtipos de certidão</description>
		<command>
			<![CDATA[FROM br.com.sicoob.capes.negocio.entidades.SubTipoCertidao subTipo]]>
		</command>
		<ordenacoes>
			<ordenacao chave="descricao" default="true">
				<![CDATA[ORDER BY subTipo.descricao]]>
			</ordenacao>
			<ordenacao chave="codigo" default="false">
				<![CDATA[ORDER BY subTipo.codigo]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISA_TIPO_PODER_RELACIONAMENTO">
		<use-case name="Manter relacionamento" />
		<description>Pesquisa os tipos de poder de relacionamento
		</description>
		<command>
			<![CDATA[FROM br.com.sicoob.capes.negocio.entidades.TipoPoderRelacionamento poder]]>
		</command>
		<ordenacoes>
			<ordenacao chave="descricao" default="true">
				<![CDATA[ORDER BY poder.descricao]]>
			</ordenacao>
			<ordenacao chave="codigo" default="false">
				<![CDATA[ORDER BY poder.codigo]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISA_TIPO_ABRANGENCIA_CERTIDAO">
		<use-case name="Manter tipo de certidão" />
		<description>Pesquisa os tipos de abrangência de certidão
		</description>
		<command>
			<![CDATA[FROM br.com.sicoob.capes.negocio.entidades.TipoAbrangenciaCertidao tipoAbrangencia]]>
		</command>
		<ordenacoes>
			<ordenacao chave="descricao" default="true">
				<![CDATA[ORDER BY tipoAbrangencia.descricao]]>
			</ordenacao>
			<ordenacao chave="codigo" default="false">
				<![CDATA[ORDER BY tipoAbrangencia.codigo]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISA_TIPO_OBJETO_CERTIDAO">
		<use-case name="Manter tipo de certidão" />
		<description>Pesquisa os tipos de objeto de certidão</description>
		<command>
			<![CDATA[FROM br.com.sicoob.capes.negocio.entidades.TipoObjetoCertidao tipoObjeto]]>
		</command>
		<ordenacoes>
			<ordenacao chave="descricao" default="true">
				<![CDATA[ORDER BY tipoObjeto.descricao]]>
			</ordenacao>
			<ordenacao chave="codigo" default="false">
				<![CDATA[ORDER BY tipoObjeto.codigo]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISA_TIPO_PRAZO_CERTIDAO">
		<use-case name="Manter tipo de certidão" />
		<description>Pesquisa os tipos de prazo de certidão</description>
		<command>
			<![CDATA[FROM br.com.sicoob.capes.negocio.entidades.TipoPrazoCertidao tipoPrazo]]>
		</command>
		<ordenacoes>
			<ordenacao chave="descricao" default="true">
				<![CDATA[ORDER BY tipoPrazo.descricao]]>
			</ordenacao>
			<ordenacao chave="codigo" default="false">
				<![CDATA[ORDER BY tipoPrazo.codigo]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISA_TIPO_CERTIDAO">
		<use-case name="Manter tipo de certidão" />
		<description>Pesquisa os tipos de </description>
		<command>
		<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.TipoCertidao tipoCertidao
			WHERE 1=1
			<j:if test="${criterios.filtro != null }">
				<j:if test="${criterios.filtro.codigo != null }">
					and tipoCertidao.codigo = <bancoob:valorOql valor="${criterios.filtro.codigo}" tipo="Short" />
				</j:if>
				<j:if test="${criterios.filtro.nome != null }">
					and tipoCertidao.nome like <bancoob:valorOql valor="${criterios.filtro.nome}" tipo="LikeDireitaEsquerda" />
				</j:if>
				<j:if test="${criterios.tipoProcura == 'COMPONENTE_PESQUISA_CODIGO' }">
					AND (tipoCertidao.dataCancelamento IS NULL or tipoCertidao.dataCancelamento &gt; CURRENT_DATE)
				</j:if>
			</j:if>
		]]>
		</command>
		<projecao>SELECT tipoCertidao</projecao>
		<ordenacoes>
			<ordenacao chave="sigla-nome" default="true">
			<![CDATA[ORDER BY tipoCertidao.sigla, tipoCertidao.nome]]>
			</ordenacao>
			<ordenacao chave="codigo" default="false">
			<![CDATA[ORDER BY tipoCertidao.codigo]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISA_PROXIMO_CODIGO_TIPO_CERTIDAO">
		<use-case name="Manter tipo de certidão" />
		<description>Pesquisa o próximo código disponível para a tabela de
			TipoCertidao
		</description>
		<command>
			<![CDATA[
			SELECT a.CODTIPOCERTIDAO + 1
			from cli.TIPOCERTIDAO a
			left join cli.TIPOCERTIDAO b on a.CODTIPOCERTIDAO + 1 = b.CODTIPOCERTIDAO
			where b.CODTIPOCERTIDAO is null
			fetch first 1 row only
			]]>
		</command>
	</query>

	<query name="PESQUISAR_RELACIONAMENTOS_CEDIDOS">
		<use-case name="Manter Relacionamento" />
		<description>Pesquisa os relacionamentos cedidos por pessoa
		</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.vigente.RelacionamentoPessoa rel
				WHERE rel.tipoRelacionamento.ativo = 1 
				AND rel.pessoa.idPessoa = <bancoob:valorOql valor="${criterios.filtro.pessoa.idPessoa}" tipo="Integer" />
				AND ((rel.tipoRelacionamento.permiteCompartilhamento = 0 AND rel.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.idInstituicao}" tipo="Integer" />) OR (rel.tipoRelacionamento.permiteCompartilhamento = 1) )
				AND rel.pessoaCompartilhamento.idPessoaCompartilhamento = <bancoob:valorOql valor="${criterios.filtro.pessoaCompartilhamento.idPessoaCompartilhamento}" tipo="Long" />
				<j:if test="${criterios.filtro.tipoRelacionamento != null and criterios.filtro.tipoRelacionamento.codigo != null}">
					AND rel.tipoRelacionamento.codigo = <bancoob:valorOql valor="${criterios.filtro.tipoRelacionamento.codigo}" tipo="Short" />
				</j:if>
				<j:if test="${criterios.filtro.tipoRelacionamento != null and criterios.filtro.tipoRelacionamento.habilitaCapitalSocial != null}">
					AND rel.tipoRelacionamento.habilitaCapitalSocial = <bancoob:valorOql valor="${criterios.filtro.tipoRelacionamento.habilitaCapitalSocial}" tipo="Boolean" />
				</j:if>
			]]>
		</command>
		<projecao>SELECT rel</projecao>
		<ordenacoes>
			<ordenacao chave="nomePessoa" default="true">
				<![CDATA[ORDER BY rel.pessoaCompartilhamento.nomePessoa]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISAR_HISTORICO_RELACIONAMENTOS_PESSOA_ESPECIFICO">
		<use-case name="Manter Relacionamento" />
		<description>Pesquisa o historico de relacionamentos cedidos por
			pessoa.</description>
		<command>
		<![CDATA[
			SELECT RE.*, P.NUMCPFCNPJ AS CPFCNPJPESSOA,
			PR.NUMCPFCNPJ AS CPFCNPJPESSOARELACIONADA,
			TR.DESCTIPORELACIONAMENTOPESSOA,
			PCR.NOMEPESSOA AS NOMEPESSOARELACIONADA, PR.CODTIPOPESSOA
			FROM CLI.HISTRELACIONAMENTOPESSOA RE
				INNER JOIN CLI.TIPORELACIONAMENTOPESSOA TR ON TR.CODTIPORELACIONAMENTOPESSOA = RE.CODTIPORELACIONAMENTOPESSOA
				INNER JOIN CLI.PESSOACOMPARTILHAMENTO PC ON RE.IDPESSOA=PC.IDPESSOA
				INNER JOIN CLI.PESSOA P ON P.IDPESSOA = RE.IDPESSOA
				INNER JOIN CLI.PESSOA PR ON PR.IDPESSOA = RE.IDPESSOARELACIONADA
				INNER JOIN CLI.PESSOACOMPARTILHAMENTO PCR ON PCR.IDPESSOA = PR.IDPESSOA
				INNER JOIN CLI.TRANSICAOPESSOA TP ON PC.IDPESSOACOMPARTILHAMENTO=TP.IDPESSOACOMPARTILHAMENTO
			WHERE
			    ((TR.BOLPERMITECOMPARTILHAMENTO = 1
			    AND RE.IDINSTITUICAO != TP.IDINSTITUICAO
			    AND RE.IDPESSOACOMPARTILHAMENTO IS NOT NULL) 
			    OR  (RE.IDINSTITUICAO = TP.IDINSTITUICAO ))
			AND TP.IDINSTITUICAO = <bancoob:valor valor="${criterios.filtro.idInstituicao}" tipo="Integer" />
			AND RE.IDPESSOA = <bancoob:valor valor="${criterios.filtro.pessoa.idPessoa}" tipo="Integer" />
			<j:if test="${criterios.data != null}">
				AND DATE(RE.DATAHORAINICIO) &gt;= <bancoob:valor valor="${criterios.data}" tipo="Date" />
			</j:if>
		]]>
		</command>
	</query>

	<query name="PESQUISAR_RELACIONAMENTOS_EXERCIDOS">
		<use-case name="Manter Relacionamento" />
		<description>Pesquisa os relacionamentos exercidos por uma pessoa
		</description>
		<command>
			<![CDATA[FROM br.com.sicoob.capes.negocio.entidades.vigente.RelacionamentoPessoa rel
			INNER JOIN rel.pessoaRelacionada pessoaRelacionada
			INNER JOIN pessoaRelacionada.compartilhamentos pessoaCompartilhamento
			INNER JOIN pessoaCompartilhamento.transicoes transicoes
			WHERE pessoaRelacionada.idPessoa = <bancoob:valorOql valor="${criterios.filtro.pessoa.idPessoa}" tipo="Integer" />
			AND ((rel.tipoRelacionamento.permiteCompartilhamento = 0 AND rel.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.idInstituicao}" tipo="Integer" />) OR (rel.tipoRelacionamento.permiteCompartilhamento = 1) )
			AND transicoes.instituicao.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.idInstituicao}" tipo="Integer" />
			AND rel.dataHoraInicio IS NOT NULL
			AND rel.tipoRelacionamento.ativo = 1
			AND rel.idInstituicaoAtualizacao IS NULL]]>
		</command>
		<projecao>SELECT rel</projecao>
		<ordenacoes>
			<ordenacao chave="nomePessoa" default="true">
				<![CDATA[ORDER BY pessoaCompartilhamento.nomePessoa]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISAR_RELACIONAMENTO_REVERSO">
		<use-case name="Manter Relacionamento" />
		<description>Recupera o relacionamento reverso de uma pessoa
		</description>
		<command>
			<![CDATA[
				SELECT rel FROM br.com.sicoob.capes.negocio.entidades.vigente.RelacionamentoPessoa rel
					INNER JOIN rel.pessoa pessoa 
					INNER JOIN rel.pessoaRelacionada pessoaRelacionada 
					INNER JOIN rel.tipoRelacionamento tipoRelacionamento
				WHERE
					pessoa.idPessoa = <bancoob:valorOql valor="${criterios.pessoaRelacionada.idPessoa}" tipo="Integer" />
					AND pessoaRelacionada.idPessoa = <bancoob:valorOql valor="${criterios.pessoa.idPessoa}" tipo="Integer" />
					AND tipoRelacionamento.codigo = <bancoob:valorOql valor="${criterios.tipoRelacionamento.relacionamentoReverso.codigo}" tipo="Short" />
					AND idInstituicao = <bancoob:valorOql valor="${criterios.idInstituicao}" tipo="Integer" />
			<j:choose>
				<j:when test="${criterios.dataHoraInicio != null}">
					AND rel.dataHoraInicio IS NOT NULL
				</j:when>
				<j:otherwise>
					AND rel.dataHoraInicio IS NULL
				</j:otherwise>
			</j:choose>
			]]>
		</command>
	</query>

	<query name="PESQUISAR_RELACIONAMENTOS_SEMELHANTES">
		<use-case name="Manter Relacionamento" />
		<description>
			<![CDATA[
				Recupera relacionamentos que possuam as mesmas pessoas, o mesmo tipo
				de relacionamento e sejam da mesma instituição
			]]>
		</description>
		<command>
			<![CDATA[
				SELECT rel 
				FROM br.com.sicoob.capes.negocio.entidades.vigente.RelacionamentoPessoa rel
					INNER JOIN rel.pessoa pessoa
					INNER JOIN rel.pessoaRelacionada pessoaRelacionada 
					INNER JOIN rel.tipoRelacionamento tipoRelacionamento
				WHERE 
					pessoa.idPessoa = <bancoob:valorOql valor="${pessoa.idPessoa}" tipo="Integer" />
					AND pessoaRelacionada.idPessoa = <bancoob:valorOql valor="${pessoaRelacionada.idPessoa}" tipo="Integer" />
					AND tipoRelacionamento.codigo = <bancoob:valorOql valor="${tipoRelacionamento.codigo}" tipo="Short" />
					AND rel.idInstituicao = <bancoob:valorOql valor="${idInstituicao}" tipo="Integer" />
			]]>
		</command>
	</query>

	<query name="PESQUISA_TIPO_RELACIONAMENTO_POR_TIPOS_PESSOA">
		<use-case name="Manter relacionamento" />
		<description>Pesquisa os tipos de relacionamento</description>
		<command>
			<![CDATA[
				SELECT DISTINCT
					tipoRelacionamento 
				FROM 
					br.com.sicoob.capes.negocio.entidades.TipoRelacionamentoPessoa tipoRelacionamento
					INNER JOIN tipoRelacionamento.tiposPessoaRelacionamento tipoPessoaRelacionamento
					INNER JOIN tipoRelacionamento.tiposPessoaRelacionada tipoPessoaRelacionada
				WHERE
					tipoRelacionamento.ativo = 1
					AND tipoPessoaRelacionamento.codTipoPessoa = <bancoob:valorOql valor="${tipoPessoaRelacionamento.codTipoPessoa}" tipo="Short" />
				<j:if test="${tipoPessoaRelacionada != null}">
					AND tipoPessoaRelacionada.codTipoPessoa = <bancoob:valorOql valor="${tipoPessoaRelacionada.codTipoPessoa}" tipo="Short" />
				</j:if>
				ORDER BY tipoRelacionamento.descricao
			]]>
		</command>
	</query>

	<query name="PESQUISA_TIPO_RELACIONAMENTO_PRODUTOS_BANCOOB">
		<use-case name="Manter relacionamento" />
		<description>Pesquisa os tipos de relacionamento para produtos bancoob
		</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.TipoRelacionamentoPessoa tipoRelacionamento
				WHERE tipoRelacionamento.habilitaProdutosBancoob = 1 AND tipoRelacionamento.ativo = 1
			]]>
		</command>
	</query>

	<query name="PESQUISA_TIPO_RELACIONAMENTO_PESSOA">
		<use-case name="Manter tipo de relacionamento" />
		<description>Pesquisa os tipos de relacionamento</description>
		<command>
		<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.TipoRelacionamentoPessoa tipoRelacionamento
			WHERE 1=1
			
			<j:if test="${criterios.filtro.codigo != null}">
				AND tipoRelacionamento.codigo = <bancoob:valorOql valor="${criterios.filtro.codigo}" tipo="Short" />
			</j:if>
		        
			<j:if test="${criterios.filtro.descricao != null}">
				AND tipoRelacionamento.descricao like <bancoob:valorOql valor="${criterios.filtro.descricao}" tipo="LikeDireita" />
			</j:if>
			]]>
		</command>
		<projecao>SELECT tipoRelacionamento</projecao>
		<ordenacoes>
			<ordenacao chave="codigo" default="true">
				<![CDATA[ORDER BY tipoRelacionamento.codigo]]>
			</ordenacao>
			<ordenacao chave="descricao" default="false">
				<![CDATA[ORDER BY tipoRelacionamento.descricao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISA_PROXIMO_CODIGO_TIPO_RELACIONAMENTO_PESSOA">
		<use-case name="Manter tipo de relacionamento" />
		<description>Pesquisa o próximo código disponível para a tabela de
			TipoRelacionamentoPessoa
		</description>
		<command>
			<![CDATA[
			SELECT a.CODTIPORELACIONAMENTOPESSOA + 1
			from cli.TIPORELACIONAMENTOPESSOA a
			left join cli.TIPORELACIONAMENTOPESSOA b on a.CODTIPORELACIONAMENTOPESSOA + 1 = b.CODTIPORELACIONAMENTOPESSOA
			where b.CODTIPORELACIONAMENTOPESSOA is null
			fetch first 1 row only
			]]>
		</command>
	</query>

	<query name="PESQUISA_TRIBUTACAO_POR_PESSOA">
		<use-case name="Manter Tributacao" />
		<description>Recupera a tributacao da pessoa</description>
		<command>
			<![CDATA[
			SELECT tributacao
			FROM br.com.sicoob.capes.negocio.entidades.vigente.Tributacao tributacao
			WHERE 1 = 1
			AND tributacao.pessoaCompartilhamento.id = <bancoob:valorOql valor="${idPessoa}" tipo="Long" />
			]]>
		</command>
	</query>

	<query name="PESQUISA_PESSOA_INSTITUICAO_POR_PESSOA">
		<use-case name="Manter dados do cliente" />
		<description>Recupera a pessoa instiuicao</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.vigente.PessoaInstituicao pi
			WHERE 1 = 1 
			<j:if test="${idPessoa != null }">
				and pi.pessoa.id = <bancoob:valorOql valor="${idPessoa}" tipo="Integer" />
			</j:if>
			<j:if test="${idInstituicao != null }">
				and pi.idInstituicao = <bancoob:valorOql valor="${idInstituicao}" tipo="Integer" />
			</j:if>
			<j:if test="${criterios.filtro != null }">
				<j:if test="${criterios.filtro.idInstituicao != null }">
					and pi.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.idInstituicao}" tipo="Integer" />
				</j:if>
				<j:if test="${criterios.filtro.idUnidadeInst != null }">
					and pi.idUnidadeInst = <bancoob:valorOql valor="${criterios.filtro.idUnidadeInst}" tipo="Integer" />
				</j:if>
				<j:if test="${criterios.filtro.funcionario != null }">
					and pi.funcionario.idFuncionario = <bancoob:valorOql valor="${criterios.filtro.funcionario.idFuncionario}" tipo="Integer" />
				</j:if>
				<j:if test="${criterios.filtro.nucleo != null }">
					and pi.nucleo.idNucleo = <bancoob:valorOql valor="${criterios.filtro.nucleo.idNucleo}" tipo="Integer" />
				</j:if>
			</j:if>
			]]>
		</command>
	</query>


	<query name="PESQUISA_PESSOA_POR_ID_PESSOAS_E_INSTITUICAO">
		<use-case name="Pesquisar pessoa por id pessoas e instituição" />
		<description>Recupera a pessoa instiuicao</description>
		<command>
      <![CDATA[
        SELECT new br.com.sicoob.capes.comum.negocio.vo.PessoaBasicaVO(p.idPessoa, p.cpfCnpj, pc.nomePessoa) 
        FROM br.com.sicoob.capes.negocio.entidades.Pessoa p,
             br.com.sicoob.capes.negocio.entidades.vigente.PessoaCompartilhamento pc,
             br.com.sicoob.capes.negocio.entidades.TransicaoPessoa tp
        WHERE 1 = 1 
        AND p.idPessoa = pc.pessoa.idPessoa
        AND pc.idPessoaCompartilhamento = tp.pessoaCompartilhamento.idPessoaCompartilhamento
        AND tp.instituicao.idInstituicao = <bancoob:valorOql valor="${idInstituicao}" tipo="Integer" />
        AND p.idPessoa IN (<bancoob:valor valor="${idPessoas}" />)
      ]]>
		</command>
	</query>

	<query name="PESQUISA_ID_PESSOA_INSTITUICAO_POR_PESSOA">
		<use-case name="Manter dados do cliente" />
		<description>Recupera a pessoa instiuicao</description>
		<command>
      <![CDATA[
            SELECT pi
            FROM br.com.sicoob.capes.negocio.entidades.vigente.PessoaInstituicao pi
			WHERE 1 = 1 
			<j:if test="${idPessoa != null }">
				and pi.pessoa.id = <bancoob:valorOql valor="${idPessoa}" tipo="Integer" />
			</j:if>
			<j:if test="${idInstituicao != null }">
				and pi.idInstituicao = <bancoob:valorOql valor="${idInstituicao}" tipo="Integer" />
			</j:if>
			<j:if test="${criterios.filtro != null }">
				<j:if test="${criterios.filtro.idInstituicao != null }">
					and pi.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.idInstituicao}" tipo="Integer" />
				</j:if>
				<j:if test="${criterios.filtro.idUnidadeInst != null }">
					and pi.idUnidadeInst = <bancoob:valorOql valor="${criterios.filtro.idUnidadeInst}" tipo="Integer" />
				</j:if>
				<j:if test="${criterios.filtro.funcionario != null }">
					and pi.funcionario.idFuncionario = <bancoob:valorOql valor="${criterios.filtro.funcionario.idFuncionario}" tipo="Integer" />
				</j:if>
				<j:if test="${criterios.filtro.nucleo != null }">
					and pi.nucleo.idNucleo = <bancoob:valorOql valor="${criterios.filtro.nucleo.idNucleo}" tipo="Integer" />
				</j:if>
			</j:if>
      ]]>
		</command>
	</query>

	<query name="PESQUISA_NUCLEO_POR_INSTITUICAO">
		<use-case name="Manter nucleos" />
		<description>Recupera o nucleo</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.Nucleo nucleo
			WHERE 1 = 1 
			<j:if test="${criterios.filtro != null }">
				and nucleo.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.idInstituicao}" tipo="Integer" />
				<j:if test="${criterios.filtro.numNucleo != null }">
					and nucleo.numNucleo = <bancoob:valorOql valor="${criterios.filtro.numNucleo}" tipo="Integer" />
				</j:if>
				<j:if test="${criterios.filtro.descricao != null }">
					and nucleo.descricao like <bancoob:valorOql valor="${criterios.filtro.descricao}" tipo="LikeDireita"/>
				</j:if>
                <j:if test="${criterios.filtro.ativo != null }">
                  and nucleo.ativo = <bancoob:valorOql valor="${criterios.filtro.ativo}" tipo="Boolean" />
                </j:if>
                
			</j:if>
			]]>
		</command>
		<ordenacoes>
			<ordenacao chave="codigo" default="true">
				<![CDATA[ORDER BY numNucleo]]>
			</ordenacao>
			<ordenacao chave="descricao" default="false">
				<![CDATA[ORDER BY descricao]]>
			</ordenacao>
		</ordenacoes>
	</query>
	<query name="PESQUISAR_PROXIMO_CODIGO_NUCLEO">
		<use-case name="Manter núcleo" />
		<description>Pesquisa o próximo número disponível para a tabela de
			Nucleo
		</description>
		<command>
		<![CDATA[
		SELECT A.NUMNUCLEO + 1
		FROM CLI.NUCLEO A
		WHERE A.IDINSTITUICAO = ${idInstituicao}
		ORDER BY A.NUMNUCLEO DESC
		FETCH FIRST 1 ROW ONLY
		]]>
		</command>
	</query>

	<query name="PESQUISA_FUNCIONARIO_POR_INSTITUICAO">
		<use-case name="Manter dados do funcionario" />
		<description>Recupera o funcionario</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.Funcionario funcionario
				INNER JOIN funcionario.pessoa pessoa
				INNER JOIN pessoa.compartilhamentos pessoaCompartilhamento			
			WHERE 1 = 1 
			<j:if test="${criterios.filtro.pessoa.idPessoa != null}">
				and funcionario.pessoa.idPessoa = <bancoob:valorOql valor="${criterios.filtro.pessoa.idPessoa}" tipo="Integer" /> 
			</j:if>
			<j:if test="${criterios.filtro.instituicao.idInstituicao != null }">
				and funcionario.instituicao.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.instituicao.idInstituicao}" tipo="Integer" />
			</j:if>
			<j:if test="${criterios.filtro.instituicao.idUnidadeInst != null }">
				and funcionario.instituicao.idUnidadeInst = <bancoob:valorOql valor="${criterios.filtro.instituicao.idUnidadeInst}" tipo="Integer" />
			</j:if>
			<j:if test="${criterios.filtro.matricula != null }">
				and funcionario.matricula = <bancoob:valorOql valor="${criterios.filtro.matricula}" tipo="String" />
			</j:if>
			<j:if test="${criterios.filtro.funcao.idFuncao != null}">
				and funcionario.funcao.idFuncao = <bancoob:valorOql valor="${criterios.filtro.funcao.idFuncao}" tipo="Short" /> 
			</j:if>
			<j:if test="${criterios.filtro.nucleo.idNucleo != null}">
				and funcionario.nucleo.idNucleo = <bancoob:valorOql valor="${criterios.filtro.nucleo.idNucleo}" tipo="Integer" /> 
			</j:if>
			]]>
		</command>
		<projecao>SELECT funcionario</projecao>
		<ordenacoes>
			<ordenacao chave="nomePessoa" default="true">
				<![CDATA[order by pessoaCompartilhamento.nomePessoa]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISA_FUNCIONARIO_ATIVO_POR_INSTITUICAO">
		<use-case name="Manter dados do cliente" />
		<description>Recupera o funcionario</description>
		<command>
			<![CDATA[
			SELECT funcionario 
			FROM br.com.sicoob.capes.negocio.entidades.Funcionario funcionario
			WHERE 1 = 1 
			<j:if test="${criterios.filtro.instituicao.idInstituicao != null }">
				and funcionario.instituicao.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.instituicao.idInstituicao}" tipo="Integer" />
			</j:if>
			<j:if test="${criterios.filtro.instituicao.idUnidadeInst != null }">
				and funcionario.instituicao.idUnidadeInst = <bancoob:valorOql valor="${criterios.filtro.instituicao.idUnidadeInst}" tipo="Integer" />
			</j:if>
			<j:if test="${criterios.filtro.funcao.idFuncao != null}">
				and funcionario.funcao.idFuncao = <bancoob:valorOql valor="${criterios.filtro.funcao.idFuncao}" tipo="Short" /> 
			</j:if>
			and funcionario.dataDesligamento is null
			]]>
		</command>
		<ordenacoes>
			<ordenacao chave="siglaDescricao" default="true">
				<![CDATA[ORDER BY funcionario.pessoa.compartilhamentos.nomePessoa]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISA_PERFIL_TARIFARIO_POR_INSTITUICAO">
		<use-case name="Manter dados do cliente" />
		<description>Recupera o perfil tarifario</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.PerfilTarifario pt
			WHERE 1 = 1 
			<j:if test="${criterios.filtro != null and criterios.filtro.pk != null and criterios.filtro.pk.idInstituicao != null}">
				and pt.pk.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.pk.idInstituicao}" tipo="Integer" />
			</j:if>
			<j:if test="${criterios.filtro != null and criterios.filtro.pk != null and criterios.filtro.pk.codPerfilTarifario != null}">
				and pt.pk.codPerfilTarifario = <bancoob:valorOql valor="${criterios.filtro.pk.codPerfilTarifario}" tipo="Integer" />
			</j:if>
			<j:if test="${criterios.filtro != null and criterios.filtro.codTipoPerfilConta != null}">
				and pt.codTipoPerfilConta = <bancoob:valorOql valor="${criterios.filtro.codTipoPerfilConta}" tipo="Short" />
			</j:if>
			<j:if test="${criterios.filtro != null and criterios.filtro.codigoTipoPerfil != null}">
				and pt.codigoTipoPerfil = <bancoob:valorOql valor="${criterios.filtro.codigoTipoPerfil}" tipo="Short" />
			</j:if>
			]]>
		</command>
		<ordenacoes>
			<ordenacao chave="siglaDescricao" default="true">
				<![CDATA[ORDER BY sigla asc, descricao]]>
			</ordenacao>
			<ordenacao chave="descricao" default="false">
				<![CDATA[ORDER BY descricao]]>
			</ordenacao>
		</ordenacoes>
	</query>
	<query name="PESQUISAR_PROXIMO_CODIGO_PERFIL_TARIFARIO">
		<use-case name="Manter perfil tarifario" />
		<description>Pesquisa o próximo número disponível para a tabela de
			perfil tarifário
		</description>
		<command>
			<![CDATA[
			SELECT a.codPerfilTarifario + 1
			from cli.PerfilTarifario a
			left join cli.PerfilTarifario b on a.codPerfilTarifario + 1 = b.codPerfilTarifario  
			<j:if test="${idInstituicao != null }">
				and a.idInstituicao = b.idInstituicao
			</j:if>
			where b.codPerfilTarifario is null
			<j:if test="${idInstituicao != null }">
				and a.idInstituicao = ${idInstituicao}
			</j:if>
			fetch first 1 row only
			]]>
		</command>
	</query>

	<query name="PESQUISA_GRUPO_ECONOMICO_POR_PESSOA">
		<use-case name="Manter dados do cliente" />
		<description>Recupera os grupos da pessoa</description>
		<command>
			<![CDATA[
			SELECT new br.com.sicoob.capes.negocio.entidades.GrupoEconomico(ge.idGrupoEconomico, ge.descricao) 
			FROM br.com.sicoob.capes.negocio.entidades.GrupoEconomico ge
			JOIN ge.integrantes i
			WHERE
			ge.dataHoraExclusao IS NULL
			AND ge.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.idInstituicao}" tipo="Integer" />
			<j:if test="${criterios.filtro.pessoa.idPessoa != null}">
				and i.pessoaInstituicao.pessoa.idPessoa = <bancoob:valorOql valor="${criterios.filtro.pessoa.idPessoa}" tipo="Integer" />
			</j:if>
			]]>
		</command>
	</query>

	<query name="VERIFICA_NOME_GRUPO_ECONOMICO">
		<use-case name="Manter Grupo Econômico"></use-case>
		<description>Verifica se já existe um grupo com o mesmo nome na
			mesma instituição
		</description>
		<command>
			<![CDATA[
				SELECT
					COUNT(g.idGrupoEconomico)
				FROM
					br.com.sicoob.capes.negocio.entidades.GrupoEconomico g
				WHERE 
					g.dataHoraExclusao IS NULL
					AND g.idInstituicao = <bancoob:valorOql valor="${grupo.idInstituicao}" tipo="Integer" />
					AND g.descricao = <bancoob:valorOql valor="${grupo.descricao}" tipo="String" />
				<j:if test="${grupo.idGrupoEconomico != null}">
					AND g.idGrupoEconomico != <bancoob:valorOql valor="${idGrupoEconomico}" tipo="Integer" /> 
				</j:if>
			]]>
		</command>
	</query>

	<query name="PESQUISAR_GRUPO_ECONOMICO_POR_FILTRO">
		<use-case name="Manter Grupo Econômico"></use-case>
		<description>Obter grupo econômico por filtro</description>
		<command>
			<![CDATA[
				FROM
					br.com.sicoob.capes.negocio.entidades.GrupoEconomico ge
				WHERE
					ge.dataHoraExclusao IS NULL
					AND ge.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.idInstituicao}" tipo="Integer" />
				<j:if test="${criterios.filtro.descricao != null}">
					AND ge.descricao like '%${criterios.filtro.descricao}%'
				</j:if>
			]]>
		</command>
		<projecao>SELECT ge</projecao>
		<ordenacoes>
			<ordenacao default="true" chave="descricao">
				<![CDATA[ORDER BY ge.descricao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISA_GRUPO_ECONOMICO_PESSOA_POR_FILTRO">
		<use-case name="Manter Grupo Econômico"></use-case>
		<description>Pesquisa por filtro</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.vigente.GrupoEconomicoPessoa integrante
				where 1=1
				<j:if test="${criterios.filtro != null}">
					<j:if test="${criterios.filtro.grupoEconomico != null}">
						AND integrante.grupoEconomico.idGrupoEconomico = <bancoob:valorOql valor="${criterios.filtro.grupoEconomico.idGrupoEconomico}" tipo="Integer" />
					</j:if>
				</j:if>
			]]>
		</command>
		<projecao>SELECT integrante</projecao>
	</query>

	<query name="PESQUISA_QUANTIDADE_GRUPO_ECONOMICO_PESSOA_POR_FILTRO">
		<use-case name="Manter Grupo Econômico"></use-case>
		<description>Pesquisa por filtro</description>
		<command>
			<![CDATA[
				SELECT COUNT(*)
				FROM br.com.sicoob.capes.negocio.entidades.vigente.GrupoEconomicoPessoa integrante
				where integrante.grupoEconomico.idGrupoEconomico = <bancoob:valorOql valor="${idGrupoEconomico}" tipo="Integer" />
			]]>
		</command>
	</query>

	<query name="PESQUISAR_INTEGRANTES_GRUPO_ECONOMICO_POR_PESSOA">
		<use-case name="Manter Grupo Econômico"></use-case>
		<description>recupera integrantes de grupos econômicos por uma lista
			de IDs de pessoas
		</description>
		<command>
			<![CDATA[
				SELECT integrante
				FROM br.com.sicoob.capes.negocio.entidades.vigente.GrupoEconomicoPessoa integrante
				INNER JOIN integrante.pessoaInstituicao pessoaInstituicao
				WHERE pessoaInstituicao.idPessoaInstituicao IN (<bancoob:valor valor="${idPessoas}"/>)
			]]>
		</command>
	</query>

	<query name="PESQUISA_MENSAGEM_POR_PESSOA">
		<use-case name="Manter mensagem" />
		<description>Recupera as mensagens da pessoa</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.Mensagem m
			WHERE m.pessoa.id = <bancoob:valorOql valor="${criterios.filtro.pessoa.idPessoa}" tipo="Integer" />
			AND m.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.idInstituicao}" tipo="Integer" />
			]]>
		</command>
	</query>

	<query name="PESQUISA_LOG_COMPARTILHAMENTO">
		<use-case name="Manter Pessoa"></use-case>
		<description>Pesquisa os logs de compartilhamento de cadastro
		</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.LogCompartilhamentoCadastro log
   			WHERE 1 = 1
   			<j:if test="${criterios.filtro.pessoaCompartilhamento != null and criterios.filtro.pessoaCompartilhamento.idPessoaCompartilhamento != null}">
   				AND	log.pessoaCompartilhamento.idPessoaCompartilhamento = <bancoob:valorOql valor="${criterios.filtro.pessoaCompartilhamento.idPessoaCompartilhamento}" tipo="Long" />
			</j:if>
   			<j:if test="${criterios.filtro.idInstituicaoDemandante != null}">
				AND log.idInstituicaoDemandante = <bancoob:valorOql valor="${criterios.filtro.idInstituicaoDemandante}" tipo="Integer" />
			</j:if>
  			<j:if test="${criterios.filtro.idUsuario != null}">
				AND log.idUsuario = <bancoob:valorOql valor="${criterios.filtro.idUsuario}" tipo="String" />
			</j:if>
  			<j:if test="${criterios.filtro.compartilhado != null}">
				AND log.compartilhado = <bancoob:valorOql valor="${criterios.filtro.compartilhado}" tipo="Boolean" />
			</j:if>
			]]>
		</command>
		<ordenacoes>
			<ordenacao chave="padrao" default="true">
				<![CDATA[order by log.dataHoraConsulta]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="CONSULTAR_ENDERECO_CORRESPONDENCIA_PESSOA">
		<use-case name="Consultar endereço de correspondencia da pessoa"></use-case>
		<description>Pesquisa de endereco de correspondencia</description>
		<command>
			<![CDATA[
			SELECT endereco
			FROM br.com.sicoob.capes.negocio.entidades.EnderecoCorrespondencia endereco
			INNER JOIN endereco.pessoaCompartilhamento pessoaCompartilhamento
			INNER JOIN pessoaCompartilhamento.transicoes transicao
   			WHERE endereco.idInstituicao = <bancoob:valorOql valor="${instituicao.idInstituicao}" tipo="Integer" />
   			AND transicao.instituicao.idInstituicao = <bancoob:valorOql valor="${instituicao.idInstituicao}" tipo="Integer" />
 			AND	endereco.pessoaCompartilhamento.idPessoaCompartilhamento = <bancoob:valorOql valor="${pessoaCompartilhamento.idPessoaCompartilhamento}" tipo="Long" />
			]]>
		</command>
	</query>

	<query name="CONSULTAR_INSTITUICOES_ENDERECO_CORRESPONDENCIA_PESSOA">
		<use-case name="Listar endereços de correspondencia da pessoa"></use-case>
		<description>Lista de instituicoes em que o endereco é de
			correspondencia
		</description>
		<command>
			<![CDATA[
			select correspondencia.idInstituicao
			FROM br.com.sicoob.capes.negocio.entidades.EnderecoCorrespondencia correspondencia
   			WHERE 
 				correspondencia.pessoaCompartilhamento.idPessoaCompartilhamento = <bancoob:valorOql valor="${endereco.pessoaCompartilhamento.idPessoaCompartilhamento}" tipo="Long" />
 				and correspondencia.endereco.idEndereco = <bancoob:valorOql valor="${endereco.idEndereco}" tipo="Long" />
			]]>
		</command>
	</query>

	<query name="PESQUISAR_PESSOA_PROXY">
		<use-case name="Manter pessoa."></use-case>
		<description>Pesquisa as pessoas</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.vigente.PessoaCompartilhamento pessoaCompartilhamento 
			INNER JOIN pessoaCompartilhamento.pessoa pessoa
			INNER JOIN pessoa.tipoPessoa tipoPessoa
			INNER JOIN pessoaCompartilhamento.transicoes transicoes
		<j:if test="${criterios.filtro != null and criterios.filtro.possuiRelacionamentoBancoob != null and criterios.filtro.possuiRelacionamentoBancoob}">
			INNER JOIN pessoaCompartilhamento.transicoes transicoes2
		</j:if>
		<j:if test="${criterios.filtro != null and criterios.filtro.isCliente != null and criterios.filtro.isCliente}">
			INNER JOIN pessoa.instituicoesNegocio pessoaInstituicao
		</j:if>
			WHERE 1 = 1
		<j:if test="${criterios.tipoProcura == 'POR NOME'}">
			AND pessoaCompartilhamento.nomePessoa like <bancoob:valorOql valor="${criterios.procurarPor}"  tipo="LikeDireita" />
		</j:if>
		<j:if test="${criterios.tipoProcura == 'POR CPF/CNPJ'}">
			AND pessoa.cpfCnpj = <bancoob:valorOql valor="${criterios.procurarPor}" tipo="String" />
		</j:if>
		<j:if test="${criterios.tipoProcura == 'POR APELIDO'}">
			AND pessoaCompartilhamento.nomeApelido like <bancoob:valorOql valor="${criterios.procurarPor}"  tipo="LikeDireita" />
		</j:if>
		<j:if test="${criterios.tipoProcura == 'POR CODIGO COMPARTILHAMENTO'}">
			AND pessoaCompartilhamento.idPessoaCompartilhamento = <bancoob:valorOql valor="${criterios.filtro.idCompartilhamento}" tipo="Long" />
		</j:if>
		<j:if test="${criterios.filtro != null and criterios.filtro.idInstituicao != null}">
			AND transicoes.instituicao.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.idInstituicao}" tipo="Integer" />
		</j:if>
		<j:if test="${criterios.filtro != null and criterios.filtro.possuiRelacionamentoBancoob != null and criterios.filtro.possuiRelacionamentoBancoob}">
			AND transicoes2.instituicao.idInstituicao = 1
		</j:if>
		<j:if test="${criterios.filtro != null and criterios.filtro.isCliente != null and criterios.filtro.isCliente and criterios.filtro != null and criterios.filtro.idInstituicao != null}">
			AND pessoaInstituicao.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.idInstituicao}" tipo="Integer" />
		</j:if>
		<j:if test="${criterios.filtro != null and criterios.filtro.codTipoPessoa != null}">
			AND tipoPessoa.codTipoPessoa = <bancoob:valorOql valor="${criterios.filtro.codTipoPessoa}" tipo="Short" />
		</j:if>
			]]>
		</command>
		<projecao>
			SELECT new br.com.sicoob.capes.comum.negocio.vo.PessoaPlataformaVO(
			tipoPessoa.codTipoPessoa, pessoa.cpfCnpj,
			tipoPessoa.descTipoPessoa,
			transicoes.instituicao.idInstituicao, pessoa.idPessoa, transicoes.idPessoaLegado,
			transicoes.instituicao.idUnidadeInst,
			pessoaCompartilhamento.nomeApelido,
			pessoaCompartilhamento.nomeCompleto,
			pessoaCompartilhamento.nomePessoa,
			pessoaCompartilhamento.idPessoaCompartilhamento,
			(select p.idPessoaInstituicao from
			br.com.sicoob.capes.negocio.entidades.vigente.PessoaInstituicao p
			WHERE p.pessoa.idPessoa = pessoa.idPessoa and p.idInstituicao =
			transicoes.instituicao.idInstituicao),
			pessoaCompartilhamento.dataInclusaoSFN,
			pessoaCompartilhamento.autorizaConsultaBacen,
			pessoaCompartilhamento.codCompartilhamentoCadastro,
			pessoaCompartilhamento.compartilhamento.utilizaGedGft,
			pessoaCompartilhamento.perfilCadastro.codigo)
		</projecao>
		<ordenacoes>
			<ordenacao chave="nomePessoa" default="true">
				<![CDATA[order by pessoaCompartilhamento.nomePessoa]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISAR_PESSOA_PROXY_RESUMIDO">
		<use-case name="Manter pessoa."></use-case>
		<description>Pesquisa as pessoas</description>
		<command>
			<![CDATA[
			SELECT
			    PC.NOMEAPELIDO                                AS NOMEAPELIDO,
			    PC.NOMECOMPLETO                               AS NOMECOMPLETO,
			    PC.NOMEPESSOA                                 AS NOMEPESSOA,
			    PC.IDPESSOACOMPARTILHAMENTO                   AS IDPESSOACOMPARTILHAMENTO,
			    TP.IDPESSOALEGADO                             AS IDPESSOALEGADO,
			    TP.IDUNIDADEINST                              AS IDUNIDADEINST,
			    P.IDPESSOA                                    AS IDPESSOA,
			    P.NUMCPFCNPJ                                  AS NUMCPFCNPJ,
			    P.CODTIPOPESSOA                           	  AS CODTIPOPESSOA,
			    CC.BOLUTILIZAGEDGFT                           AS BOLUTILIZAGEDGFT,
			    PI.IDPESSOAINSTITUICAO						  AS IDPESSOAINSTITUICAO
			FROM CLI.PESSOACOMPARTILHAMENTO PC
			INNER JOIN CLI.TRANSICAOPESSOA TP ON TP.IDPESSOACOMPARTILHAMENTO = PC.IDPESSOACOMPARTILHAMENTO
			INNER JOIN CLI.COMPARTILHAMENTOCADASTRO CC ON CC.CODCOMPARTILHAMENTOCADASTRO = PC.CODCOMPARTILHAMENTOCADASTRO	
			INNER JOIN CLI.PESSOA P ON P.IDPESSOA = PC.IDPESSOA
			LEFT JOIN CLI.PESSOAINSTITUICAO PI ON PI.IDPESSOA = P.IDPESSOA AND PI.IDINSTITUICAO = <bancoob:valor valor="${criterios.filtro.idInstituicao}" tipo="Integer" />
			WHERE TP.IDINSTITUICAO = <bancoob:valor valor="${criterios.filtro.idInstituicao}" tipo="Integer" />
			AND PC.CODCOMPARTILHAMENTOCADASTRO = <bancoob:valor valor="${criterios.filtro.codCompartilhamentoCadastro}" tipo="Short" />

			<j:if test="${criterios.tipoProcura == 'POR NOME'}">
				AND  PC.NOMEPESSOA like <bancoob:valor valor="${criterios.procurarPor}" tipo="String" />
			</j:if>
			
			<j:if test="${criterios.tipoProcura == 'POR CPF/CNPJ'}">
				AND P.NUMCPFCNPJ = <bancoob:valor valor="${criterios.procurarPor}" tipo="String" />
			</j:if>
			
			<j:if test="${criterios.tipoProcura == 'POR APELIDO'}">
				AND PC.NOMEAPELIDO like <bancoob:valor valor="${criterios.procurarPor}" tipo="String" /> 
			</j:if>
			
			ORDER BY PC.NOMEPESSOA ASC
			FETCH FIRST 51 ROWS ONLY
			]]>
		</command>
	</query>

	<query name="PESQUISAR_PRODUTIVIDADE">
		<use-case name="Manter Produtor"></use-case>
		<description>Pesquisa as produtividades</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.vigente.Produtividade produtividade
			WHERE produtividade.pessoaCompartilhamento.idPessoaCompartilhamento = <bancoob:valorOql valor="${criterios.filtro.pessoaCompartilhamento.idPessoaCompartilhamento}" tipo="Long" />
			<j:if test="${criterios.situacoes != null}">
				AND produtividade.situacao in (<bancoob:valor valor="${criterios.situacoes}"/>)			
			</j:if>
			]]>
		</command>
		<ordenacoes>
			<ordenacao chave="dataHoraInicio" default="true">
				<![CDATA[order by dataHoraInicio]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="CONSULTAR_GRUPO_COMPARTILHAMENTO_POR_INSTITUICAO">
		<use-case name="CONSULTAR GRUPO COMPARTILHAMENTO"></use-case>
		<description>Pesquisa o grupo compartilhamento</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.vigente.GrupoCompartilhamento grupo 
			WHERE grupo.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.idInstituicao}" tipo="Integer" />
			]]>
		</command>
	</query>

	<query
		name="CONSULTAR_PESSOA_COMPARTILHAMENTO_POR_PESSOA_COMPARTILHAMENTO_CADASTRO">
		<use-case name="CONSULTAR PESSOA"></use-case>
		<description>Pesquisa o grupo compartilhamento</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.vigente.PessoaCompartilhamento p 
			WHERE p.pessoa.id = <bancoob:valorOql valor="${idPessoa}" tipo="Integer" />
			AND	p.compartilhamento.id = <bancoob:valorOql valor="${codCompartilhamento}" tipo="Short" />
			]]>
		</command>
	</query>

	<query name="LISTAR_TRANSICOES_PESSOA">
		<use-case name="Alterar cpf cnpj" />
		<description>Lista todas as transições de uma pessoa</description>
		<command>
			<![CDATA[
				SELECT p.idPessoa, t.IDINSTITUICAO, t.IDUNIDADEINST, t.NOMEPESSOALEGADO, t.IDPESSOALEGADO
				FROM cli.PESSOA p
				INNER JOIN cli.PESSOACOMPARTILHAMENTO pc on pc.IDPESSOA = p.IDPESSOA
				INNER JOIN cli.TRANSICAOPESSOA t on t.IDPESSOACOMPARTILHAMENTO = pc.IDPESSOACOMPARTILHAMENTO
				WHERE p.idPessoa = <bancoob:valor valor="${idPessoa}" />
			]]>
		</command>
	</query>

	<query name="PESQUISAR_TIPO_BEM">
		<use-case name="Manter tipo de bem" />
		<description>Pesquisa os tipos de endereço</description>
		<command>
			<![CDATA[FROM br.com.sicoob.capes.negocio.entidades.bemantigo.TipoBem tipoBem]]>
		</command>
		<ordenacoes>
			<ordenacao chave="codigo" default="true">
				<![CDATA[ORDER BY codigo]]>
			</ordenacao>
			<ordenacao chave="descricao" default="false">
				<![CDATA[ORDER BY descricao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="LISTAR_TIPO_BEM_COM_SUBTIPO">
		<use-case name="Manter bens" />
		<description>Lista os tipos de bem que possuem subtipo</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.bemantigo.SubTipoBem subTipo
				INNER JOIN subTipo.tipoBem tipoBem
			]]>
		</command>
		<projecao>SELECT DISTINCT tipoBem</projecao>
		<ordenacoes>
			<ordenacao chave="descricao" default="true">
				<![CDATA[ORDER BY tipoBem.descricao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISAR_PROXIMO_CODIGO_TIPO_BEM">
		<use-case name="Manter tipo de bem" />
		<description>Pesquisa o próximo código disponível para a tabela de
			TipoBem
		</description>
		<command>
			<![CDATA[
			SELECT a.CODTIPOBEM + 1
			from cli.TIPOBEM a
			left join cli.TIPOBEM b on a.CODTIPOBEM + 1 = b.CODTIPOBEM
			where b.CODTIPOBEM is null
			fetch first 1 row only
			]]>
		</command>
	</query>

	<query name="LISTAR_GRUPOCOMPARTILHAMENTO">
		<use-case name="LISTAR GRUPOCOMPARTILHAMENTO"></use-case>
		<description>Pesquisa o grupo compartilhamento</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.vigente.GrupoCompartilhamento grupo
				INNER JOIN grupo.compartilhamentoCadastro comp
				WHERE 1 = 1
			<j:if test="${criterios.filtro.compartilhamentoCadastro.codigo != null}">
				AND comp.codigo = <bancoob:valorOql valor="${criterios.filtro.compartilhamentoCadastro.codigo}" tipo="Short" />
			</j:if>
			<j:if test="${criterios.filtro.idInstituicao != null}">
				AND grupo.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.idInstituicao}" tipo="Integer" />
			</j:if>
			]]>
		</command>
		<projecao>SELECT grupo</projecao>
		<ordenacoes>
			<ordenacao chave="compartilhamentoCadastro" default="true">
				<![CDATA[ORDER BY comp.codigo]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="CONSULTAR_INSTITUICAO_EM_TRANSICAO_PESSOA">
		<use-case name="Verificar se um instituicão existe na Transicao Pessoa"></use-case>
		<description>Verificar se um instituicão existe na Transicao Pessoa
		</description>
		<command>
			<![CDATA[
			SELECT CLI.TRANSICAOPESSOA.IDINSTITUICAO FROM CLI.TRANSICAOPESSOA  
			WHERE CLI.TRANSICAOPESSOA.IDINSTITUICAO = ${idInstituicao}  
			FETCH FIRST 1 ROWS ONLY 
			]]>
		</command>
	</query>

	<query name="PESQUISAR_PROXIMO_CODIGO_COMPARTILHAMENTO_CADASTRO">
		<use-case name="Manter Compartilhamento Cadastro" />
		<description>Pesquisa o próximo código disponível para a tabela de
			Compartilhamento Cadastro
		</description>
		<command>
			<![CDATA[			
			SELECT a.CODCOMPARTILHAMENTOCADASTRO + 1
			from CLI.COMPARTILHAMENTOCADASTRO a
			left join CLI.COMPARTILHAMENTOCADASTRO b on a.CODCOMPARTILHAMENTOCADASTRO + 1 = b.CODCOMPARTILHAMENTOCADASTRO
			where b.CODCOMPARTILHAMENTOCADASTRO is null
			fetch first 1 row only
			]]>
		</command>
	</query>

	<query name="PESQUISAR_PESSOAS_PARA_INCORPORACAO">
		<use-case name="Incorporar instituição."></use-case>
		<description>Pesquisa as pessoas</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.vigente.PessoaCompartilhamento pc 
			inner join pc.transicoes transicoes
			WHERE transicoes.instituicao.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.idInstituicao}" tipo="Integer" />	
			<j:if test="${criterios.filtro != null and criterios.filtro.idUnidadeInst != null}">		
				AND transicoes.instituicao.idUnidadeInst = <bancoob:valorOql valor="${criterios.filtro.idUnidadeInst}" tipo="Integer" />
			</j:if>		
			]]>
		</command>
		<projecao>SELECT pc</projecao>
		<ordenacoes>
			<ordenacao chave="idPessoaCompartilhamento" default="true">
				<![CDATA[order by pc.idPessoaCompartilhamento]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="OBTER_TRANSICAO_POR_PESSOA_INSTITUICAO">
		<use-case name="Dados do Cliente" />
		<description>Obtem a transição de uma pessoa em determinada
			instituição
		</description>
		<command>
			<![CDATA[
				SELECT transicao
				FROM br.com.sicoob.capes.negocio.entidades.TransicaoPessoa transicao
				INNER JOIN transicao.pessoaCompartilhamento pessoaCompartilhamento
				INNER JOIN pessoaCompartilhamento.pessoa pessoa
				WHERE transicao.instituicao.idInstituicao = <bancoob:valorOql valor="${idInstituicao}" tipo="Integer" />
				AND pessoa.idPessoa = <bancoob:valorOql valor="${idPessoa}" tipo="Integer" /> 
			]]>
		</command>
	</query>

	<query name="OBTER_TRANSICAO_POR_PESSOACOMPARTILHAMENTO_INSTITUICAO">
		<use-case name="TransicaoPessoa" />
		<description>Obtem a transição por idPessoaCompartilhamento e
			idInstituicao</description>
		<command>
			<![CDATA[
				SELECT transicao
				FROM br.com.sicoob.capes.negocio.entidades.TransicaoPessoa transicao
				INNER JOIN transicao.pessoaCompartilhamento pessoaCompartilhamento
				WHERE transicao.instituicao.idInstituicao = <bancoob:valorOql valor="${idInstituicao}" tipo="Integer" />
				AND pessoaCompartilhamento.idPessoaCompartilhamento = <bancoob:valorOql valor="${idPessoaCompartilhamento}" tipo="Long" /> 
			]]>
		</command>
	</query>

	<query name="PESQUISA_FUNCAO">
		<use-case name="Manter funcao" />
		<description>Recupera as funções</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.Funcao funcao
			]]>
		</command>
		<ordenacoes>
			<ordenacao chave="descricao" default="true">
				<![CDATA[ORDER BY descricao]]>
			</ordenacao>
			<ordenacao chave="codigo" default="false">
				<![CDATA[ORDER BY idFuncao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISAR_ENDERECOS_CORRESPONDENCIA">
		<use-case name="Consultar endereço de correspondencia da pessoa"></use-case>
		<description>Pesquisa de endereco de correspondencia</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.EnderecoCorrespondencia correspondencia
   			WHERE correspondencia.endereco.idEndereco = <bancoob:valorOql valor="${criterios.filtro.endereco.idEndereco}" tipo="Long" />
			]]>
		</command>
	</query>

	<query name="PESQUISAR_PRODUTIVIDADE_POR_IMOVEL">
		<use-case name="Consultar endereço de correspondencia da pessoa"></use-case>
		<description>Pesquisa de endereco de correspondencia</description>
		<command>
			<![CDATA[
				SELECT PC.NOMEPESSOA
				FROM CLI.PESSOAPRODUTIVIDADE PP
				INNER JOIN CLI.PESSOACOMPARTILHAMENTO PC ON PC.IDPESSOACOMPARTILHAMENTO = PP.IDPESSOACOMPARTILHAMENTO
				INNER JOIN CLI.BEMIMOVEL BI ON BI.IDBEM = PP.IDBEM
				WHERE BI.IDBEM = <bancoob:valor valor="${idBem}" tipo="Long" />
				AND PC.IDPESSOACOMPARTILHAMENTO IN (<bancoob:valor valor="${idsPessoaCompartilhamento}" />)
			]]>
		</command>
	</query>

	<query name="OBTER_DATA_ULTIMA_ATUALIZACAO_PESSOA">
		<use-case name="Relatório Ficha Cadastral" />
		<description>Obtem a data da última atualização cadastral de uma
			pessoa
		</description>
		<command>
      <![CDATA[
        SELECT
            VC.DATAHORAULTIMAATUALIZACAO
        FROM
            CLI.VALIDACAOCADASTRAL VC
        WHERE
            VC.IDPESSOACOMPARTILHAMENTO = <bancoob:valor valor="${id}" tipo="Long" />
      ]]>
		</command>
	</query>

	<query name="LISTAR_TRANSICOES_PARA_REPLICACAO">
		<use-case name="Replicação de cadastro"></use-case>
		<description>Pesquisa as transições</description>
		<command>
			<![CDATA[
				select t.IDTRANSICAOPESSOA, t.IDINSTITUICAO, t.IDUNIDADEINST, t.IDPESSOACOMPARTILHAMENTO, 
					t.IDPESSOALEGADO, t.DATAHORAINTEGRACAO, t.NOMEPESSOALEGADO
				from cli.transicaopessoa t
				where t.IDPESSOACOMPARTILHAMENTO = <bancoob:valor valor="${idPessoaCompartilhamento}" /> 
				with ur			
			]]>
		</command>
	</query>


	<query name="LISTAR_RENDAS_VENCIDAS">
		<use-case name="Manter fonte de renda."></use-case>
		<description>Pesquisa as fonte de rendas</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.vigente.FonteRenda fonte
			WHERE fonte.dataValidadeRenda &lt; <bancoob:valorOql valor="${criterios.filtro.dataValidadeRenda}" tipo="Date" />
			AND fonte.idInstituicaoAtualizacao IS NULL
			]]>
		</command>
		<ordenacoes>
			<ordenacao chave="padrao" default="true">
				<![CDATA[order by dataValidadeRenda, idFonteRenda]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="LISTAR_MENSAGENS_VENCIDAS">
		<use-case name="Manter mensagem" />
		<description>Recupera as mensagens vencidas</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.Mensagem m
			WHERE m.validade &lt; <bancoob:valorOql valor="${criterios.filtro.validade}" tipo="Date" />
			]]>
		</command>
		<ordenacoes>
			<ordenacao chave="padrao" default="true">
				<![CDATA[order by validade, idInstituicao, idMensagem]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="LISTAR_CERTIDOES_VENCIDAS">
		<use-case name="Manter Certidao" />
		<description>Recupera as certidoes da pessoa</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.vigente.Certidao certidao
			inner join certidao.tipoCertidao tipoCertidao
			inner join tipoCertidao.tipoPrazo tipoPrazo
			WHERE certidao.dataVencimento &lt; <bancoob:valorOql valor="${criterios.filtro.dataVencimento}" tipo="Date" />
			AND tipoPrazo.codigo in (0,1,2)
			AND certidao.idInstituicaoAtualizacao IS NULL
			]]>
		</command>
		<projecao>SELECT certidao</projecao>
		<ordenacoes>
			<ordenacao chave="padrao" default="true">
				<![CDATA[order by dataVencimentoCertidao, idCertidao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="OBTER_MAIOR_IDPESSOACOMPARTILHAMENTO_POR_COMPARTILHAMENTO">
		<use-case name="Carga de anotações do consultas externas"></use-case>
		<description>Pesquisa as pessoas</description>
		<command>
			<![CDATA[
			SELECT max(pc.idPessoaCompartilhamento)			
			FROM br.com.sicoob.capes.negocio.entidades.vigente.PessoaCompartilhamento pc 
			inner join pc.compartilhamento compartilhamento
			WHERE compartilhamento.codigo = <bancoob:valorOql valor="${codigoCompartilhamento}" tipo="Short" />
			]]>
		</command>
	</query>

	<query name="LISTAR_PESSOAS_POR_COMPARTILHAMENTO">
		<use-case name="Carga de anotações do consultas externas"></use-case>
		<description>Pesquisa as pessoas</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.vigente.PessoaCompartilhamento pc 
			inner join pc.compartilhamento compartilhamento
			WHERE compartilhamento.codigo = <bancoob:valorOql valor="${criterios.filtro.codigo}" tipo="Short" />
			AND pc.idPessoaCompartilhamento 
			BETWEEN <bancoob:valorOql valor="${criterios.idPessoaCompartilhamentoInicio}" tipo="Long" />
				AND <bancoob:valorOql valor="${criterios.idPessoaCompartilhamentoFim}" tipo="Long" />
			]]>
		</command>
		<projecao>SELECT pc</projecao>
		<ordenacoes>
			<ordenacao chave="idPessoaCompartilhamento" default="true">
				<![CDATA[order by pc.idPessoaCompartilhamento]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="VERIFICAR_FIM_INCORPORACAO">
		<use-case name="Incorporar instituição." />
		<description>Conta as pessoas não incorporadas</description>
		<command>
			<![CDATA[
				SELECT
				    COUNT(*)
				FROM
				    CLI.TRANSICAOPESSOA A
				WHERE
				    A.IDINSTITUICAO = <bancoob:valor valor="${idInsituicaoIncorporada}" tipo="Integer" />
				AND NOT EXISTS
				    (
				        SELECT
				            NULL
				        FROM
				            CLI.TRANSICAOPESSOA B
				        WHERE
				            B.IDPESSOACOMPARTILHAMENTO = A.IDPESSOACOMPARTILHAMENTO
				        AND B.IDINSTITUICAO = <bancoob:valor valor="${idInsituicaoIncorporadora}" tipo="Integer" />
				    )
			]]>
		</command>
	</query>

	<query name="RECUPERAR_RELACIONAMENTOS_INCORPORACAO">
		<use-case name="Incorporar instituição." />
		<description>Recupera os relacionamentos para serem incorporados
		</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.vigente.RelacionamentoPessoa A
				WHERE
				    A.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.incorporada.idInstituicao}" tipo="Integer" />
				AND NOT EXISTS
				    (
				        SELECT
				            1
				        FROM
				            br.com.sicoob.capes.negocio.entidades.vigente.RelacionamentoPessoa B
				        WHERE
				            B.pessoa.idPessoa = A.pessoa.idPessoa
				        AND B.pessoaRelacionada.idPessoa = A.pessoaRelacionada.idPessoa
				        AND B.tipoRelacionamento.codigo = A.tipoRelacionamento.codigo
				        AND B.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.incorporadora.idInstituicao}" tipo="Integer" />
				    )
			]]>
		</command>
	</query>

	<query name="PESQUISAR_LOG_INCORPORACAO_POR_FILTRO">
		<use-case name="Monitoração de Incorporações" />
		<description>Pesquisa LogIncorporacao por filtro</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.LogIncorporacao l
				WHERE 1 = 1
				<j:if test="${criterios.tipoProcura == 'DATA_SOLICITACAO'}">
				  AND l.dataHoraSolicitacao &gt;= <bancoob:valorOql valor="${criterios.filtro}" tipo="Date" />
				</j:if>
			]]>
		</command>
		<ordenacoes>
			<ordenacao chave="dataSolicitacao" default="true">
				ORDER BY l.dataHoraSolicitacao
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="BUSCAR_QTD_PESSOAS_INSTITUICAO">
		<use-case name="Alteração de Grupo de Compartilhamento" />
		<description>Obtém a quantidade de pessoas em uma instituição
		</description>
		<command>
			<![CDATA[
				SELECT COUNT(*) AS QTD
				FROM br.com.sicoob.capes.negocio.entidades.TransicaoPessoa A
				WHERE A.instituicao.idInstituicao = <bancoob:valorOql valor="${idInstituicao}" tipo="Integer" />
			]]>
		</command>
	</query>

	<query name="BUSCAR_QTDS_PESSOAS_ALTERACAO_GRUPO">
		<use-case name="Alteração de Grupo de Compartilhamento" />
		<description>Obtém a quantidade de pessoas INEXISTENTES em
			determinado grupo de compartilhamento
		</description>
		<command>
			<![CDATA[
				SELECT
				    'pessoasExistentes' AS TIPO,
				    COUNT(*)            AS QTD
				FROM
				    CLI.TRANSICAOPESSOA A,
				    CLI.PESSOACOMPARTILHAMENTO B
				WHERE
				    A.IDINSTITUICAO = <bancoob:valor valor="${idInstituicao}" tipo="Integer" />
				AND A.IDPESSOACOMPARTILHAMENTO = B.IDPESSOACOMPARTILHAMENTO
				AND EXISTS
				    (
				        SELECT
				            NULL
				        FROM
				            CLI.PESSOACOMPARTILHAMENTO C
				        WHERE
				            C.IDPESSOA = B.IDPESSOA
				        AND C.CODCOMPARTILHAMENTOCADASTRO = <bancoob:valor valor="${codigoCompartilhamento}" tipo="Short" />
				    )
				
				UNION ALL
				
				SELECT
				    'pessoasInexistentesUnicas' AS TIPO,
				    COUNT(*)                    AS QTD
				FROM
				    CLI.TRANSICAOPESSOA A,
				    CLI.PESSOACOMPARTILHAMENTO B
				WHERE
				    A.IDINSTITUICAO = <bancoob:valor valor="${idInstituicao}" tipo="Integer" />
				AND A.IDPESSOACOMPARTILHAMENTO = B.IDPESSOACOMPARTILHAMENTO
				AND NOT EXISTS
				    (
				        SELECT
				            NULL
				        FROM
				            CLI.PESSOACOMPARTILHAMENTO C
				        WHERE
				            C.IDPESSOA = B.IDPESSOA
				        AND C.CODCOMPARTILHAMENTOCADASTRO = <bancoob:valor valor="${codigoCompartilhamento}" tipo="Short" />
				    )
				AND NOT EXISTS
				    (
				        SELECT
				            NULL
				        FROM
				            CLI.TRANSICAOPESSOA C
				        WHERE
				            C.IDPESSOACOMPARTILHAMENTO = B.IDPESSOACOMPARTILHAMENTO
				        AND C.IDINSTITUICAO &lt;&gt; <bancoob:valor valor="${idInstituicao}" tipo="Integer" />
				    )
				
				UNION ALL
				
				SELECT
				    'pessoasInexistentesCompartilhadas' AS TIPO,
				    COUNT(*)                            AS QTD
				FROM
				    CLI.TRANSICAOPESSOA A,
				    CLI.PESSOACOMPARTILHAMENTO B
				WHERE
				    A.IDINSTITUICAO = <bancoob:valor valor="${idInstituicao}" tipo="Integer" />
				AND A.IDPESSOACOMPARTILHAMENTO = B.IDPESSOACOMPARTILHAMENTO
				AND NOT EXISTS
				    (
				        SELECT
				            NULL
				        FROM
				            CLI.PESSOACOMPARTILHAMENTO C
				        WHERE
				            C.IDPESSOA = B.IDPESSOA
				        AND C.CODCOMPARTILHAMENTOCADASTRO = <bancoob:valor valor="${codigoCompartilhamento}" tipo="Short" />
				    )
				AND EXISTS
				    (
				        SELECT
				            NULL
				        FROM
				            CLI.TRANSICAOPESSOA C
				        WHERE
				            C.IDPESSOACOMPARTILHAMENTO = B.IDPESSOACOMPARTILHAMENTO
				        AND C.IDINSTITUICAO &lt;&gt; <bancoob:valor valor="${idInstituicao}" tipo="Integer" />
				    )
			]]>
		</command>
	</query>

	<query name="BUSCAR_PESSOAS_EXISTENTES_GRUPO">
		<use-case name="Alteração de Grupo de Compartilhamento" />
		<description>Obtém as pessoas EXISTENTES em determinado grupo de
			compartilhamento
		</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.TransicaoPessoa A
				WHERE
				    A.instituicao.idInstituicao = <bancoob:valorOql valor="${idInstituicao}" tipo="Integer" />
				AND EXISTS
				    (
				        SELECT
				            1
				        FROM
				            br.com.sicoob.capes.negocio.entidades.vigente.PessoaCompartilhamento B,
				            br.com.sicoob.capes.negocio.entidades.vigente.PessoaCompartilhamento C
				        WHERE
				            B.idPessoaCompartilhamento = A.pessoaCompartilhamento.idPessoaCompartilhamento
				        AND B.pessoa.idPessoa = C.pessoa.idPessoa
				        AND C.codCompartilhamentoCadastro = <bancoob:valorOql valor="${codigoCompartilhamento}" tipo="Short" />
				    )
				ORDER BY A.pessoaCompartilhamento.nomePessoa
			]]>
		</command>
	</query>

	<query name="ALTERAR_GRUPO_PESSOAS_INEXISTENTES_UNICAS">
		<use-case name="Alteração de Grupo de Compartilhamento" />
		<description>Altera o grupo de compartilhamento de pessoas que ainda
			não estão no grupo
		</description>
		<command>
			<![CDATA[
				UPDATE
				    CLI.PESSOACOMPARTILHAMENTO A
				SET
				    A.CODCOMPARTILHAMENTOCADASTRO = <bancoob:valor valor="${codigoCompartilhamento}" tipo="Short" />
				WHERE
				    EXISTS
				    (
				        SELECT
				            NULL
				        FROM
				            CLI.TRANSICAOPESSOA TP
				        WHERE
				            TP.IDPESSOACOMPARTILHAMENTO = A.IDPESSOACOMPARTILHAMENTO
				        AND TP.IDINSTITUICAO = <bancoob:valor valor="${idInstituicao}" tipo="Integer" />
				    )
				AND NOT EXISTS
				    (
				        SELECT
				            NULL
				        FROM
				            CLI.TRANSICAOPESSOA TP
				        WHERE
				            TP.IDPESSOACOMPARTILHAMENTO = A.IDPESSOACOMPARTILHAMENTO
				        AND TP.IDINSTITUICAO != <bancoob:valor valor="${idInstituicao}" tipo="Integer" />
				    )
				AND NOT EXISTS
				    (
				        SELECT
				            NULL
				        FROM
				            CLI.PESSOACOMPARTILHAMENTO PC
				        WHERE
				            PC.IDPESSOA = A.IDPESSOA
				        AND PC.CODCOMPARTILHAMENTOCADASTRO = <bancoob:valor valor="${codigoCompartilhamento}" tipo="Short" />
				    )
    		]]>
		</command>
	</query>

	<query name="BUSCAR_PESSOAS_INEXISTENTES_COMPARTILHADAS">
		<use-case name="Alteração de Grupo de Compartilhamento" />
		<description>Altera o grupo de compartilhamento de pessoas que ainda
			não estão no grupo
		</description>
		<command>
			<![CDATA[
				FROM
				    br.com.sicoob.capes.negocio.entidades.vigente.PessoaCompartilhamento A
				WHERE
					A.transicoes.instituicao.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.instituicao.idInstituicao}" tipo="Integer" />
				AND EXISTS
				    (
				        SELECT
				            1
				        FROM
				            br.com.sicoob.capes.negocio.entidades.TransicaoPessoa TP
				        WHERE
				            TP.pessoaCompartilhamento.idPessoaCompartilhamento = A.idPessoaCompartilhamento
				        AND TP.instituicao.idInstituicao != <bancoob:valorOql valor="${criterios.filtro.instituicao.idInstituicao}" tipo="Integer" />
				    )
				AND NOT EXISTS
				    (
				        SELECT
				            1
				        FROM
				            br.com.sicoob.capes.negocio.entidades.vigente.PessoaCompartilhamento PC
				        WHERE
				            PC.pessoa.idPessoa = A.pessoa.idPessoa
				        AND PC.compartilhamento.codigo = <bancoob:valorOql valor="${criterios.filtro.compartilhamento.codigo}" tipo="Short" />
				    )
    		]]>
		</command>
	</query>

	<query name="BUSCAR_DADOS_ALTERACAO_GRUPO_PESSOAS_NO_DESTINO">
		<use-case name="Alteração de Grupo de Compartilhamento" />
		<description>
			Recupera os dados, para alteração de grupo de compartilhamento, das pessoas
			que já estão
			no grupo de destino
		</description>
		<command>
			<![CDATA[
				FROM
				    br.com.sicoob.capes.negocio.entidades.vigente.PessoaCompartilhamento PO,
				    br.com.sicoob.capes.negocio.entidades.TransicaoPessoa TPO,
				    br.com.sicoob.capes.negocio.entidades.vigente.PessoaCompartilhamento PD,
				    br.com.sicoob.capes.negocio.entidades.TransicaoPessoa TPD,
				    br.com.sicoob.capes.negocio.entidades.vigente.ResponsavelCadastro IR
				WHERE
				    PO.idPessoaCompartilhamento = TPO.pessoaCompartilhamento.idPessoaCompartilhamento
				AND PO.pessoa.idPessoa = PD.pessoa.idPessoa
				AND PD.idPessoaCompartilhamento = TPD.pessoaCompartilhamento.idPessoaCompartilhamento
				AND TPD.pessoaCompartilhamento.idPessoaCompartilhamento = IR.idPessoaCompartilhamento
				AND TPD.instituicao.idInstituicao = IR.idInstituicao
				AND TPO.instituicao.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.instituicao.idInstituicao}" tipo="Integer" />
				AND PD.codCompartilhamentoCadastro = <bancoob:valorOql valor="${criterios.filtro.compartilhamento.codigo}" tipo="Short" />
			]]>
		</command>
		<projecao>
			SELECT new
			br.com.sicoob.capes.cadastro.negocio.vo.DadosAlteracaoGrupoVO(TPO.idTransicaoPessoa,
			PD.idPessoaCompartilhamento, TPO.idPessoaLegado,
			TPO.instituicao.idInstituicao, TPD.idPessoaLegado,
			TPD.instituicao.idInstituicao)
		</projecao>
	</query>

	<!-- AUTORIZAR ALTERAÇÕES -->
	<query name="CONSULTA_AUTORIZACAO_POR_ENTIDADE">
		<use-case name="Autorizar Alterações" />
		<description>Recupera a autorização que possui o ID e o tipo da
			entidade
		</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.Autorizacao a
				WHERE a.tipoAutorizacao = <bancoob:valorOql valor="${tipoAutorizacao}" />
				 AND (a.idRegistroAntigo = <bancoob:valorOql valor="${id}" />
				  OR a.idRegistroNovo = <bancoob:valorOql valor="${id}" />) 
			]]>
		</command>
	</query>

	<query name="CONSULTA_TIPO_OPERACAO_AUTORIZACAO">
		<use-case name="Autorizar Alterações" />
		<description>Recupera o tipo de autorizacao da autorização
		</description>
		<command>
			<![CDATA[
				SELECT a.tipoOperacao
				FROM br.com.sicoob.capes.negocio.entidades.Autorizacao a
				WHERE a.tipoAutorizacao = <bancoob:valorOql valor="${tipoAutorizacao}" />
				 AND (a.idRegistroAntigo = <bancoob:valorOql valor="${id}" />
				  OR a.idRegistroNovo = <bancoob:valorOql valor="${id}" />) 
			]]>
		</command>
	</query>

	<query name="CONSULTA_AUTORIZACOES_PENDENTES">
		<use-case name="Autorizar Alterações" />
		<description>Recupera as alterações a aprovar</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.Autorizacao a
			INNER JOIN a.pessoa p
			WHERE 
				a.dataHoraSolicitacao IS NOT NULL
				AND a.devolvido = FALSE
<j:choose>
	<j:when test="${criterios.tipoProcura == null}">
			AND 
				(
					a.instituicaoDestino.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.instituicaoDestino.idInstituicao}" tipo="Integer" />
			<j:choose>
				<j:when test="${criterios.filtro.instituicaoOrigem != null and criterios.filtro.instituicaoOrigem.idInstituicao != null}">
					AND a.instituicaoOrigem.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.instituicaoOrigem.idInstituicao}" tipo="Integer" />
				</j:when>
				<j:otherwise>
					OR  a.instituicaoOrigem.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.instituicaoDestino.idInstituicao}" tipo="Integer" />
				</j:otherwise>
			</j:choose>
				)
	</j:when>
	<j:otherwise>
		<j:if test="${criterios.filtro.instituicaoOrigem != null and criterios.filtro.instituicaoOrigem.idInstituicao != null}">
			AND a.instituicaoOrigem.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.instituicaoOrigem.idInstituicao}" tipo="Integer" />
		</j:if>
	</j:otherwise>
</j:choose>
		<j:if test="${criterios.filtro.idAutorizacao != null}">
			AND a.idAutorizacao = <bancoob:valorOql valor="${criterios.filtro.idAutorizacao}" tipo="Long" />
		</j:if>
		<j:if test="${criterios.filtro.pessoa != null and criterios.filtro.pessoa.cpfCnpj != null}">
			AND a.pessoa.cpfCnpj = <bancoob:valorOql valor="${criterios.filtro.pessoa.cpfCnpj}" tipo="String" />
		</j:if>
		<j:if test="${criterios.filtro.instituicaoDestino.idUnidadeInst != null}">
			AND a.instituicaoDestino.idUnidadeInst = <bancoob:valorOql valor="${criterios.filtro.instituicaoDestino.idUnidadeInst}" tipo="Integer" />
		</j:if>
		<j:if test="${criterios.filtro.tipoAutorizacao != null}">
			AND a.tipoAutorizacao = <bancoob:valorOql valor="${criterios.filtro.tipoAutorizacao}" tipo="Object" />
		</j:if>

			AND a.idRegistroControlado IN (<bancoob:valor valor="${criterios.idsRegistroControlado}" />)
			]]>
		</command>
		<projecao>SELECT a</projecao>
		<ordenacoes>
			<ordenacao chave="dataSolicitacao" default="true">
				<![CDATA[order by a.dataHoraSolicitacao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="COMANDO_CONSULTA_AUTORIZACOES_DEVOLVIDAS">
		<use-case name="Autorizar Alterações" />
		<description>Recupera as alterações devolvidas</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.Autorizacao a
			INNER JOIN a.pessoa p
			WHERE 
				a.dataHoraSolicitacao IS NOT NULL
			AND a.instituicaoOrigem.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.instituicaoOrigem.idInstituicao}" tipo="Integer" />
			AND a.devolvido = TRUE
		<j:if test="${criterios.filtro.idAutorizacao != null}">
			AND a.idAutorizacao = <bancoob:valorOql valor="${criterios.filtro.idAutorizacao}" tipo="Long" />
		</j:if>
		<j:if test="${criterios.filtro.pessoa != null and criterios.filtro.pessoa.cpfCnpj != null}">
			AND p.cpfCnpj = <bancoob:valorOql valor="${criterios.filtro.pessoa.cpfCnpj}" tipo="String" />
		</j:if>
		<j:if test="${criterios.filtro.instituicaoDestino != null and criterios.filtro.instituicaoDestino.idInstituicao != null}">
			AND a.instituicaoDestino.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.instituicaoDestino.idInstituicao}" tipo="Integer" />
		</j:if>
		<j:if test="${criterios.filtro.instituicaoDestino != null and criterios.filtro.instituicaoDestino.idUnidadeInst != null}">
			AND a.instituicaoDestino.idUnidadeInst = <bancoob:valorOql valor="${criterios.filtro.instituicaoDestino.idUnidadeInst}" tipo="Integer" />
		</j:if>
		<j:if test="${criterios.filtro.tipoAutorizacao != null}">
			AND a.tipoAutorizacao = <bancoob:valorOql valor="${criterios.filtro.tipoAutorizacao}" tipo="Object" />
		</j:if>

			AND a.idRegistroControlado IN (<bancoob:valor valor="${criterios.idsRegistroControlado}" />)
			
			]]>
		</command>
		<projecao>SELECT a</projecao>
		<ordenacoes>
			<ordenacao chave="dataSolicitacao" default="true">
				<![CDATA[ORDER BY a.dataHoraSolicitacao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="CONSULTA_AUTORIZACOES_ENCAMINHADAS">
		<use-case name="Autorizar Alterações" />
		<description>Recupera as alterações encaminhadas</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.Autorizacao a
			INNER JOIN a.pessoa p
			WHERE 
				a.dataHoraSolicitacao IS NOT NULL
		<j:if test="${criterios.tipoProcura == null}">
			AND (a.instituicaoOrigem.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.instituicaoOrigem.idInstituicao}" tipo="Integer" />
				OR a.instituicaoDestino.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.instituicaoOrigem.idInstituicao}" tipo="Integer" />)
		</j:if>
		<j:if test="${criterios.filtro.idAutorizacao != null}">
			AND a.idAutorizacao = <bancoob:valorOql valor="${criterios.filtro.idAutorizacao}" tipo="Long" />
		</j:if>
		<j:if test="${criterios.filtro.pessoa != null and criterios.filtro.pessoa.cpfCnpj != null}">
			AND p.cpfCnpj = <bancoob:valorOql valor="${criterios.filtro.pessoa.cpfCnpj}" tipo="String" />
		</j:if>
		<j:if test="${criterios.filtro.instituicaoDestino != null and criterios.filtro.instituicaoDestino.idInstituicao != null}">
			AND a.instituicaoDestino.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.instituicaoDestino.idInstituicao}" tipo="Integer" />
		</j:if>
		<j:if test="${criterios.filtro.instituicaoDestino != null and criterios.filtro.instituicaoDestino.idUnidadeInst != null}">
			AND a.instituicaoDestino.idUnidadeInst = <bancoob:valorOql valor="${criterios.filtro.instituicaoDestino.idUnidadeInst}" tipo="Integer" />
		</j:if>
		<j:if test="${criterios.filtro.tipoAutorizacao != null}">
			AND a.tipoAutorizacao = <bancoob:valorOql valor="${criterios.filtro.tipoAutorizacao}" tipo="Object" />
		</j:if>
			]]>
		</command>
		<projecao>SELECT a</projecao>
		<ordenacoes>
			<ordenacao chave="dataSolicitacao" default="true">
				<![CDATA[ORDER BY a.devolvido DESC, a.dataHoraSolicitacao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="CONSULTA_AUTORIZACOES_NAO_ENCAMINHADAS">
		<use-case name="Integração GED/GFT" />
		<description>Recupera as alterações que ainda não foram enviadas
		</description>
		<command>
			<![CDATA[
				SELECT new br.com.sicoob.capes.negocio.entidades.Autorizacao(p.idPessoa, p.cpfCnpj, c.nomePessoa, MIN(a.dataHoraCadastro))
				FROM br.com.sicoob.capes.negocio.entidades.Autorizacao a
				INNER JOIN a.pessoa p
				INNER JOIN p.compartilhamentos c
                WHERE a.instituicaoOrigem.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.instituicaoOrigem.idInstituicao}" tipo="Integer" />
				AND a.dataHoraSolicitacao IS NULL
				GROUP BY p.idPessoa,p.cpfCnpj,c.nomePessoa
			]]>
		</command>
		<ordenacoes>
			<ordenacao chave="data" default="true">
				<![CDATA[ORDER BY MIN(a.dataHoraCadastro)]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="CONSULTA_QTD_AUTORIZACOES_NAO_ENCAMINHADAS">
		<use-case name="Integração GED/GFT" />
		<description>Recupera as alterações que ainda não foram enviadas
		</description>
		<command>
			<![CDATA[
				SELECT COUNT(DISTINCT p.cpfCnpj)
				FROM br.com.sicoob.capes.negocio.entidades.Autorizacao a
				INNER JOIN a.pessoa p
				WHERE a.instituicaoOrigem.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.instituicaoOrigem.idInstituicao}" tipo="Integer" />
				AND a.dataHoraSolicitacao IS NULL
			]]>
		</command>
	</query>

	<query name="MARCAR_DESMARCAR_EM_ALTERACAO">
		<use-case name="Integração GED/GFT" />
		<description>Marca/Desmarca uma entidade como "em alteração"
		</description>
		<command>
			<![CDATA[
				UPDATE ${nomeTabela}
				SET IDINSTITUICAOATUALIZACAO = <bancoob:valor valor="${idInstituicaoAtualizacao}" tipo="Integer" />
				WHERE ${nomeColunaId} = <bancoob:valor valor="${id}" tipo="Integer" />
			]]>
		</command>
	</query>

	<query name="PESQUISA_PESSOAINSTITUICAO_POR_FUNCIONARIO">
		<use-case name="Manter funcionario" />
		<description>Recupera a pessoa instiuicao por funcionario
		</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.vigente.PessoaInstituicao pi
			WHERE pi.funcionario.idFuncionario = <bancoob:valorOql valor="${criterios.filtro.idFuncionario}" tipo="Integer" />
			]]>
		</command>
	</query>

	<query name="PESQUISA_INFORMACOES_PROFISSIONAIS">
		<use-case name="Manter Informações Profissionais" />
		<description>Recupera as informações profissionais de uma pessoa por
			instituicao
		</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.vigente.InformacaoProfissional info
			WHERE info.pessoa.idPessoa = <bancoob:valorOql valor="${criterios.filtro.pessoa.idPessoa}" tipo="Integer" />
			AND info.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.idInstituicao}" tipo="Integer" />
			]]>
		</command>
		<projecao>SELECT info</projecao>
		<ordenacoes>
			<ordenacao chave="dataAdmissao" default="true">
				<![CDATA[ORDER BY info.dataAdmissao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="CONSULTAR_INFORMACOES_PROFISSIONAIS_POR_MATRICULA_EMPREGADOR">
		<use-case name="Manter Informações Profissionais" />
		<description>Recupera as informações profissionais de uma pessoa por
			instituicao
		</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.vigente.InformacaoProfissional info
			WHERE info.pessoaEmpregador.idPessoa = <bancoob:valorOql valor="${criterios.filtro.pessoaEmpregador.idPessoa}" tipo="Integer" />
			AND info.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.idInstituicao}" tipo="Integer" />
			AND info.numMatricula = <bancoob:valorOql valor="${criterios.filtro.numMatricula}" tipo="String" />
			]]>
		</command>
		<projecao>SELECT info</projecao>
	</query>

	<query name="PESQUISA_FUNCIONARIO_POR_NUCLEO">
		<use-case name="" />
		<description>Recupera os funcionarios por nucleo</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.Funcionario funcionario
			WHERE funcionario.nucleo.idNucleo = <bancoob:valorOql valor="${criterios.filtro.idNucleo}" tipo="Integer" />
			]]>
		</command>
	</query>

	<query name="PESQUISA_PESSOAINSTITUICAO_POR_NUCLEO">
		<use-case name="Manter dados do cliente" />
		<description>Recupera a pessoa instiuicao</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.vigente.PessoaInstituicao pi
			WHERE pi.nucleo.idNucleo = <bancoob:valorOql valor="${criterios.filtro.idNucleo}" tipo="Integer" />
			]]>
		</command>
	</query>

	<query name="PESQUISAR_TIPO_OBSERVACAO_ANOTACAO">
		<use-case name="Pesquisar tipo observação anotação" />
		<description>Pesquisar tipo observação anotação</description>
		<command>
      <![CDATA[
      FROM br.com.sicoob.capes.negocio.entidades.TipoObservacaoAnotacao to
      WHERE 1=1
      ]]>
		</command>
	</query>

	<query name="PESQUISAR_DADOS_FLUXO_POR_FILTRO">
		<use-case name="Autorizar Alterações" />
		<description>Recupera a configuração de fluxo por filtro
		</description>
		<command>
			<![CDATA[			
				FROM br.com.sicoob.capes.negocio.entidades.DadosConfiguracaoFluxo dados
				WHERE dados.isResponsavel = <bancoob:valorOql valor="${isResponsavel}" tipo="Boolean" />
				AND dados.isGestor = <bancoob:valorOql valor="${isGestor}" tipo="Boolean" />
				AND dados.possuiDocumento = <bancoob:valorOql valor="${possuiDocumento}" tipo="Boolean" />
			]]>
		</command>
	</query>

	<query name="PESQUISA_MIGRACAO_PESSOA_POR_FILTRO">
		<use-case name="Migração de cooperativa" />
		<description>Recupera os registros de uma migração</description>
		<command>
			<![CDATA[
				FROM 
					br.com.sicoob.capes.negocio.entidades.MigracaoPessoa migracao
					inner join migracao.logMigracao log
				WHERE 
					log.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.logMigracao.idInstituicao}" tipo="Integer" />	
				AND migracao.dataProcessamentoPessoa is null
				
			]]>
		</command>
		<projecao>SELECT migracao</projecao>
		<ordenacoes>
			<ordenacao chave="idMigracaoPessoa" default="true">
				<![CDATA[ORDER BY migracao.numeroLinhaArquivo]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="CONSULTA_MIGRACAO_PESSOA_POR_FILTRO">
		<use-case name="Migração de cooperativa" />
		<description>Recupera os registros de uma migração</description>
		<command>
			<![CDATA[
				SELECT migracao
				FROM br.com.sicoob.capes.negocio.entidades.MigracaoPessoa migracao
				inner join migracao.logMigracao log
				WHERE log.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.logMigracao.idInstituicao}" tipo="Integer" />	
				AND migracao.numPessoaMigracao = <bancoob:valorOql valor="${criterios.filtro.numPessoaMigracao}" tipo="Integer"/>
			]]>
		</command>
	</query>

	<query name="PESQUISA_MIGRACAO_DETALHE_POR_FILTRO">
		<use-case name="Migração de cooperativa" />
		<description>Recupera os registros de detalhe de uma migração
		</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.MigracaoDetalhe migracao
				inner join migracao.logMigracao log
				WHERE log.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.logMigracao.idInstituicao}" tipo="Integer" />	
				AND migracao.dataProcessamento is null
				<j:if test="${criterios.filtro.codTipoRegistro != null}">
					AND migracao.codTipoRegistro = <bancoob:valorOql valor="${criterios.filtro.codTipoRegistro}" tipo="Short"/>
				</j:if>				
			]]>
		</command>
		<projecao>SELECT migracao</projecao>
		<ordenacoes>
			<ordenacao chave="numeroLinhaArquivo" default="true">
				<![CDATA[ORDER BY migracao.numeroLinhaArquivo]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISA_MIGRACAO_CLIENTE_POR_FILTRO">
		<use-case name="Migração de cooperativa" />
		<description>Recupera os registros de uma migração de clientes
		</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.MigracaoPessoa migracao
				inner join migracao.logMigracao log
				WHERE log.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.logMigracao.idInstituicao}" tipo="Integer" />	
				AND migracao.dataProcessamentoPessoa is not null 
				AND migracao.descErroPessoa is null
				AND migracao.dataProcessamentoCliente is null
				AND migracao.cliente = true
			]]>
		</command>
		<projecao>SELECT migracao</projecao>
		<ordenacoes>
			<ordenacao chave="idMigracaoPessoa" default="true">
				<![CDATA[ORDER BY migracao.idMigracaoPessoa]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="EXCLUIR_MIGRACAODETALHE_POR_LOG_MIGRACAO">
		<use-case name="Importação de arquivos da migração"></use-case>
		<description>Pesquisa as pessoas</description>
		<command>
			<![CDATA[
				DELETE from cli.MigracaoDetalhe a
				WHERE A.idInstituicao = <bancoob:valor valor="${idInstituicao}" />
			]]>
		</command>
	</query>

	<query name="EXCLUIR_MIGRACAOPESSOA_POR_LOG_MIGRACAO">
		<use-case name="Importação de arquivos da migração"></use-case>
		<description>Pesquisa as pessoas</description>
		<command>
			<![CDATA[
				DELETE from cli.MigracaoPessoa a
				WHERE A.idInstituicao = <bancoob:valor valor="${idInstituicao}" />
			]]>
		</command>
	</query>

	<query name="VERIFICA_REGISTROS_MIGRACAOPESSOA_PROCESSADOS">
		<use-case name="Importação de arquivos da migração"></use-case>
		<description>Pesquisa a quanitade de registros de migracao
			processados
		</description>
		<command>
			<![CDATA[
				SELECT count(*)			
				FROM br.com.sicoob.capes.negocio.entidades.MigracaoPessoa migracao
				inner join migracao.logMigracao log
				WHERE log.idInstituicao = <bancoob:valorOql valor="${idInstituicao}" tipo="Integer" />	
				AND (migracao.dataProcessamentoPessoa is not null 
					OR migracao.dataProcessamentoCliente is not null)
			]]>
		</command>
	</query>

	<query name="VERIFICA_REGISTROS_MIGRACAODETALHE_PROCESSADOS">
		<use-case name="Importação de arquivos da migração"></use-case>
		<description>Pesquisa a quanitade de registros de migracao
			processados
		</description>
		<command>
			<![CDATA[
				SELECT count(*)
				FROM br.com.sicoob.capes.negocio.entidades.MigracaoDetalhe migracao
				inner join migracao.logMigracao log
				WHERE log.idInstituicao = <bancoob:valorOql valor="${idInstituicao}" tipo="Integer" />	
				AND migracao.dataProcessamento is not null
			]]>
		</command>
	</query>

	<query name="LIMPAR_MIGRACAODETALHE_COM_ERRO">
		<use-case name="processamento da migração"></use-case>
		<description>Atualiza a data de processamento e o descErro para null
		</description>
		<command>
			<![CDATA[
				UPDATE cli.MIGRACAODETALHE
				SET dataHoraProcessamento = null,
				descErro = null
				WHERE idInstituicao = <bancoob:valor valor="${idInstituicao}" />
				AND descErro is not null
			]]>
		</command>
	</query>

	<query name="LIMPAR_MIGRACAOPESSOA_COM_ERRO">
		<use-case name="processamento da migração"></use-case>
		<description>Atualiza a data de processamento e o descErro para null
		</description>
		<command>
			<![CDATA[
				UPDATE cli.MigracaoPessoa 
				SET DATAHORAPROCESSAMENTOPESSOA = null,
				DESCERROPESSOA = null
				WHERE idInstituicao = <bancoob:valor valor="${idInstituicao}" tipo="Integer" />
				AND DESCERROPESSOA is not null
			]]>
		</command>
	</query>

	<query name="LIMPAR_MIGRACAOCLIENTE_COM_ERRO">
		<use-case name="processamento da migração"></use-case>
		<description>Atualiza a data de processamento e o descErro para null
		</description>
		<command>
			<![CDATA[
				UPDATE cli.MigracaoPessoa 
				SET DATAHORAPROCESSAMENTOCLIENTE = null,
				DESCERROCLIENTE = null
				WHERE idInstituicao = <bancoob:valor valor="${idInstituicao}" tipo="Integer" />
				AND DESCERROCLIENTE is not null
			]]>
		</command>
	</query>

	<!-- Pesquisa de consultas que estão aptas a serem encaminhadas -->
	<query name="COMANDO_CONSULTA_AUTORIZACOES_APTAS_ENCAMINHAR">
		<use-case name="Integração GED/GFT" />
		<description>Pesquisa de consultas que estão aptas a serem
			encaminhadas</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.Autorizacao a
				WHERE a.pessoa.idPessoa = <bancoob:valorOql valor="${criterios.idPessoaSelecionada}" tipo="Integer" />
				<j:if test="${criterios != null and criterios.idInstituicaoUsuario != null}">
					AND a.instituicaoOrigem.idInstituicao = <bancoob:valorOql valor="${criterios.idInstituicaoUsuario}" tipo="Integer" />
				</j:if>
				<j:if test="${criterios != null and criterios.tipoAutorizacao != null}">
					AND a.tipoAutorizacao = <bancoob:valorOql valor="${criterios.filtro.tipoAutorizacao}" tipo="Object" />
				</j:if>
				<j:if test="${criterios != null and criterios.idRegistro != null}">
					AND (a.idRegistroAntigo = <bancoob:valorOql valor="${criterios.idRegistro}" tipo="Long" /> 
					OR a.idRegistroNovo = <bancoob:valorOql valor="${criterios.idRegistro}" tipo="Long" />) 
				</j:if>
				
				AND a.dataHoraSolicitacao IS NULL				
			]]>
		</command>
		<ordenacoes>
			<ordenacao chave="tipoAutorizacao" default="true">
				<![CDATA[ORDER BY a.dataHoraCadastro, a.tipoAutorizacao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<!-- Pesquisa os documentos que estão em fase de aprovação -->
	<query name="CONSULTA_DOCUMENTOS_AUTORIZACAO">
		<use-case name="Integração GED/GFT" />
		<description>Pesquisa de documentos que estão em fase de aprovação
		</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.Autorizacao a
				WHERE a.tipoAutorizacao = <bancoob:valorOql valor="${criterios.tipoAutorizacao.tipoAutorizacao}" tipo="Object" />
				AND (a.idRegistroAntigo = <bancoob:valorOql valor="${criterios.idRegistro}" tipo="Long" /> 
				OR a.idRegistroNovo = <bancoob:valorOql valor="${criterios.idRegistro}" tipo="Long" />) 
			]]>
		</command>
	</query>

	<query name="PESQUISAR_CNAE_POR_FILTRO">
		<use-case name="CNAE" />
		<description>Pesquisa CNAE por filtro</description>
		<command>
		<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.CnaeFiscal c
			WHERE 1=1
			
			<j:if test="${criterios.filtro != null and criterios.filtro.codigo != null}">
				AND c.codigo like <bancoob:valorOql valor="${criterios.filtro.codigo}" tipo="LikeDireitaEsquerda" /> 
			</j:if>
			
			<j:if test="${criterios.filtro != null and criterios.filtro.descricao != null}">
				AND c.descricao like <bancoob:valorOql valor="${criterios.filtro.descricao}" tipo="LikeDireitaEsquerda" /> 
			</j:if>
		]]>
		</command>
		<projecao>SELECT c</projecao>
	</query>

	<query name="PESQUISA_CATEGORIAS_POR_STATUS">
		<use-case name="Produtor" />
		<description>Recupera as categorias pelo status</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.CategoriaProdutor categoria
			
			<j:if test="${criterios.filtro != null and criterios.filtro.ativo != null}">
				WHERE categoria.ativo = <bancoob:valorOql valor="${criterios.filtro.ativo}" tipo="Boolean" />
			</j:if>
			]]>
		</command>
	</query>

	<query name="OBTER_AUTORIZACAO">
		<use-case name="Autorizacao" />
		<description>Obtém a autorização pela chave</description>
		<command>
			<![CDATA[
				SELECT a
				FROM br.com.sicoob.capes.negocio.entidades.Autorizacao a
				INNER JOIN a.pessoa pessoa
				INNER JOIN pessoa.compartilhamentos pessoaCompartilhamento
				INNER JOIN pessoaCompartilhamento.transicoes transicao
				WHERE a.idAutorizacao = <bancoob:valorOql valor="${chaveAutorizacao}" tipo="Long" />
                AND transicao.instituicao.idInstituicao = a.instituicaoOrigem.idInstituicao
			]]>
		</command>
	</query>

	<query name="OBTER_AUTORIZACAO_COM_LEITURA_SUJA">
		<use-case name="Autorizacao" />
		<description>Obtém a autorização pela chave</description>
		<command>
			<![CDATA[
				SELECT a
				FROM br.com.sicoob.capes.negocio.entidades.Autorizacao a
				WHERE a.idAutorizacao = <bancoob:valorOql valor="${chaveAutorizacao}" tipo="Long" />
			]]>
		</command>
	</query>

	<query name="DELETE_DOCUMENTOS_AUTORIZACAO">
		<use-case name="Autorizacao" />
		<description>Deleta documentos da autorização</description>
		<command>
			<![CDATA[
				DELETE FROM br.com.sicoob.capes.negocio.entidades.AutorizacaoDocumento a
				WHERE a.idAutorizacao = <bancoob:valorOql valor="${idAutorizacao}" tipo="Long" />				
			]]>
		</command>
	</query>

	<query name="VERIFICAR_CADASTRO_REGULAR_RECEITA">
		<use-case name="Anotacao"></use-case>
		<description>Verifica se o cadastro da Receita Federal (CPF/CNPJ)
			está regular
		</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.Anotacao a
				WHERE a.tipoAnotacao.codTipoAnotacao in (500, 501)
				AND a.tipoBaixa.idTipoBaixa is null
				AND a.pessoaCompartilhamento.idPessoaCompartilhamento = <bancoob:valorOql valor="${idPessoaCompartilhamento}" tipo="Long" />
			]]>
		</command>
	</query>

	<query name="PESQUISAR_RELACIONAMENTOS_VIGENTES_FILTRO">
		<use-case name="Manter Relacionamento" />
		<description>Pesquisa os relacionamentos vigentes</description>
		<command>
			<![CDATA[
				SELECT r
				FROM br.com.sicoob.capes.negocio.entidades.vigente.RelacionamentoPessoa r
				INNER JOIN r.tipoRelacionamento t
				INNER JOIN r.pessoaCompartilhamento pc
				INNER JOIN pc.transicoes tp
				
				<j:if test="${idPessoaRelacionada != null}">
					INNER JOIN r.pessoaRelacionada pr
				</j:if>
				
				WHERE r.dataHoraInicio is not null
				AND tp.instituicao.idInstituicao = <bancoob:valorOql valor="${idInstituicao}" tipo="Integer" />
				AND r.pessoa.idPessoa = <bancoob:valorOql valor="${idPessoa}" tipo="Integer" />
				<j:if test="${idTipoRelacionamento != null}">
					AND t.codigo = <bancoob:valorOql valor="${idTipoRelacionamento}" tipo="Short" />
				</j:if>
				
				<j:if test="${idPessoaRelacionada != null}">
					AND pr.idPessoa = <bancoob:valorOql valor="${idPessoaRelacionada}" tipo="Integer" />
				</j:if>
				
				AND (
						(t.permiteCompartilhamento = 1) OR (r.idInstituicao = <bancoob:valorOql valor="${idInstituicao}" tipo="Integer" />
						AND t.permiteCompartilhamento = 0)
					)
			]]>
		</command>
	</query>

	<query name="PESQUISA_BEM_IMOVEL_VIGENTE_POR_PESSOA">
		<use-case name="Manter bem" />
		<description>Recupera os bens imóveis vigentes da pessoa
		</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.bemantigo.BemImovel bem
			WHERE 1 = 1 
			AND bem.codigoSituacaoAprovacao = 0 
			AND bem.pessoaCompartilhamento.id = <bancoob:valorOql valor="${criterios.filtro.pessoaCompartilhamento.idPessoaCompartilhamento}" tipo="Long" />
			AND bem.codLocalizacao = <bancoob:valorOql valor="${criterios.filtro.codLocalizacao}" tipo="String" />
			]]>
		</command>
		<ordenacoes>
			<ordenacao chave="dataHoraInicio" default="true">
				<![CDATA[order by bem.dataHoraInicio]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="ATUALIZAR_RELACIONAMENTO_REVERSO">
		<use-case name="Atualiza o relacionamento reverso" />
		<description>Atualiza o relacionamento reverso</description>
		<command>
			<![CDATA[
				UPDATE CLI.RELACIONAMENTOPESSOA
				SET IDRELACIONAMENTOOPOSTO = <bancoob:valor valor="${idRelacionamentoReverso}" tipo="Long" />
				WHERE IDRELACIONAMENTOPESSOA = <bancoob:valor valor="${idRelacionamento}" tipo="Long" />
			]]>
		</command>
	</query>

	<query name="VERIRICAR_COMPARTILHAMENTO_CADASTRO">
		<use-case name="Grupo Compartilhamento" />
		<description>Verifica se existe algum grupo de compartilhamento para
			o compartilhamento cadastro
		</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.vigente.GrupoCompartilhamento grupoCompartilhamento
			WHERE grupoCompartilhamento.compartilhamentoCadastro.codigo = <bancoob:valorOql valor="${idCompartilhamentoCadastro}" tipo="Short" />
			]]>
		</command>
	</query>

	<query name="OBTER_DADOS_PESSOA_LEGADO_PLATAFORMA">
		<use-case name="Plataforma de Atendimento" />
		<description>Obtém os dados da pessoa do legado para utilização na
			plataforma de atendimento
		</description>
		<command>
			<![CDATA[
				SELECT
				    C.IDPESSOALEGADO                                                                                AS NumPessoa,
				    LEFT(TRIM(C.IDPESSOALEGADO),LENGTH(TRIM(C.IDPESSOALEGADO))-1) ||'-'|| RIGHT(C.IDPESSOALEGADO,1) AS sNumPessoa,
				    UPPER(B.NOMEPESSOA)                                                                             AS DescNomePessoa,
				    A.NUMCPFCNPJ                                                                                    AS NumCGCCPFNum,
				    CASE CODTIPOPESSOA
				        WHEN 0
				        THEN SUBSTR(A.NUMCPFCNPJ,1,3) || '.' || SUBSTR(A.NUMCPFCNPJ,4,3) || '.' || SUBSTR(A.NUMCPFCNPJ,7,3) || '-' || SUBSTR(A.NUMCPFCNPJ,10,2)
				        WHEN 1
				        THEN SUBSTR(A.NUMCPFCNPJ,1,2) || '.' || SUBSTR(A.NUMCPFCNPJ,3,3) || '.' || SUBSTR(A.NUMCPFCNPJ,6,3) || '/' || SUBSTR(A.NUMCPFCNPJ,9,4) || '-' || SUBSTR(A.NUMCPFCNPJ,13,2)
				    END NumCGC_CPF,
				    CASE
				        WHEN D.IDPESSOAINSTITUICAO > 1
				        THEN 'SIM'
				        ELSE 'NÃO'
				    END AS CodSituacaoCliente,
				    CASE
				        WHEN E.NUMDDD IS NULL
				        THEN ''
				        ELSE '('||E.NUMDDD||') '
				    END||
				    CASE
				        WHEN E.NUMTELEFONE IS NULL
				        THEN ''
				        WHEN LENGTH(TRIM(E.NUMTELEFONE)) = 8
				        THEN SUBSTR(TRIM(E.NUMTELEFONE),1,4)||'-'||SUBSTR(TRIM(E.NUMTELEFONE),5,4)
				        WHEN LENGTH(TRIM(E.NUMTELEFONE)) = 9
				        THEN SUBSTR(TRIM(E.NUMTELEFONE),1,5)||'-'||SUBSTR(TRIM(E.NUMTELEFONE),5,4)
				        ELSE E.NUMTELEFONE
				    END AS NumTelefone,
				    A.CODTIPOPESSOA CodPF_PJ
				FROM
				    CLI.PESSOA A
				INNER JOIN CLI.PESSOACOMPARTILHAMENTO B
				ON
				    A.IDPESSOA = B.IDPESSOA
				INNER JOIN CLI.TRANSICAOPESSOA C
				ON
				    B.IDPESSOACOMPARTILHAMENTO = C.IDPESSOACOMPARTILHAMENTO
				LEFT JOIN CLI.TELEFONEPESSOA E
				ON
				    B.IDPESSOACOMPARTILHAMENTO = E.IDPESSOACOMPARTILHAMENTO
				LEFT JOIN CLI.PESSOAINSTITUICAO D
				ON
				    A.IDPESSOA = D.IDPESSOA
				AND C.IDINSTITUICAO = D.IDINSTITUICAO
				WHERE
				    A.NUMCPFCNPJ = ?
				AND C.IDINSTITUICAO = ?
				FETCH
				    FIRST 1 ROWS ONLY
			]]>
		</command>
	</query>

	<query name="MARCAR_AUTORIZACAO_DEVOLVIDA">
		<use-case name="Autorizar Alterações" />
		<description>Marca/desmarca a autorização como "devolvida"
		</description>
		<command>
			<![CDATA[
				UPDATE
				    CLI.AUTORIZACAO
				SET
				    BOLDEVOLVIDO = <bancoob:valor valor="${devolvido}" tipo="Boolean" />
				WHERE
				    IDAUTORIZACAO = <bancoob:valor valor="${idAutorizacao}" tipo="Long" />
			]]>
		</command>
	</query>

	<query name="OBTER_AUTORIZACOES_VENCIDAS">
		<use-case name="Autorizacao" />
		<description>Obtém as autorizações com mais de 60 dias.
		</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.Autorizacao a
				WHERE DATE(a.dataHoraCadastro) &lt; <bancoob:valorOql valor="${criterios.filtro.dataHoraCadastro}" tipo="Date" />
				AND a.idAutorizacao &gt; <bancoob:valorOql valor="${criterios.filtro.idAutorizacao}" tipo="Long" />
			]]>
		</command>
		<ordenacoes>
			<ordenacao chave="idAutorizacao" default="true">
				<![CDATA[ORDER BY idAutorizacao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="OBTER_AUTORIZACAO_LOCK">
		<use-case name="Autorizacao" />
		<description>Obtém a autorização e bloqueia o registro</description>
		<command>
			<![CDATA[
				SELECT IDAUTORIZACAO
				FROM CLI.AUTORIZACAO
				WHERE IDAUTORIZACAO = <bancoob:valor valor="${idAutorizacao}" tipo="Long" />
				FOR UPDATE WITH RS USE AND KEEP EXCLUSIVE LOCKS
			]]>
		</command>
	</query>

	<query name="CONSULTA_PESSOA_PENDENTE_APROVACAO">
		<use-case name="Pessoa pendente aprovação" />
		<description>Pessoa pendente aprovação</description>
		<command>
        <![CDATA[
          SELECT COUNT(A)
          FROM br.com.sicoob.capes.negocio.entidades.vigente.PessoaCompartilhamento A,
               br.com.sicoob.capes.negocio.entidades.vigente.GrupoCompartilhamento B,
               br.com.sicoob.capes.negocio.entidades.Autorizacao C
          WHERE 
          	A.pessoa.idPessoa                 = <bancoob:valorOql valor="${idPessoa}" tipo="Integer" />
            AND A.compartilhamento.codigo     = <bancoob:valorOql valor="${codCompartilhamentoCadastro}" tipo="Short" />
            AND A.codCompartilhamentoCadastro = B.compartilhamentoCadastro.codigo
            AND A.pessoa.idPessoa             = C.pessoa.idPessoa
            AND B.idInstituicao               = C.instituicaoOrigem.idInstituicao
        ]]>
		</command>
	</query>
	
	<query name="CONSULTA_PESSOA_PENDENTE_APROVACAO_AUTORIZACAO">
	    <use-case name="Pessoa pendente aprovação" />
	    <description>Pessoa pendente aprovação</description>
	    <command>
	        <![CDATA[
	          SELECT COUNT(*)
	          FROM CLI.PESSOACOMPARTILHAMENTO A,
	               CLI.GRUPOCOMPARTILHAMENTO B,
	               CLI.AUTORIZACAO C
	          WHERE A.IDPESSOA                    = <bancoob:valorOql valor="${idPessoa}" />
	            AND A.CODCOMPARTILHAMENTOCADASTRO = <bancoob:valorOql valor="${codCompartilhamentoCadastro}" />
	            AND A.CODCOMPARTILHAMENTOCADASTRO = B.CODCOMPARTILHAMENTOCADASTRO
	            AND A.IDPESSOA                    = C.IDPESSOA
	            AND B.IDINSTITUICAO               = C.IDINSTITUICAOORIGEM
	            AND C.IDAUTORIZACAO &lt;&gt; <bancoob:valorOql valor="${idAutorizacao}" />
	        ]]>
	    </command>
  	</query>

	<query name="CONSULTA_IS_PESSOA_POSSUI_AUTORIZACAO">
		<use-case name="Pessoa se pessoa possui autorizacao na instituicao" />
		<description>Pessoa se pessoa possui autorizacao na instituicao
		</description>
		<command>
        <![CDATA[
        SELECT
            count(*)
        FROM
            CLI.AUTORIZACAO a
        WHERE
            a.IDPESSOA = <bancoob:valorOql valor="${idPessoa}" tipo="Integer" />
        ]]>
		</command>
	</query>

	<query name="OBTER_SITUACAO_MIGRACAO">
		<use-case name="Processar Migração" />
		<description>Obtém os detalhes sobre a situação da migração de
			determinada instituição
		</description>
		<command>
			<![CDATA[
				SELECT
					new br.com.sicoob.capes.cadastro.negocio.vo.SituacaoMigracaoVO(
				    log.idInstituicao,
				    log.descErro,
				    (
				        CASE
				            WHEN log.dataHoraInicioImportacao IS NOT NULL
				            THEN (
				                    CASE
				                        WHEN log.descErro IS NOT NULL AND log.dataHoraSolicitacaoProcessamento IS NULL
				                        THEN 'Falhou'
				                        WHEN log.dataHoraFimImportacao IS NOT NULL
				                        THEN 'Finalizado'
				                        ELSE 'Iniciado'
				                    END)
				            ELSE 'Solicitado'
				        END) AS statusImportacao,
				    log.usuarioSolicitacaoImportacao,
				    log.dataHoraSolicitacaoImportacao,
				    log.dataHoraInicioImportacao,
				    log.dataHoraFimImportacao,
				    (
				        CASE
				            WHEN log.dataHoraSolicitacaoProcessamento IS NOT NULL
				            THEN (
				                    CASE
	                                    WHEN log.descErro IS NOT NULL
	                                    THEN 'Falhou'
				                        WHEN log.dataHoraInicioProcessamento IS NOT NULL
				                        THEN (
				                                CASE
				                                    WHEN log.dataHoraFimProcessamento IS NOT NULL
				                                    THEN 'Finalizado'
				                                    ELSE 'Iniciado'
				                                END)
				                        ELSE 'Solicitado'
				                    END)
				            ELSE 'Pendente'
				        END) AS statusProcessamento,
				    log.usuarioSolicitacaoProcessamento,
				    log.dataHoraSolicitacaoProcessamento,
				    log.dataHoraInicioProcessamento,
				    log.dataHoraFimProcessamento)
				FROM
				    br.com.sicoob.capes.negocio.entidades.LogMigracao log
			    WHERE
				    log.idInstituicao = <bancoob:valorOql valor="${idInstituicao}" tipo="Integer" />
			]]>
		</command>
	</query>

	<query name="LISTAR_TRANSICAO_PESSOA_INSTITUICAO_RESPONSAVEL">
		<use-case name="AUTORIZAR CADASTRO" />
		<description>Recupera o responsavel pelo cadastro da pessoa
		</description>
		<command>
      <![CDATA[
        SELECT transicao.IDTRANSICAOPESSOA, transicao.IDINSTITUICAO, transicao.IDUNIDADEINST 
        FROM cli.TRANSICAOPESSOA transicao
        WHERE transicao.idPessoaCompartilhamento = <bancoob:valor valor="${idPessoaCompartilhamento}" />
      ]]>
		</command>
	</query>

	<query name="LISTAR_VINCULOS_CPF_CNPJ">
		<use-case name="Alterar cpf cnpj" />
		<description>Recupera os vínculos de um cpf ou cnpj</description>
		<command>
      <![CDATA[
        SELECT p.idPessoa, p.NUMCPFCNPJ, t.IDINSTITUICAO, t.IDUNIDADEINST, t.NOMEPESSOALEGADO, 
            c.CODCOMPARTILHAMENTOCADASTRO, c.DESCCOMPARTILHAMENTOCADASTRO
        FROM cli.PESSOA p
        INNER JOIN cli.PESSOACOMPARTILHAMENTO pc on pc.IDPESSOA = p.IDPESSOA
        INNER JOIN cli.TRANSICAOPESSOA t on t.IDPESSOACOMPARTILHAMENTO = pc.IDPESSOACOMPARTILHAMENTO
        INNER JOIN cli.COMPARTILHAMENTOCADASTRO c ON c.CODCOMPARTILHAMENTOCADASTRO = pc.CODCOMPARTILHAMENTOCADASTRO
        WHERE p.NUMCPFCNPJ = <bancoob:valor valor="${cpfCnpj}" />
      ]]>
		</command>
	</query>

	<query name="CONSULTAR_RESUMO_MIGRACAO_PESSOA">
		<use-case name="Solicitação de migração" />
		<description>Recupera o sumario da migracao</description>
		<command>
      <![CDATA[
        SELECT
            COUNT(1) AS QTD_PESSOAS,
            SUM(
                CASE
                    WHEN DATAHORAPROCESSAMENTOPESSOA IS NOT NULL
                     AND DESCERROPESSOA IS NULL
                    THEN 1
                    ELSE 0
                END) AS QTD_PESSOAS_PROCESSADAS,
            SUM(
                CASE
                    WHEN DATAHORAPROCESSAMENTOPESSOA IS NOT NULL
                     AND DESCERROPESSOA IS NOT NULL
                    THEN 1
                    ELSE 0
                END) AS QTD_PESSOAS_ERROS,
            SUM(
                CASE
                    WHEN BOLCLIENTE = 1
                    THEN 1
                    ELSE 0
                END) AS QTD_CLIENTES,
            SUM(
                CASE
                    WHEN BOLCLIENTE = 1
                     AND DATAHORAPROCESSAMENTOCLIENTE IS NOT NULL
                     AND DESCERROPESSOA IS NULL
                    THEN 1
                    ELSE 0
                END) AS QTD_CLIENTES_PROCESSADOS,
            SUM(
                CASE
                    WHEN BOLCLIENTE = 1
                     AND DATAHORAPROCESSAMENTOCLIENTE IS NOT NULL
                     AND DESCERROPESSOA IS NOT NULL
                    THEN 1
                    ELSE 0
                END) AS QTD_CLIENTES_ERROS
        FROM
            CLI.MIGRACAOPESSOA
        WHERE
            IDINSTITUICAO = <bancoob:valor valor="${idInstituicao}" />
      ]]>
		</command>
	</query>

	<query name="CONSULTAR_RESUMO_MIGRACAO_DETALHE">
		<use-case name="Solicitação de migração" />
		<description>Recupera o sumario da migracao</description>
		<command>
      <![CDATA[
        SELECT
            CODTIPOREGISTRO AS COD_TIPO_REGISTRO,
            COUNT(1) AS QTD_REGISTROS,
            SUM(
                CASE
                    WHEN DATAHORAPROCESSAMENTO IS NOT NULL
                    AND DESCERRO IS NULL
                    THEN 1
                    ELSE 0
                END) AS QTD_PROCESSADOS,
            SUM(
                CASE
                    WHEN DESCERRO IS NOT NULL
                    THEN 1
                    ELSE 0
                END) AS QTD_ERROS
        FROM
            CLI.MIGRACAODETALHE
        WHERE
            IDINSTITUICAO = <bancoob:valor valor="${idInstituicao}" />
        GROUP BY
            CODTIPOREGISTRO
      ]]>
		</command>
	</query>

	<query name="OBTER_ANOTACOES_EXTERNAS_BAIXA">
		<use-case name="ANOTACAO"></use-case>
		<description>Baixa a anotação externa</description>
		<command>
      <![CDATA[
        FROM 
            br.com.sicoob.capes.negocio.entidades.Anotacao A
        WHERE
            A.pessoaCompartilhamento.idPessoaCompartilhamento = <bancoob:valorOql valor="${idPessoaCompartilhamento}" />
        AND A.dataHoraBaixa IS NULL
        AND A.origemInformacao.idOrigemInfo = <bancoob:valorOql valor="${idOrigemInformacao}" />
        AND EXISTS
            (
                FROM
                    br.com.sicoob.capes.negocio.entidades.TipoConsultaOrigem C
                WHERE
                    A.tipoConsultaOrigem.idTipoConsultaOrigem = C.idTipoConsultaOrigem
                AND C.nomeTipoConsultaOrigem = <bancoob:valorOql valor="${nomeTipoConsulta}" />)
      ]]>
		</command>
	</query>

	<query name="OBTER_ORIGEM_POR_NOME">
		<use-case name="Origem Informação"></use-case>
		<description>Pesquisa a origem por nome</description>
		<command>
      <![CDATA[
        FROM br.com.sicoob.capes.negocio.entidades.OrigemInformacao o
        WHERE o.nomeOrigemInfo = <bancoob:valorOql valor="${nomeOrigemInformacao}" tipo="String" />
      ]]>
		</command>
	</query>

	<query name="OBTER_MAPA_ANOTACAO_EXTERNA">
		<use-case name="Mapa Tipo Anotação"></use-case>
		<description>Obtém o mapa de acordo com as informações da anotação
			externa</description>
		<command>
      <![CDATA[
        FROM 
            br.com.sicoob.capes.negocio.entidades.MapaTipoAnotacao mapa
        INNER JOIN 
            mapa.tipoConsultaOrigem tipoConsulta
        WHERE 
            mapa.codigoTipoOrigemInformacao = <bancoob:valorOql valor="${codigoTipoOrigemInformacao}" tipo="String" />
        AND tipoConsulta.nomeTipoConsultaOrigem = <bancoob:valorOql valor="${nomeTipoConsultaOrigem}" tipo="String" />
      ]]>
		</command>
		<projecao>SELECT mapa</projecao>
	</query>

	<query name="OBTER_MAPAS_ANOTACAO_POR_TIPO">
		<use-case name="Mapa Tipo Anotação" />
		<description>Recupera os mapas por tipo de anotação</description>
		<command>
        <![CDATA[
        FROM br.com.sicoob.capes.negocio.entidades.MapaTipoAnotacao mapa
        WHERE mapa.tipoAnotacao.codTipoAnotacao = <bancoob:valorOql valor="${idTipoAnotacao}" tipo="Integer" />
        ]]>
		</command>
	</query>

	<query name="HABILITAR_INTEGRACAO_SRF_COMPARTILHAMENTO_CADASTRO">
		<use-case name="Compartilhamento cadastro" />
		<description>Habilita/desabilita a integração para todas as
			instituições de um grupo de compartilhamento</description>
		<command>
        <![CDATA[
        UPDATE CLI.GRUPOCOMPARTILHAMENTO SET BOLINTEGRACAOSRF = <bancoob:valor valor="${habilitarIntegracao}" tipo="Boolean" />
        WHERE CODCOMPARTILHAMENTOCADASTRO = <bancoob:valor valor="${codCompartilhamentoCadastro}" tipo="Integer" />
        ]]>
		</command>
	</query>

	<query name="OBTER_STATUS_CLIENTE_TRANSFERENCIA_INFORMACAO">
		<use-case name="Transferência Informação" />
		<description>Obtém o status da transferência de clientes</description>
		<command>
        <![CDATA[
        SELECT
        	A.IDUNIDADEINST AS IDUNIDADEINST,
        	NUC.NUMNUCLEO AS NUMERONUCLEO,
            NUC.DESCNUCLEO AS NOMENUCLEO,
            PC.NOMEPESSOA AS NOMEPESSOA,
            COUNT(*) AS QUANTIDADE
        FROM CLI.PESSOAINSTITUICAO A 
        	LEFT JOIN CLI.FUNCIONARIO F ON A.IDFUNCIONARIORESPONSAVEL = F.IDFUNCIONARIO
            LEFT JOIN CLI.PESSOACOMPARTILHAMENTO PC ON PC.IDPESSOA = F.IDPESSOA
            LEFT JOIN CLI.TRANSICAOPESSOA TP ON TP.IDPESSOACOMPARTILHAMENTO = PC.IDPESSOACOMPARTILHAMENTO
            AND TP.IDINSTITUICAO = A.IDINSTITUICAO
            LEFT JOIN CLI.NUCLEO NUC ON NUC.IDNUCLEO = A.IDNUCLEO
        WHERE A.IDINSTITUICAO = <bancoob:valor valor="${idInstituicao}" tipo="Integer" />
        GROUP BY A.IDUNIDADEINST,
                 PC.NOMEPESSOA,
                 NUC.NUMNUCLEO,
                 NUC.DESCNUCLEO
        ]]>
		</command>
	</query>

	<query name="OBTER_STATUS_GRUPO_ECONOMICO_TRANSFERENCIA_INFORMACAO">
		<use-case name="Transferência Informação" />
		<description>Obtém o status da transferência de grupo econômico
		</description>
		<command>
        <![CDATA[
        SELECT 
        	A.DESCGRUPOECONOMICO AS NOMEGRUPOECONOMICO, 
        	COUNT(*) AS QUANTIDADE
        FROM CLI.GRUPOECONOMICO A,
             CLI.GRUPOECONOMICOPESSOA B
        WHERE A.IDINSTITUICAO = <bancoob:valor valor="${idInstituicao}" tipo="Integer" />
        AND   A.DATAHORAEXCLUSAO IS NULL
        AND   B.IDGRUPOECONOMICO = A.IDGRUPOECONOMICO
        GROUP BY A.DESCGRUPOECONOMICO 
        ]]>
		</command>
	</query>

	<query name="PESQUISAR_TIPO_CONSULTA_ORIGEM_POR_FILTRO">
		<use-case name="Cadastrar anotações via Integrações Externas" />
		<description>Lista os tipos de consulta origem por filtro
		</description>
		<command>
      <![CDATA[
        FROM br.com.sicoob.capes.negocio.entidades.TipoConsultaOrigem origem
        WHERE
        <j:if test="${criterios.filtro != null and criterios.filtro.nomeTipoConsultaOrigem != null}"> 
          origem.nomeTipoConsultaOrigem = <bancoob:valorOql valor="${criterios.filtro.nomeTipoConsultaOrigem}" tipo="String" />
        </j:if>
      ]]>
		</command>
	</query>

	<query name="PROCURAR_PESSOA_EXTERNO_CAPES">
		<use-case name="Procurar pessoa externo CAPES"></use-case>
		<description>Consulta do novo componente de procurar pessoa externo
		</description>
		<command>
      <![CDATA[
      FROM br.com.sicoob.capes.negocio.entidades.vigente.PessoaCompartilhamento pessoaCompartilhamento 
      INNER JOIN pessoaCompartilhamento.pessoa pessoa
      INNER JOIN pessoaCompartilhamento.transicoes transicoes
      
      <j:if test="${criterios.filtro != null and criterios.filtro.procurarBancoob != null and criterios.filtro.procurarBancoob}">
        INNER JOIN pessoaCompartilhamento.transicoes transicoes2
      </j:if>
    
      <j:if test="${criterios.filtro != null and criterios.filtro.somenteClientes != null}">
        LEFT JOIN pessoa.instituicoesNegocio pessoaInstituicao WITH pessoaInstituicao.idInstituicao = ${criterios.filtro.idInstituicao}
      </j:if>
      
      WHERE transicoes.instituicao.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.idInstituicao}" tipo="Integer" />
      
      <j:if test="${criterios.filtro.nome != null and criterios.filtro.nome != ''}">
        AND pessoaCompartilhamento.nomePessoa like <bancoob:valorOql valor="${criterios.filtro.nome}" tipo="LikeDireita" />
      </j:if>
      
      <j:if test="${criterios.filtro.cpfCnpj != null and criterios.filtro.cpfCnpj != ''}">
        AND pessoa.cpfCnpj = <bancoob:valorOql valor="${criterios.filtro.cpfCnpj}" tipo="String" />
      </j:if>
      
      <j:if test="${criterios.filtro.apelido != null and criterios.filtro.apelido != ''}">
        AND pessoaCompartilhamento.nomeApelido like <bancoob:valorOql valor="${criterios.filtro.apelido}" tipo="LikeDireita" />
      </j:if>
      
      <j:if test="${criterios.filtro != null and criterios.filtro.procurarBancoob != null and criterios.filtro.procurarBancoob}">
        AND transicoes2.instituicao.idInstituicao = 1
      </j:if>
      
      <j:if test="${criterios.filtro != null and criterios.filtro.somenteClientes == false}">
        AND pessoaInstituicao.pessoa IS NULL
      </j:if>
      
      <j:if test="${criterios.filtro != null and criterios.filtro.somenteClientes == true}">
        AND pessoaInstituicao.pessoa IS NOT NULL
      </j:if>
      
      <j:if test="${criterios.filtro != null and criterios.filtro.idTipoPessoa != null}">
        AND pessoa.tipoPessoa.codTipoPessoa = <bancoob:valorOql valor="${criterios.filtro.idTipoPessoa}" tipo="Short" />
      </j:if>
      
      <j:if test="${criterios.filtro != null and criterios.filtro.idPessoa != null}">
        AND pessoa.idPessoa = <bancoob:valorOql valor="${criterios.filtro.idPessoa}" tipo="Integer" />
      </j:if>
      
      ]]>
		</command>
		<projecao>
			SELECT new br.com.sicoob.capes.comum.negocio.vo.ProcurarPessoaExternoVO(
			pessoa.idPessoa, pessoa.cpfCnpj, pessoaCompartilhamento.nomePessoa,
			pessoaCompartilhamento.nomeApelido, transicoes.idPessoaLegado,
			pessoa.tipoPessoa.codTipoPessoa)
		</projecao>
		<ordenacoes>
			<ordenacao chave="nomePessoa" default="true">
        <![CDATA[ORDER BY pessoaCompartilhamento.nomePessoa]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="OBTER_SIGLAS_PROCESSO">
		<use-case name="Autorização" />
		<description></description>
		<command>
    <![CDATA[
      SELECT DISTINCT dados.siglaProcesso
      FROM br.com.sicoob.capes.negocio.entidades.DadosConfiguracaoFluxo dados
    ]]>
		</command>
	</query>

	<query name="PESQUISAR_VINCULO_EMPREGATICIO">
		<use-case name="Manter vínculo empregatício."></use-case>
		<description>Pesquisa os vínculos empregatícios</description>
		<command>
      <![CDATA[
      FROM br.com.sicoob.capes.negocio.entidades.VinculoEmpregaticio vinculo
      ]]>
		</command>
		<projecao>SELECT vinculo</projecao>
		<ordenacoes>
			<ordenacao chave="padrao" default="true">
        <![CDATA[order by vinculo.codigo]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISAR_PROXIMO_CODIGO_VINCULO_EMPREGATICIO">
		<use-case name="Manter vínculo empregatício" />
		<description>Pesquisa o próximo código disponível para a tabela de
			Vínculo Empregatício</description>
		<command>
      <![CDATA[
      SELECT v.CODVINCULOEMPREGATICIO + 1
      from cli.VINCULOEMPREGATICIO v
      left join cli.VINCULOEMPREGATICIO b on v.CODVINCULOEMPREGATICIO + 1 = b.CODVINCULOEMPREGATICIO
      where b.CODVINCULOEMPREGATICIO is null
      fetch first 1 row only
      ]]>
		</command>
	</query>

	<query name="PESQUISAR_TIPO_EMPRESA">
		<use-case name="Manter Tipo Empresa"></use-case>
		<description>Pesquisa os tipos de empresa</description>
		<command>
      <![CDATA[
		FROM br.com.sicoob.capes.negocio.entidades.TipoEmpresa tipoEmpresa
		WHERE 
			1=1
		<j:if test="${criterios.filtro.ativo != null}">
			AND tipoEmpresa.ativo = <bancoob:valorOql valor="${criterios.filtro.ativo}" tipo="Boolean" />
		</j:if>
      ]]>
		</command>
		<projecao>SELECT tipoEmpresa</projecao>
		<ordenacoes>
			<ordenacao chave="padrao" default="true">
        <![CDATA[order by tipoEmpresa.codigo]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISAR_TIPO_EMPRESA_POR_FAIXA_DE_RENDA_ANUAL">
		<use-case name="Manter Tipo Empresa"></use-case>
		<description>Pesquisa os tipos de empresa por renda anual
		</description>
		<command>
      <![CDATA[
		SELECT * FROM CLI.TIPOEMPRESA TE
		WHERE 
			1=1
			AND TE.BOLATIVO = 1
		<j:if test="${rendaAnual != null}">
			AND <bancoob:valor valor="${rendaAnual}" tipo="BigDecimal" /> BETWEEN TE.VALORLIMITEINFERIORFATURAMENTO AND TE.VALORLIMITESUPERIORFATURAMENTO
		</j:if>
		<j:if test="${isSimplesNacional != null}">
			AND TE.BOLHABILITASIMPLESNACIONAL = <bancoob:valor valor="${isSimplesNacional}" tipo="Boolean" />
		</j:if>
      ]]>
		</command>
		<projecao>SELECT tipoEmpresa</projecao>
		<ordenacoes>
			<ordenacao chave="padrao" default="true">
        <![CDATA[order by tipoEmpresa.codigo]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISAR_PROXIMO_CODIGO_TIPO_EMPRESA">
		<use-case name="Manter Tipo Empresa" />
		<description>Pesquisa o próximo código disponível para a tabela de
			Tipos de empresas</description>
		<command>
      <![CDATA[
      SELECT v.CODTIPOEMPRESA + 1
      from cli.TIPOEMPRESA v
      left join cli.TIPOEMPRESA b on v.CODTIPOEMPRESA + 1 = b.CODTIPOEMPRESA
      where b.CODTIPOEMPRESA is null
      fetch first 1 row only
      ]]>
		</command>
	</query>

	<query name="OBTER_CENTRAIS">
		<use-case name="Componente de centrais e singulares" />
		<description>Obtém as centrais para o componente 'centrais e
			singulares' utilizado nos relatórios</description>
		<command>
      <![CDATA[
        SELECT V2.IDINSTITUICAO, 
        CASE 
                WHEN V2.IDINSTITUICAO = 1 THEN 1
                ELSE COALESCE(V2.NUMCOOPERATIVA,0)
        END NUMCOOPERATIVA
		FROM SCI.VIW_INSTITUICAO V2,
				(
				SELECT V1.CODTIPOGRAUCOOP, V1.IDINSTITUICAO, V1.NUMCOOPPAI, V1.NUMCOOPERATIVA
				FROM SCI.VIW_INSTITUICAO V1
				WHERE V1.CODTIPOUNIDADE = 1 AND V1.IDINSTITUICAO = <bancoob:valor valor="${idInstituicaoLogada}" />
				) Q1
		WHERE V2.CODTIPOUNIDADE = 1 AND
				(       -- QUANDO A INSTITUIÇÃO É UMA CONFEDERAÇÃO
				 (Q1.CODTIPOGRAUCOOP = 3 AND (V2.CODTIPOGRAUCOOP IN (1) OR V2.IDINSTITUICAO = Q1.IDINSTITUICAO OR V2.IDINSTITUICAO = 1))
				 OR     -- QUANDO A INSTITUIÇÃO É UMA CENTRAL
				 (Q1.CODTIPOGRAUCOOP = 1 AND V2.NUMCOOPERATIVA = Q1.NUMCOOPERATIVA)
				 OR     -- QUANDO A INSTITUIÇÃO É UMA SINGULAR
				 (Q1.CODTIPOGRAUCOOP = 2 AND V2.NUMCOOPERATIVA = Q1.NUMCOOPPAI)
				 OR     -- QUANDO A INSTITUIÇÃO É O BANCOOB
				 (Q1.IDINSTITUICAO = 1 AND (V2.IDINSTITUICAO = Q1.IDINSTITUICAO OR V2.CODTIPOGRAUCOOP IN (1) OR V2.IDINSTITUICAO = 2))
				)
		GROUP BY V2.IDINSTITUICAO, V2.NUMCOOPERATIVA
		ORDER BY 2
      ]]>
		</command>
	</query>

	<query name="OBTER_SINGULARES">
		<use-case name="Componente de centrais e singulares" />
		<description>Obtém as singulares para o componente 'centrais e
			singulares' utilizado nos relatórios</description>
		<command>
      <![CDATA[
		SELECT INST1.IDINSTITUICAO,
		CASE 
			WHEN INST1.IDINSTITUICAO = 1 THEN 1
			ELSE COALESCE(INST1.NUMCOOPERATIVA, 0 )
			END NUMCOOPERATIVA,
			INST1.NUMCOOPPAI
		FROM SCI.VIW_INSTITUICAO INST1
		WHERE INST1.CODTIPOUNIDADE = 1
		<j:choose>
			<j:when test="${numeroCooperativa == 1}">
				AND INST1.IDINSTITUICAO = <bancoob:valor valor="${numeroCooperativa}" />
			</j:when>
			<j:otherwise>
				AND INST1.CODTIPOGRAUCOOP IN (1, 2, 3) AND (INST1.NUMCOOPERATIVA = <bancoob:valor valor="${numeroCooperativa}" /> OR INST1.NUMCOOPPAI = <bancoob:valor valor="${numeroCooperativa}" />)
			</j:otherwise>
		</j:choose>
		ORDER BY 2		
      ]]>
		</command>
	</query>

	<query name="OBTER_PACS">
		<use-case name="Componente de centrais e singulares" />
		<description>Obtém os pacs de uma singular para o componente 'centrais
			e singulares' utilizado nos relatórios</description>
		<command>
      <![CDATA[
        SELECT IDUNIDADEINST,
	           DESCNOMECOOP
        FROM SCI.VIW_INSTITUICAO
          WHERE CASE IDINSTITUICAO
          WHEN 1 THEN 1
             ELSE COALESCE(NUMCOOPERATIVA,0)
          END = <bancoob:valor valor="${numeroCooperativa}" />
        ORDER BY 1
      ]]>
		</command>
	</query>

	<query name="PESQUISAR_MAPA_TIPO_ANOTACAO">
		<use-case name="Anotações" />
		<description>Lista os registros do mapa de tipo de anotação
		</description>
		<command><![CDATA[
      FROM br.com.sicoob.capes.negocio.entidades.MapaTipoAnotacao mapa
    ]]></command>
		<projecao>SELECT mapa</projecao>
		<ordenacoes>
			<ordenacao chave="tipoAnotacao" default="true">
        <![CDATA[ORDER BY mapa.tipoAnotacao.descTipoAnotacao]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="CONSULTA_PESSOA_POR_CPF_CNPJ_UR">
		<use-case name="Cadastro pessoa"></use-case>
		<description>Consulta se o CPF/CNPJ já foi incluído</description>
		<command>
      <![CDATA[
        SELECT P.IDPESSOA
        FROM CLI.PESSOA P
        WHERE P.NUMCPFCNPJ = <bancoob:valor valor="${cpfcnpj}" />
        WITH UR
      ]]>
		</command>
	</query>

	<query name="CONSULTAR_INFORMACAO_UTILIZADA">
		<use-case name="Informacao Utilizada Pessoa"></use-case>
		<description>Verifica se a informação está sendo utilizada por outros
			sistemas</description>
		<command>
      <![CDATA[
        SELECT utilizaInformacao.descricao
        FROM br.com.sicoob.capes.negocio.entidades.InformacaoUtilizada informacao
		INNER JOIN informacao.utilizaInformacao utilizaInformacao
        WHERE informacao.pk.codigoInformacao = <bancoob:valorOql valor="${codigoInformacao}" tipo="Long" />
        AND informacao.pk.codigoTipoInformacao = <bancoob:valorOql valor="${codigoTipoInformacao}" tipo="Short" />
      ]]>
		</command>
	</query>

	<query name="OBTER_INFORMACAO_UTILIZADA">
		<use-case name="Informacao Utilizada Pessoa"></use-case>
		<description>Obtém a informação utilizada</description>
		<command>
      <![CDATA[
        FROM br.com.sicoob.capes.negocio.entidades.InformacaoUtilizada informacao
        WHERE 1=1
        
        <j:if test="${criterios.filtro.pk.codigoInformacao != null}">
          AND informacao.pk.codigoInformacao = <bancoob:valorOql valor="${criterios.filtro.pk.codigoInformacao}" tipo="Long" />
        </j:if>
        
        <j:if test="${criterios.filtro.pk.codigoTipoInformacao != null}">
          AND informacao.pk.codigoTipoInformacao = <bancoob:valorOql valor="${criterios.filtro.pk.codigoTipoInformacao}" tipo="Short" />
        </j:if>
        
        <j:if test="${criterios.filtro.pk.codigoUtilizaInformacao != null}">
          AND informacao.pk.codigoUtilizaInformacao = <bancoob:valorOql valor="${criterios.filtro.pk.codigoUtilizaInformacao}" tipo="Short" />
        </j:if>
      ]]>
		</command>
		<projecao>
			SELECT informacao
		</projecao>
	</query>

	<query name="PESQUISAR_DESTINO_EXPORTACAO">
		<use-case name="Destino Exportação" />
		<description>Pesquisa o destino das exportações</description>
		<command>
      <![CDATA[
        FROM br.com.sicoob.capes.negocio.entidades.DestinoExportacao destinoExportacao
        WHERE 1 = 1
        
	    <j:if test="${criterios.filtro.codigo != null}">
          AND destinoExportacao.codigo = <bancoob:valorOql valor="${criterios.filtro.codigo}" tipo="Short" />
        </j:if>
            
        <j:if test="${criterios.filtro.descricao != null}">
          AND destinoExportacao.descricao = <bancoob:valorOql valor="${criterios.filtro.descricao}" tipo="String" />
	    </j:if>
            
        <j:if test="${criterios.filtro.diretorio != null}">
          AND destinoExportacao.diretorio = <bancoob:valorOql valor="${criterios.filtro.diretorio}" tipo="String" />
        </j:if>
            
        <j:if test="${criterios.filtro.ativo != null}">
          AND destinoExportacao.ativo = <bancoob:valorOql valor="${criterios.filtro.ativo}" tipo="Boolean" />
	    </j:if>
      ]]>
		</command>
		<projecao>
			SELECT destinoExportacao
		</projecao>
		<ordenacoes>
			<ordenacao chave="codigo" default="true">
				ORDER BY destinoExportacao.codigo
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISA_EXPORTACAO_POR_FILTRO">
		<use-case name="Exportação de arquivos" />
		<description>Pesquisa EXPORTACAO por filtro</description>
		<command>
      <![CDATA[
        FROM 
            br.com.sicoob.capes.negocio.entidades.Exportacao e
        INNER JOIN 
            e.destino d
        WHERE 
            (1 = 1)
      <j:if test="${criterios.filtro.destino.codigo != null}">
        AND d.codigo = <bancoob:valorOql valor="${criterios.filtro.destino.codigo}" tipo="Short" />
      </j:if> 
      <j:if test="${criterios.filtro.dataMovimento != null}">
        AND e.dataMovimento = <bancoob:valorOql valor="${criterios.filtro.dataMovimento}" tipo="Date" />
      </j:if> 
      ]]>
		</command>
		<projecao>SELECT e</projecao>
	</query>

	<query name="CONSULTAR_TIPOS_INFORMACAO">
		<use-case name="Tipo Informação"></use-case>
		<description>Consulta os tipos de informação</description>
		<command>
      <![CDATA[
        FROM br.com.sicoob.capes.negocio.entidades.TipoInformacao tipoInformacao
        WHERE 1=1
        
        <j:if test="${criterios.filtro.codigo != null}">
          AND tipoInformacao.codigo = <bancoob:valorOql valor="${criterios.filtro.codigo}" tipo="Short" />
        </j:if>
        
        <j:if test="${criterios.filtro.descricao != null}">
          AND tipoInformacao.descricao = <bancoob:valorOql valor="${criterios.filtro.descricao}" tipo="String" />
        </j:if>
        
        <j:if test="${criterios.filtro.informacaoExportacao != null}">
          AND tipoInformacao.informacaoExportacao = <bancoob:valorOql valor="${criterios.filtro.informacaoExportacao}" tipo="Boolean" />
        </j:if>
        
        <j:if test="${criterios.filtro.informacaoObrigatoriaExportacao != null}">
          AND tipoInformacao.informacaoObrigatoriaExportacao = <bancoob:valorOql valor="${criterios.filtro.informacaoObrigatoriaExportacao}" tipo="Boolean" />
        </j:if>
      ]]>
		</command>
		<projecao>SELECT tipoInformacao</projecao>
	</query>

	<query name="OBTER_NUMERO_SEQUENCIAL_EXPORTACAO">
		<use-case name="Exportação de arquivos" />
		<description>Obtém o próximo número sequencial</description>
		<command>
      <![CDATA[
          SELECT (MAX(e.numeroArquivo) + 1)
          FROM br.com.sicoob.capes.negocio.entidades.Exportacao e
          WHERE e.destino.codigo = <bancoob:valorOql valor="${destinoExportacao}" tipo="Short" />
      ]]>
		</command>
	</query>

	<query name="PESQUISAR_DADOS_ARQUIVO_EXPORTACAO">
		<use-case name="Exportação de arquivos" />
		<description>Pesquisa os dados do arquivo pela exportação
		</description>
		<command>
      <![CDATA[
        FROM 
            br.com.sicoob.capes.negocio.entidades.DadosArquivoExportacao dadosArquivo
        WHERE 
            (1 = 1)
        <j:if test="${criterios.filtro.pk.idExportacao != null}">
          AND dadosArquivo.pk.idExportacao = <bancoob:valorOql valor="${criterios.filtro.pk.idExportacao}" tipo="Integer" />
        </j:if> 
      ]]>
		</command>
		<projecao>SELECT dadosArquivo</projecao>
	</query>

	<query name="OBTER_CODIGO_TIPOS_INFORMACAO_DADOS_ARQUIVO">
		<use-case name="Exportação de arquivos" />
		<description>Obtém os códigos gerados na tabela dados aquivo para a
			exportação</description>
		<command>
      <![CDATA[
        SELECT DISTINCT
          new br.com.sicoob.capes.negocio.entidades.TipoInformacao (
            CASE 
                WHEN SUBSTR(dadosArquivo.linha,1,2) = '01' THEN CAST(8 as int) 
                WHEN SUBSTR(dadosArquivo.linha,1,2) = '02' THEN CAST(8 as int) 
                WHEN SUBSTR(dadosArquivo.linha,1,2) = '03' THEN CAST(2 as int) 
                WHEN SUBSTR(dadosArquivo.linha,1,2) = '04' THEN CAST(3 as int) 
                WHEN SUBSTR(dadosArquivo.linha,1,2) = '05' THEN CAST(4 as int) 
                WHEN SUBSTR(dadosArquivo.linha,1,2) = '06' THEN CAST(5 as int) 
                WHEN SUBSTR(dadosArquivo.linha,1,2) = '07' THEN CAST(6 as int) 
                WHEN SUBSTR(dadosArquivo.linha,1,2) = '20' THEN CAST(7 as int) 
                ELSE CAST(SUBSTR(dadosArquivo.linha,1,2) as int) 
            END
          )
        FROM 
            br.com.sicoob.capes.negocio.entidades.DadosArquivoExportacao dadosArquivo
        WHERE 
            dadosArquivo.pk.idExportacao = <bancoob:valorOql valor="${idExportacao}" tipo="Integer" />
      ]]>
		</command>
	</query>

	<query name="OBTER_NUMERO_LINHA_DADOS_ARQUIVO">
		<use-case name="Exportação de arquivos" />
		<description>Obtém o próximo número de linha dos dados de arquivo
		</description>
		<command>
      <![CDATA[
          SELECT (MAX(dadosExportacao.pk.numeroLinha) + 1)
          FROM br.com.sicoob.capes.negocio.entidades.DadosArquivoExportacao dadosExportacao
          WHERE dadosExportacao.pk.idExportacao = <bancoob:valorOql valor="${idExportacao}" tipo="Integer" />
      ]]>
		</command>
	</query>

	<query name="PESQUISAR_OCUPACAO_PROFISSINAL">
		<use-case name="Ocupação Profissional" />
		<description>Pesquisa geral de ocupação profissional</description>
		<command>
      <![CDATA[
        FROM br.com.sicoob.capes.negocio.entidades.OcupacaoProfissional ocupacaoProfissional
        WHERE 1=1
        
        <j:if test="${criterios.filtro.idOcupacaoProfissional != null}">
          AND ocupacaoProfissional.idOcupacaoProfissional = <bancoob:valorOql valor="${criterios.filtro.idOcupacaoProfissional}" tipo="Integer" />
        </j:if>
        
        <j:if test="${criterios.filtro.codigo != null}">
          AND ocupacaoProfissional.codigo = <bancoob:valorOql valor="${criterios.filtro.codigo}" tipo="String" />
        </j:if>
        
        <j:if test="${criterios.filtro.codigoPai != null}">
          AND ocupacaoProfissional.codigoPai = <bancoob:valorOql valor="${criterios.filtro.codigoPai}" tipo="String" />
        </j:if>
        
        <j:if test="${criterios.filtro.descricao != null}">
          AND ocupacaoProfissional.descricao like <bancoob:valorOql valor="${criterios.filtro.descricao}" tipo="LikeDireita" />
        </j:if>
        
        <j:if test="${criterios.filtro.codigoTipoOcupacao != null}">
          AND ocupacaoProfissional.codigoTipoOcupacao = <bancoob:valorOql valor="${criterios.filtro.codigoTipoOcupacao}" tipo="Short" />
        </j:if>
        
        <j:if test="${criterios.filtro.ativo != null}">
          AND ocupacaoProfissional.ativo = <bancoob:valorOql valor="${criterios.filtro.ativo}" tipo="Boolean" />
        </j:if>
      ]]>
		</command>
	</query>

	<query name="TIPO_ANOTACAO_POSSUI_RESTRICAO">
		<use-case name="Anotações" />
		<description>Verifica se o tipo da anotação possui restrição para a
			cooperativa logada</description>
		<command>
      <![CDATA[
          SELECT COUNT(1)
          FROM CLI.COOPERATIVAANOTACAO CA
          WHERE CA.CODTIPOANOTACAO = <bancoob:valor valor="${idTipoAnotacao}" tipo="Integer" />
          AND CA.IDINSTITUICAO = <bancoob:valor valor="${idInstituicao}" tipo="Integer" />
      ]]>
		</command>
	</query>

	<query name="OBTER_FILIAIS">
		<use-case name="Pesquisar filiais de um cnpj" />
		<description>Obtém as filiais de uma instituição apartir do CNPJ
		</description>
		<command>
      <![CDATA[
          FROM 
              br.com.sicoob.capes.negocio.entidades.vigente.PessoaCompartilhamento pessoaCompartilhamento
          WHERE 
              pessoaCompartilhamento.pessoa.tipoPessoa = 1
          AND
              pessoaCompartilhamento.pessoa.cpfCnpj like <bancoob:valorOql valor="${cnpj}" tipo="LikeDireita"/>
          AND
              pessoaCompartilhamento.compartilhamento.codigo = <bancoob:valorOql valor="${codCompartilhamentoCadastro}" tipo="Short" /> 
      ]]>
		</command>
	</query>

	<query name="BAIXAR_ANOTACOES_FILIAIS">
		<use-case name="Anotação" />
		<description>Baixa as anotações da matriz e de suas filiais
		</description>
		<command>
      <![CDATA[
      UPDATE 
          CLI.ANOTACAO
      SET 
          IDTIPOBAIXA = <bancoob:valor valor="${idTipoBaixa}" tipo="Short" />,
          DATAHORABAIXA = <bancoob:valor valor="${dataHoraBaixa}" tipo="Date" />,
          IDUSUARIOALT = <bancoob:valor valor="${usuarioBaixa}" tipo="String" />
      WHERE
          IDPESSOACOMPARTILHAMENTO IN (<bancoob:valor valor="${filiais}" />)
      AND IDTIPOANOTACAO = <bancoob:valor valor="${idTipoAnotacao}" tipo="Integer" />
      ]]>
		</command>
	</query>

	<query name="FLEXIBILIZAR_ANOTACOES_FILIAIS">
		<use-case name="Anotação" />
		<description>Flexibiliza as anotações da matriz e de suas filiais
		</description>
		<command>
      <![CDATA[
      UPDATE 
          CLI.ANOTACAO
      SET 
          DATAHORAALTERACAO = <bancoob:valor valor="${dataHoraAlteracao}" tipo="Date" />,
          IDUSUARIOALT = <bancoob:valor valor="${usuarioAlteracao}" tipo="String" />,
          BOLFLEXIBILIDADE = <bancoob:valor valor="${flexibilizar}" tipo="Boolean" />
      WHERE
          IDPESSOACOMPARTILHAMENTO IN (<bancoob:valor valor="${filiais}" />)
      AND IDTIPOANOTACAO = <bancoob:valor valor="${idTipoAnotacao}" tipo="Integer" />
      ]]>
		</command>
	</query>

	<query name="PESQUISA_FUNCIONARIO_ASSOCIADO_CLIENTE_HISTORICO">
		<use-case name="Funcionario" />
		<description>Verifica se o funcionário a ser excluido já teve
			relacionamento com algum cliente</description>
		<command>
      <![CDATA[
      SELECT 
      		COUNT(*) AS QTD
      FROM 
      		CLI.HISTPESSOAINSTITUICAO
      WHERE
          IDFUNCIONARIORESPONSAVEL = <bancoob:valor valor="${funcionario.idFuncionario}" tipo="Integer" />
      ]]>
		</command>
	</query>

	<query name="PESQUISA_CODCOMPARTILHAMENTO_GRUPOCOMAPRTILHAMENTO">
		<use-case name="PesquisaCodigoCompartilhamento" />
		<description>Verifica qual o código compartilhamento da instituição
		</description>
		<command>
      <![CDATA[
    	 SELECT 
    	 	GC.CODCOMPARTILHAMENTOCADASTRO
		FROM 
			CLI.GRUPOCOMPARTILHAMENTO GC 
		WHERE 
			GC.IDINSTITUICAO = <bancoob:valor valor="${idInstituicao}" tipo="Integer" />
      ]]>
		</command>
	</query>

	<query name="CONSULTA_TIPO_DE_MENSAGEM_POR_DESTINO_EXIBICAO">
		<use-case name="ConsultaTipoMensagemPorDestinoExibicao" />
		<description>Consulta TipoMensagem por DestinoExibicao</description>
		<command>
      	<![CDATA[
         SELECT 
         	  itemTipoMensagem
    	 FROM 
              br.com.sicoob.capes.negocio.entidades.TipoDestinoExibicaoTipoMensagem tipoDestinoExibicaoTipoMensagem
              inner join tipoDestinoExibicaoTipoMensagem.tipoMensagem itemTipoMensagem
          WHERE 
              tipoDestinoExibicaoTipoMensagem.tipoDestinoExibicao.codTipoDestinoExibicao = <bancoob:valorOql valor="${codTipoDestinoExibicao}" tipo="Short"/>
      	]]>
		</command>
	</query>

	<query name="PESQUISAR_ATIVIDADE_ECONOMICA">
		<use-case name="Atividade Econômica" />
		<description>Atividade Econômica</description>
		<command>
      	<![CDATA[
        FROM br.com.sicoob.capes.negocio.entidades.AtividadeEconomica atividadeEconomica
        WHERE 1=1
        
        <j:if test="${criterios.filtro.codigo != null}">
          AND atividadeEconomica.codigo = <bancoob:valorOql valor="${criterios.filtro.codigo}" tipo="Short" />
        </j:if>
        
        <j:if test="${criterios.filtro.descricao != null}">
          AND atividadeEconomica.descricao like <bancoob:valorOql valor="${criterios.filtro.descricao}" tipo="LikeDireitaEsquerda" />
        </j:if>
      	]]>
		</command>
		<projecao>SELECT atividadeEconomica</projecao>
	</query>

	<query name="PESQUISA_TIPO_BENEFICIARIO_SICOR_POR_FILTRO">
		<use-case name="Produtor" />
		<description>Pesquisa de TipoBeneficiarioSicor por filtro
		</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.TipoBeneficiarioSicor tipoBeneficiarioSicor
				 WHERE 1=1
        
		        <j:if test="${criterios.filtro.codigo != null}">
		          AND tipoBeneficiarioSicor.codigo = <bancoob:valorOql valor="${criterios.filtro.codigo}" tipo="Short" />
		        </j:if>
		        
		        <j:if test="${criterios.filtro.descricao != null}">
		          AND tipoBeneficiarioSicor.descricao like <bancoob:valorOql valor="${criterios.filtro.descricao}" tipo="LikeDireita" />
		        </j:if>
			]]>
		</command>
	</query>

	<query name="OBTER_SAIDA_TIPO_ANOTACAO">
		<use-case name="Manter Tipo Anotacao"></use-case>
		<description>Obtem o texto de saida do Tipo Anotacao</description>
		<command>
	      <![CDATA[
	      	select descSaidaAnotacao from br.com.sicoob.capes.negocio.entidades.TipoAnotacao as tipo
	      	where tipo.codTipoAnotacao = <bancoob:valorOql valor="${criterio.codTipoAnotacao}" tipo="Integer" />
	      ]]>
		</command>
	</query>

	<query name="ATUALIZA_COD_TIPO_EMPRESA_POR_ID_PESSOA">
		<use-case name="Atualiza o código do Tipo Empresa"></use-case>
		<description>Atualiza o código do Tipo Empresa</description>
		<command>
	      <![CDATA[
			UPDATE CLI.PESSOAJURIDICA PJ
			SET PJ.CODTIPOEMPRESA = <bancoob:valor valor="${codTipoEmpresa}" tipo="Short" />
			WHERE PJ.IDPESSOACOMPARTILHAMENTO = <bancoob:valor valor="${idPessoaCompartilhamento}" tipo="Integer" />
	      ]]>
		</command>
	</query>

	<query name="PESQUISA_ID_PESSOA_INSTITUICAO_POR_LISTA_CPFCNPJ">
		<use-case name="Manter dados do cliente" />
		<description>Recupera a pessoa instiuicao</description>
		<command>
	      <![CDATA[ 
	        SELECT PI
            	FROM br.com.sicoob.capes.negocio.entidades.vigente.PessoaInstituicao PI
            	INNER JOIN PI.pessoa P
			WHERE 
				PI.idInstituicao = <bancoob:valorOql valor="${idInstituicaoUsuarioLogado}" tipo="Integer" />
				AND P.cpfCnpj IN (<bancoob:valorOql valor="${listaCpfCnpj}" tipo="List"/>)   
	      ]]>
		</command>
	</query>

	<query name="PESQUISA_TIPO_CLASSIFICACAO_BEM_POR_FILTRO">
		<use-case name="Manter TipoClassificacaoBem" />
		<description>Pesquisa de TipoClassificacaoBem por filtro</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.bem.TipoClassificacaoBem t
			]]>
		</command>
	</query>

	<query name="PESQUISA_TIPO_BEM_IMOVEL_POR_FILTRO">
		<use-case name="Manter TipoBemImovel" />
		<description>Pesquisa de TipoBemImovel por filtro</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.bem.TipoBemImovel t
			]]>
		</command>
	</query>

	<query name="PESQUISA_TIPO_BEM_MOVEL_POR_FILTRO">
		<use-case name="Manter TipoBemMovel" />
		<description>Pesquisa de TipoBemMovel por filtro</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.bem.TipoBemMovel t
			]]>
		</command>
	</query>

	<query name="PESQUISA_TIPO_LOCALIZACAO_BEM_POR_FILTRO">
		<use-case name="Manter TipoLocalizacaoBem" />
		<description>Pesquisa de TipoLocalizacaoBem por filtro</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.bem.TipoLocalizacaoBem t
			]]>
		</command>
	</query>

	<query name="PESQUISA_TIPO_USO_BEM_POR_FILTRO">
		<use-case name="Manter TipoUsoBem" />
		<description>Pesquisa de TipoUsoBem por filtro</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.bem.TipoUsoBemImovel tipoUsoBem
				WHERE 1=1
				<j:if test="${criterios.filtro.codigo != null}">
		          AND tipoUsoBem.codigo = <bancoob:valorOql valor="${criterios.filtro.codigo}" tipo="Short" />
		        </j:if>
		        
		        <j:if test="${criterios.filtro.descricao != null}">
		          AND tipoUsoBem.descricao = <bancoob:valorOql valor="${criterios.filtro.descricao}" tipo="String" />
		        </j:if>
				
				<j:if test="${criterios.filtro.tipoLocalizacaoBem != null}">
		          AND tipoUsoBem.tipoLocalizacaoBem.codigo = <bancoob:valorOql valor="${criterios.filtro.tipoLocalizacaoBem.codigo}" tipo="Short" />
		        </j:if>
			]]>
		</command>
		<projecao>SELECT tipoUsoBem</projecao>
	</query>

	<query name="PESQUISA_BEM_PESSOA_COMPARTILHAMENTO_POR_FILTRO">
		<use-case name="Manter BemPessoaCompartilhamento" />
		<description>Pesquisa de BemPessoaCompartilhamento por filtro
		</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.bem.BemPessoaCompartilhamento bemPessoaCompartilhamento
				WHERE 1=1
				
				<j:if test="${criterios.filtro.pessoaCompartilhamento != null}">
		        	AND bemPessoaCompartilhamento.pessoaCompartilhamento.idPessoaCompartilhamento = <bancoob:valorOql valor="${criterios.filtro.pessoaCompartilhamento.idPessoaCompartilhamento}" tipo="Long" />
		        </j:if>
		        
		        <j:if test="${criterios.filtro.bem != null}">
		        	AND bemPessoaCompartilhamento.bem.idBem = <bancoob:valorOql valor="${criterios.filtro.bem.idBem}" tipo="Long" />
		        </j:if>
			]]>
		</command>
		<projecao>SELECT bemPessoaCompartilhamento</projecao>
		<ordenacoes>
			<ordenacao chave="padrao" default="true">
				<![CDATA[ORDER BY bemPessoaCompartilhamento.bem.tipoClassificacaoBem]]>
			</ordenacao>
		</ordenacoes>
	</query>

	<query name="PESQUISA_BEM_IMOVEL_POR_FILTRO">
		<use-case name="Manter BemImovel" />
		<description>Pesquisa de BemImovel por filtro</description>
		<command>
			<![CDATA[
				SELECT bemImovel
				FROM br.com.sicoob.capes.negocio.entidades.bem.BemImovel bemImovel
				LEFT JOIN FETCH bemImovel.compartilhamentoCadastro compartilhamentoCadastro
				LEFT JOIN FETCH bemImovel.proprietarios proprietarios
				LEFT JOIN FETCH bemImovel.pessoaCompartilhamentoCartorio cartorio
				WHERE 1=1
				
				AND bemImovel.dataHoraInicio IS NOT NULL
				AND bemImovel.idInstituicaoAtualizacao IS NULL
				
				<j:if test="${criterios.filtro.idBem != null}">
		        	AND bemImovel.idBem = <bancoob:valorOql valor="${criterios.filtro.idBem}" tipo="Long" />
		        </j:if>
		        
		        <j:if test="${criterios.filtro.tipoLocalizacaoBem != null}">
		        	AND bemImovel.tipoLocalizacaoBem.codigo = <bancoob:valorOql valor="${criterios.filtro.tipoLocalizacaoBem.codigo}" tipo="Short" />
		        </j:if>
		        
		        <j:if test="${criterios.filtro.tipoUsoBem != null}">
		        	AND bemImovel.tipoUsoBem.codigo = <bancoob:valorOql valor="${criterios.filtro.tipoUsoBem.codigo}" tipo="Short" />
		        </j:if>
		        
		        <j:if test="${criterios.filtro.tipoBem != null}">
		        	AND bemImovel.tipoBem.codigo = <bancoob:valorOql valor="${criterios.filtro.tipoBem.codigo}" tipo="Short" />
		        </j:if>
		        
		        <j:if test="${criterios.filtro.descricao != null}">
		        	AND bemImovel.descricao like <bancoob:valorOql valor="${criterios.filtro.descricao}" tipo="LikeDireita" />
		        </j:if>
		        
		        <j:if test="${criterios.filtro.idPessoaCompartilhamentoCartorio != null}">
		        	AND bemImovel.idPessoaCompartilhamentoCartorio = <bancoob:valorOql valor="${criterios.filtro.idPessoaCompartilhamentoCartorio}" tipo="Long" />
		        </j:if>
		        
		        <j:if test="${criterios.filtro.matricula != null}">
		        	AND bemImovel.matricula = <bancoob:valorOql valor="${criterios.filtro.matricula}" tipo="String" />
		        </j:if>
		        
		        <j:choose>
					<j:when test="${criterios.filtro.nirf != null and criterios.filtro.incra != null}">
						AND (bemImovel.nirf = <bancoob:valorOql valor="${criterios.filtro.nirf}" tipo="String" />
						OR bemImovel.incra = <bancoob:valorOql valor="${criterios.filtro.incra}" tipo="String" />)
					</j:when>
					
					<j:when test="${criterios.filtro.nirf != null and criterios.filtro.incra == null}">
						AND bemImovel.nirf = <bancoob:valorOql valor="${criterios.filtro.nirf}" tipo="String" />
					</j:when>
					
					<j:when test="${criterios.filtro.incra != null and criterios.filtro.nirf == null}">
						AND bemImovel.incra = <bancoob:valorOql valor="${criterios.filtro.incra}" tipo="String" />
					</j:when>
				</j:choose>
			]]>
		</command>
	</query>

	<query name="PESQUISA_CONTADOR_BEM_IMOVEL_POR_FILTRO">
		<use-case name="Manter BemImovel" />
		<description>Pesquisa de BemImovel por filtro</description>
		<command>
			<![CDATA[
				SELECT COUNT(*)
				FROM br.com.sicoob.capes.negocio.entidades.bem.BemImovel bemImovel
				WHERE 1=1
				
				AND bemImovel.dataHoraInicio IS NOT NULL
				AND bemImovel.idInstituicaoAtualizacao IS NULL
				
				<j:if test="${criterios.filtro.idBem != null}">
		        	AND bemImovel.idBem = <bancoob:valorOql valor="${criterios.filtro.idBem}" tipo="Long" />
		        </j:if>
		        
		        <j:if test="${criterios.filtro.tipoLocalizacaoBem != null}">
		        	AND bemImovel.tipoLocalizacaoBem.codigo = <bancoob:valorOql valor="${criterios.filtro.tipoLocalizacaoBem.codigo}" tipo="Short" />
		        </j:if>
		        
		        <j:if test="${criterios.filtro.tipoUsoBem != null}">
		        	AND bemImovel.tipoUsoBem.codigo = <bancoob:valorOql valor="${criterios.filtro.tipoUsoBem.codigo}" tipo="Short" />
		        </j:if>
		        
		        <j:if test="${criterios.filtro.tipoBem != null}">
		        	AND bemImovel.tipoBem.codigo = <bancoob:valorOql valor="${criterios.filtro.tipoBem.codigo}" tipo="Short" />
		        </j:if>
		        
		        <j:if test="${criterios.filtro.descricao != null}">
		        	AND bemImovel.descricao like <bancoob:valorOql valor="${criterios.filtro.descricao}" tipo="LikeDireita" />
		        </j:if>
		        
		        <j:if test="${criterios.filtro.idPessoaCompartilhamentoCartorio != null}">
		        	AND bemImovel.idPessoaCompartilhamentoCartorio = <bancoob:valorOql valor="${criterios.filtro.idPessoaCompartilhamentoCartorio}" tipo="Long" />
		        </j:if>
		        
		        <j:if test="${criterios.filtro.matricula != null}">
		        	AND bemImovel.matricula = <bancoob:valorOql valor="${criterios.filtro.matricula}" tipo="String" />
		        </j:if>
		        
		        <j:choose>
					<j:when test="${criterios.filtro.nirf != null and criterios.filtro.incra != null}">
						AND (bemImovel.nirf = <bancoob:valorOql valor="${criterios.filtro.nirf}" tipo="String" />
						OR bemImovel.incra = <bancoob:valorOql valor="${criterios.filtro.incra}" tipo="String" />)
					</j:when>
					
					<j:when test="${criterios.filtro.nirf != null and criterios.filtro.incra == null}">
						AND bemImovel.nirf = <bancoob:valorOql valor="${criterios.filtro.nirf}" tipo="String" />
					</j:when>
					
					<j:when test="${criterios.filtro.incra != null and criterios.filtro.nirf == null}">
						AND bemImovel.incra = <bancoob:valorOql valor="${criterios.filtro.incra}" tipo="String" />
					</j:when>
				</j:choose>
			]]>
		</command>
	</query>

	<query name="PESQUISA_BEM_MOVEL_POR_FILTRO">
		<use-case name="Manter BemMovel" />
		<description>Pesquisa de BemMovel por filtro</description>
		<command>
			<![CDATA[
				SELECT bemMovel
				FROM br.com.sicoob.capes.negocio.entidades.bem.BemMovel bemMovel
				LEFT JOIN FETCH bemMovel.compartilhamentoCadastro compartilhamentoCadastro
				LEFT JOIN FETCH bemMovel.proprietarios proprietarios
				WHERE 1=1
				
				AND bemMovel.dataHoraInicio IS NOT NULL
				AND bemMovel.idInstituicaoAtualizacao IS NULL
								
				<j:if test="${criterios.filtro.idBem != null}">
		        	AND bemMovel.idBem = <bancoob:valorOql valor="${criterios.filtro.idBem}" tipo="Long" />
		        </j:if>
		        
		        <j:if test="${criterios.filtro.tipoBem != null}">
		        	AND bemMovel.tipoBem.codigo = <bancoob:valorOql valor="${criterios.filtro.tipoBem.codigo}" tipo="Short" />
		        </j:if>
		        
		        <j:if test="${criterios.filtro.descricao != null}">
		        	AND bemMovel.descricao like <bancoob:valorOql valor="${criterios.filtro.descricao}" tipo="LikeDireita" />
		        </j:if>
		        
		        <j:if test="${criterios.filtro.numeroChassi != null}">
		        	AND bemMovel.numeroChassi = <bancoob:valorOql valor="${criterios.filtro.numeroChassi}" tipo="String" />
		        </j:if>
		        
		        <j:if test="${criterios.filtro.renavam != null}">
		        	AND bemMovel.renavam = <bancoob:valorOql valor="${criterios.filtro.renavam}" tipo="String" />
		        </j:if>
		        
		         <j:if test="${criterios.filtro.inscricaoEmbarcacao != null}">
		        	AND bemMovel.inscricaoEmbarcacao = <bancoob:valorOql valor="${criterios.filtro.inscricaoEmbarcacao}" tipo="String" />
		        </j:if>
		        
		         <j:if test="${criterios.filtro.matriculaAeronave != null}">
		        	AND bemMovel.matriculaAeronave = <bancoob:valorOql valor="${criterios.filtro.matriculaAeronave}" tipo="String" />
		        </j:if>
			]]>
		</command>
	</query>
	
	<query name="PESQUISA_CONTADOR_BEM_MOVEL_POR_FILTRO">
		<use-case name="Manter BemMovel" />
		<description>Pesquisa de BemMovel por filtro</description>
		<command>
			<![CDATA[
				SELECT COUNT(*)
				FROM br.com.sicoob.capes.negocio.entidades.bem.BemMovel bemMovel
				WHERE 1=1
				
				AND bemMovel.dataHoraInicio IS NOT NULL
				AND bemMovel.idInstituicaoAtualizacao IS NULL
								
				<j:if test="${criterios.filtro.idBem != null}">
		        	AND bemMovel.idBem = <bancoob:valorOql valor="${criterios.filtro.idBem}" tipo="Long" />
		        </j:if>
		        
		        <j:if test="${criterios.filtro.tipoBem != null}">
		        	AND bemMovel.tipoBem.codigo = <bancoob:valorOql valor="${criterios.filtro.tipoBem.codigo}" tipo="Short" />
		        </j:if>
		        
		        <j:if test="${criterios.filtro.descricao != null}">
		        	AND bemMovel.descricao like <bancoob:valorOql valor="${criterios.filtro.descricao}" tipo="LikeDireita" />
		        </j:if>
		        
		        <j:if test="${criterios.filtro.numeroChassi != null}">
		        	AND bemMovel.numeroChassi = <bancoob:valorOql valor="${criterios.filtro.numeroChassi}" tipo="String" />
		        </j:if>
		        
		        <j:if test="${criterios.filtro.renavam != null}">
		        	AND bemMovel.renavam = <bancoob:valorOql valor="${criterios.filtro.renavam}" tipo="String" />
		        </j:if>
		        
		         <j:if test="${criterios.filtro.inscricaoEmbarcacao != null}">
		        	AND bemMovel.inscricaoEmbarcacao = <bancoob:valorOql valor="${criterios.filtro.inscricaoEmbarcacao}" tipo="String" />
		        </j:if>
		        
		         <j:if test="${criterios.filtro.matriculaAeronave != null}">
		        	AND bemMovel.matriculaAeronave = <bancoob:valorOql valor="${criterios.filtro.matriculaAeronave}" tipo="String" />
		        </j:if>
			]]>
		</command>
	</query>
	

	<query name="PESQUISA_TIPO_ESTADO_CONSERVACAO_POR_FILTRO">
		<use-case name="Manter TipoEstadoConservacao" />
		<description>Pesquisa de TipoEstadoConservacao por filtro
		</description>
		<command>
			<![CDATA[
				SELECT t
				FROM br.com.sicoob.capes.negocio.entidades.bem.TipoEstadoConservacaoBem t
				WHERE 1=1
				<j:if test="${bemImovel != null}">
                	AND t.bemImovel = <bancoob:valorOql valor="${bemImovel}" tipo="Boolean" />
				</j:if>
			]]>
		</command>
	</query>

	<query name="PESQUISA_TIPO_IMPLANTACAO_BEM_IMOVEL_POR_FILTRO">
		<use-case name="Manter TipoImplantacaoBemImovel" />
		<description>Pesquisa de TipoImplantacaoBemImovel por filtro
		</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.bem.TipoImplantacaoBemImovel t
			]]>
		</command>
	</query>

	<query name="PESQUISA_TIPO_PADRAO_ACABAMENTO_BEM_IMOVEL_POR_FILTRO">
		<use-case name="Manter TipoPadraoAcabamentoBemImovel" />
		<description>Pesquisa de TipoPadraoAcabamentoBemImovel por filtro
		</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.bem.TipoPadraoAcabamentoBemImovel t
			]]>
		</command>
	</query>

	<query name="PESQUISA_TIPO_SERVICO_CONDOMINIAL_BEM_IMOVEL_POR_FILTRO">
		<use-case name="Manter TipoServicoCondominialBemImovel" />
		<description>Pesquisa de TipoServicoCondominialBemImovel por filtro
		</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.bem.TipoServicoCondominialBemImovel t
			]]>
		</command>
	</query>

	<query name="PESQUISA_TIPO_RELACIONAMENTO_BEM_IMOVEL_POR_FILTRO">
		<use-case name="Manter TipoRelacionamentoBemImovel" />
		<description>Pesquisa de TipoRelacionamentoBemImovel por filtro
		</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.bem.TipoRelacionamentoBemImovel t
			]]>
		</command>
	</query>

	<query name="PESQUISA_TIPO_ONUS_BEM_POR_FILTRO">
		<use-case name="Manter TipoOnusBem" />
		<description>Pesquisa de TipoOnusBem por filtro</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.bem.TipoOnusBem t
			]]>
		</command>
	</query>

	<query name="PESQUISA_TIPO_CHASSI_BEM_POR_FILTRO">
		<use-case name="Manter TipoChassiBem" />
		<description>Pesquisa de TipoChassiBem por filtro</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.bem.TipoChassiBem t
			]]>
		</command>
	</query>

	<query name="PESQUISA_TIPO_COR_AUTOMOVEL_BEM_POR_FILTRO">
		<use-case name="Manter TipoCorAutomovelBem" />
		<description>Pesquisa de TipoCorAutomovelBem por filtro</description>
		<command>
			<![CDATA[
				FROM br.com.sicoob.capes.negocio.entidades.bem.TipoCorAutomovelBem t
			]]>
		</command>
	</query>

	<query name="OBTER_PROPRIETARIOS_BEM">
		<use-case name="Manter bem" />
		<description>Pesquisa de proprietários do bem</description>
		<command>
			<![CDATA[
				SELECT new br.com.sicoob.capes.cadastro.negocio.vo.ProprietarioBemVO(
					bemPessoaCompartilhamento.idBemPessoaCompartilhamento,
					pessoaCompartilhamento.idPessoaCompartilhamento,
					pessoaCompartilhamento,
					pessoa.cpfCnpj,
					pessoa.tipoPessoa.codTipoPessoa,
					pessoaCompartilhamento.nomePessoa,
					bemPessoaCompartilhamento.percentualProprietario,
					bemPessoaCompartilhamento.marcadoExclusao
				)
				FROM br.com.sicoob.capes.negocio.entidades.bem.BemPessoaCompartilhamento bemPessoaCompartilhamento
				INNER JOIN bemPessoaCompartilhamento.bem bem
				INNER JOIN bemPessoaCompartilhamento.pessoaCompartilhamento pessoaCompartilhamento
				INNER JOIN pessoaCompartilhamento.pessoa pessoa
				WHERE bem.idBem = <bancoob:valorOql valor="${idBem}" tipo="Long" />
			]]>
		</command>
	</query>

	<query name="OBTER_PARTICIPANTES_BEM_IMOVEL">
		<use-case name="Manter bem" />
		<description>Pesquisa de participantes do bem imóvel</description>
		<command>
			<![CDATA[
				SELECT new br.com.sicoob.capes.cadastro.negocio.vo.ProprietarioBemVO(
					relacionamento.pessoaCompartilhamento.pessoa.cpfCnpj,
					relacionamento.pessoaCompartilhamento.pessoa.tipoPessoa.codTipoPessoa,
					relacionamento.pessoaCompartilhamento.nomePessoa,
					relacionamento.areaPosse,
					bemImovel.areaTotal,
					relacionamento.tipoRelacionamento.descricao
				)
				FROM br.com.sicoob.capes.negocio.entidades.bem.BemImovel bemImovel
				INNER JOIN bemImovel.relacionamentoPessoas relacionamento
				WHERE bemImovel.idBem = <bancoob:valorOql valor="${idBem}" tipo="Long" />
			]]>
		</command>
	</query>

	<query name="OBTER_VALORES_BEM_PESSOA">
		<use-case name="Manter bem" />
		<description>Pesquisa os valores totais dos bens de uma pessoa.
		</description>
		<command>
			<![CDATA[
				SELECT
					SUM(CASE WHEN (BMA.IDBEM IS NOT NULL AND BMA.BOLEMPROCESSOAQUISICAO = 0) THEN (BMA.VALORAVALIACAO * BPC.PERCPROPRIETARIO / 100) ELSE 0 END) AS TOTAL_MOVEL_AVALIADO,
					SUM(CASE WHEN (BIA.IDBEM IS NOT NULL AND BIA.BOLEMPROCESSOAQUISICAO = 0) THEN (BIA.VALORAVALIACAO * BPC.PERCPROPRIETARIO / 100) ELSE 0 END) AS TOTAL_IMOVEL_AVALIADO,
					SUM(CASE WHEN (B.CODTIPOCLASSIFICACAOBEM = 2 AND (BMA.IDBEM IS NULL OR BMA.BOLEMPROCESSOAQUISICAO = 0)) THEN (B.VALORBEM * BPC.PERCPROPRIETARIO / 100) ELSE 0 END) AS TOTAL_MOVEL_DECLARADO,
					SUM(CASE WHEN (B.CODTIPOCLASSIFICACAOBEM = 1 AND (BIA.IDBEM IS NULL OR BIA.BOLEMPROCESSOAQUISICAO = 0)) THEN (B.VALORBEM * BPC.PERCPROPRIETARIO / 100) ELSE 0 END) AS TOTAL_IMOVEL_DECLARADO,
					SUM(CASE WHEN ((B.CODTIPOCLASSIFICACAOBEM = 2 AND BMA.IDBEM IS NULL OR BMA.BOLEMPROCESSOAQUISICAO = 0) OR (B.CODTIPOCLASSIFICACAOBEM = 1 AND BIA.IDBEM IS NULL OR BIA.BOLEMPROCESSOAQUISICAO = 0)) THEN (B.VALORBEM * BPC.PERCPROPRIETARIO / 100) ELSE 0 END) AS TOTAL_DECLARADO,
					(SUM(CASE WHEN (BMA.IDBEM IS NOT NULL AND BMA.BOLEMPROCESSOAQUISICAO = 0) THEN (BMA.VALORAVALIACAO * BPC.PERCPROPRIETARIO / 100) ELSE 0 END) +
					SUM(CASE WHEN (BIA.IDBEM IS NOT NULL AND BIA.BOLEMPROCESSOAQUISICAO = 0) THEN (BIA.VALORAVALIACAO * BPC.PERCPROPRIETARIO / 100) ELSE 0 END)) AS TOTAL_AVALIADO
				FROM CLI.BEMPESSOACOMPARTILHAMENTO BPC
				INNER JOIN CLI.BEM B ON B.IDBEM = BPC.IDBEM
				LEFT JOIN CLI.BEMIMOVELAVALIACAO BIA ON BIA.IDBEM = B.IDBEM
				LEFT JOIN CLI.BEMMOVELAVALIACAO BMA ON BMA.IDBEM = B.IDBEM
				WHERE B.BOLBEMINTERNO = 0
				AND B.DATAHORAINICIO IS NOT NULL
				AND B.IDINSTITUICAOATUALIZACAO IS NULL
				AND BPC.IDPESSOACOMPARTILHAMENTO = <bancoob:valor valor="${idPessoaCompartilhamento}" tipo="Long" />
			]]>
		</command>
	</query>

	<query name="OBTER_ID_BEM_SEM_PATRIMONIO">
		<use-case name="Manter bem" />
		<description>Obtém o id do bem 'sem patrimônio'</description>
		<command>
			<![CDATA[
				SELECT bem.idBem
				FROM br.com.sicoob.capes.negocio.entidades.bem.Bem bem
				WHERE bem.interno = TRUE
				AND bem.descricao = 'NÃO POSSUI PATRIMÔNIO'
				AND bem.codCompartilhamentoCadastro = <bancoob:valorOql valor="${codigoCompartilhamentoCadastro}" tipo="Short" />
			]]>
		</command>
	</query>

	<query name="OBTER_ID_BEM_RECUSOU_SE_INFORMAR">
		<use-case name="Manter bem" />
		<description>Obtém o id do bem 'recusou-se a informar'</description>
		<command>
			<![CDATA[
				SELECT bem.idBem
				FROM br.com.sicoob.capes.negocio.entidades.bem.Bem bem
				WHERE bem.interno = TRUE
				AND bem.descricao = 'RECUSOU-SE A INFORMAR PATRIMÔNIO'
				AND bem.codCompartilhamentoCadastro = <bancoob:valorOql valor="${codigoCompartilhamentoCadastro}" tipo="Short" />
			]]>
		</command>
	</query>

	<query name="OBTER_TIPO_CLASSIFICACAO_BEM">
		<use-case name="Manter bem" />
		<description>Obtém o códido do tipo de classificação do bem
		</description>
		<command>
			<![CDATA[
				SELECT tipoClassificacao.codigo
				FROM br.com.sicoob.capes.negocio.entidades.bem.Bem bem
				INNER JOIN bem.tipoClassificacaoBem tipoClassificacao
				WHERE bem.idBem = <bancoob:valorOql valor="${idBem}" tipo="Long" />
			]]>
		</command>
	</query>

	<query name="OBTER_RELACIONAMENTOS_BEM_IMOVEL">
		<use-case name="Manter bem imóvel" />
		<description>Obtém os relacionamentos de um bem imóvel</description>
		<command>
			<![CDATA[
				SELECT new br.com.sicoob.capes.negocio.entidades.bem.BemImovelTipoRelacionamentoPessoa(
					relacionamento.idBemImovelRelacionamento,
					relacionamento.tipoRelacionamento,
					relacionamento.pessoaCompartilhamento,
					relacionamento.idPessoaCompartilhamento,
					relacionamento.dataInicioRelacionamento,
					relacionamento.dataFimRelacionamento,
					relacionamento.areaPosse
				)
				FROM br.com.sicoob.capes.negocio.entidades.bem.BemImovelTipoRelacionamentoPessoa relacionamento
				WHERE relacionamento.bemImovel.idBem = <bancoob:valorOql valor="${idBem}" tipo="Long" />
			]]>
		</command>
	</query>

	<query name="EXCLUIR_COMPARTILHAMENTOS_MARCADOS">
		<use-case name="Bem" />
		<description>Exclui os compartilhamentos do bem marcados para exclusão
		</description>
		<command>
			<![CDATA[
				DELETE FROM CLI.BEMPESSOACOMPARTILHAMENTO
				WHERE BOLMARCADOEXCLUSAO = 1
				AND IDBEM = <bancoob:valor valor="${idBem}" tipo="Long" />
				AND DATAHORAINICIO IS NOT NULL
				AND IDINSTITUICAOATUALIZACAO IS NULL
			]]>
		</command>
	</query>

	<query name="ADICIONAR_HISTORICO_BEM_PESSOA_COMPARTILHAMENTO">
		<use-case name="Bem" />
		<description>Adiciona o historico bem pessoa compartilhamento
		</description>
		<command>
			<![CDATA[
				INSERT INTO CLI.HISTBEMPESSOACOMPARTILHAMENTO(IDBEMPESSOACOMPARTILHAMENTO, IDBEM, IDPESSOACOMPARTILHAMENTO, PERCPROPRIETARIO, IDUSUARIOAPROV, IDUSUARIOEXCLUSAO, DATAHORAINICIO, DATAHORAFIM)
				SELECT IDBEMPESSOACOMPARTILHAMENTO, IDBEM, IDPESSOACOMPARTILHAMENTO, PERCPROPRIETARIO, IDUSUARIOAPROV, <bancoob:valor valor="${idUsuario}" tipo="String" />, DATAHORAINICIO, CURRENT_TIMESTAMP
				FROM CLI.BEMPESSOACOMPARTILHAMENTO
				WHERE BOLMARCADOEXCLUSAO = 1
				AND IDBEM = <bancoob:valor valor="${idBem}" tipo="Long" />
				AND DATAHORAINICIO IS NOT NULL
				AND IDINSTITUICAOATUALIZACAO IS NULL
			]]>
		</command>
	</query>

	<query name="DESMARCAR_COMPARTILHAMENTOS_RESPONSAVEIS_BEM">
		<use-case name="Bem" />
		<description>Desmarca os responsáveis pelo bem, após a aprovação
		</description>
		<command>
			<![CDATA[
				UPDATE CLI.BEMPESSOACOMPARTILHAMENTO
				SET BOLPESSOARESPONSAVEL = 0
				WHERE IDBEM = <bancoob:valor valor="${idBem}" tipo="Long" />
				AND DATAHORAINICIO IS NOT NULL
				AND IDINSTITUICAOATUALIZACAO IS NULL
			]]>
		</command>
	</query>

	<query name="DESMARCAR_COMPARTILHAMENTOS_NAO_MODIFICADO">
		<use-case name="Bem" />
		<description>Desmarca a atualização de um compartilhamento que não foi
			modificado.</description>
		<command>
			<![CDATA[
				UPDATE CLI.BEMPESSOACOMPARTILHAMENTO
				SET IDINSTITUICAOATUALIZACAO = NULL,
				BOLPESSOARESPONSAVEL = 0,
				DATAHORAINICIO = CURRENT_TIMESTAMP
				WHERE IDBEM = <bancoob:valor valor="${idBem}" tipo="Long" />
			]]>
		</command>
	</query>

	<query name="ALTERAR_PERFIL_CADASTRO">
		<use-case name="Pessoa" />
		<description>Realiza a alteração do perfil de cadastro.</description>
		<command>
			<![CDATA[
				UPDATE CLI.PESSOACOMPARTILHAMENTO
				SET CODPERFILCADASTRO = <bancoob:valor valor="${codigoPerfilCadastro}" tipo="Short" />,
				DATAHORAINICIO = CURRENT_TIMESTAMP,
				DATAALTERACAOPERFILCADASTRO = CURRENT_TIMESTAMP,
				IDUSUARIOAPROV = <bancoob:valor valor="${usuarioAprovacao}" tipo="String" />
				WHERE IDPESSOACOMPARTILHAMENTO = <bancoob:valor valor="${idPessoaCompartilhamento}" tipo="Long" />
			]]>
		</command>
	</query>

	<query name="PESQUISA_BEM_POR_ID_BEM_NOVO">
		<use-case name="Bem" />
		<description>Obtém os bens antigos pelo idBemNovo.</description>
		<command>
			<![CDATA[
				SELECT bem
				FROM br.com.sicoob.capes.negocio.entidades.bemantigo.Bem bem
				WHERE bem.idBemNovo = <bancoob:valorOql valor="${criterios.filtro.idBemNovo}" tipo="Long" />
				
				<j:if test="${criterios.filtro.pessoaCompartilhamento != null and criterios.filtro.pessoaCompartilhamento.idPessoaCompartilhamento != null}">
					AND bem.pessoaCompartilhamento.idPessoaCompartilhamento = <bancoob:valorOql valor="${criterios.filtro.pessoaCompartilhamento.idPessoaCompartilhamento}" tipo="Long" />
				</j:if>
			]]>
		</command>
	</query>

	<query name="OBTER_DADOS_LISTAGEM_BEM">
		<use-case name="Bem" />
		<description>Obtém os dados para a listagem dos bens</description>
		<command>
			<![CDATA[
				SELECT 
			        B.IDBEM,
			        B.BOLBEMINTERNO,
			        B.DESCBEM,
			        BI.DESCDENOMINACAO,
			        B.VALORBEM,
			        B.DATAHORAINICIO,
			        B.IDINSTITUICAOATUALIZACAO,
			        CASE 
						WHEN (BI.IDBEM IS NOT NULL)
						THEN TBI.DESCTIPOBEMIMOVEL
						ELSE TBM.DESCTIPOBEMMOVEL
			        END AS DESCTIPOBEM,
			        CASE
						WHEN BMA.IDBEM IS NOT NULL
						THEN BMA.VALORAVALIACAO
						ELSE BIA.VALORAVALIACAO
			        END AS VALORAVALIACAO,
			        CASE
						WHEN BMA.IDBEM IS NOT NULL
						THEN BMA.DATAAVALIACAO
						ELSE BIA.DATAAVALIACAO
			        END AS DATAAVALIACAO,
			        CASE WHEN (TI.IDINFORMACAOPESSOA IS NOT NULL) THEN 'Em Garantia'
			             WHEN (BIA.BOLEMPROCESSOAQUISICAO = 1 OR BMA.BOLEMPROCESSOAQUISICAO = 1) THEN 'Em Aquisição'             
			             WHEN (BI.IDPESSOACOMPARTILHAMENTOCARTORIO IS NOT NULL AND BI.DESCMATRICULA IS NOT NULL) 
			                OR (BM.NUMCHASSI IS NOT NULL OR BM.DESCINCRICAOEMBARCACAO IS NOT NULL OR BM.DESCMATRICULAAERONAVE IS NOT NULL) THEN 'Avançado'
			             WHEN (BI.IDPESSOACOMPARTILHAMENTOCARTORIO IS NULL AND BM.NUMCHASSI IS NULL AND BM.DESCINCRICAOEMBARCACAO IS NULL AND BM.DESCMATRICULAAERONAVE IS NULL) THEN 'Simples'
			        END AS STATUS,
			        COALESCE((A.DESCTIPOAUTORIZACAO || '#' || TO_CHAR(A.IDREGISTROANTIGO)), 'BEM_NOVO#' || B.IDBEM) as IDREGISTROCONTROLADO,
			        BPC.IDUSUARIOAPROV,
			        CASE WHEN (BPC.DATAHORAINICIO IS NOT NULL AND BPC.IDINSTITUICAOATUALIZACAO IS NOT NULL) THEN 1
						WHEN (A.IDAUTORIZACAO IS NULL) THEN 0
						WHEN (A.IDAUTORIZACAO IS NOT NULL AND A.DATAHORASOLICITACAO IS NOT NULL AND A.BOLDEVOLVIDO = 0) THEN 2
						WHEN (A.IDAUTORIZACAO IS NOT NULL AND A.DATAHORASOLICITACAO IS NOT NULL AND A.BOLDEVOLVIDO = 1) THEN 3 
						WHEN (A.IDAUTORIZACAO IS NOT NULL AND A.DATAHORASOLICITACAO IS NULL) THEN 4 
			        END AS CODIGOSITUACAOAPROVACAO,
			        TCB.CODTIPOCLASSIFICACAOBEM,
			        TCB.DESCTIPOCLASSIFICACAOBEM,
			        BPC.PERCPROPRIETARIO,
			        BPC.IDBEMPESSOACOMPARTILHAMENTO
				FROM CLI.BEM B
				INNER JOIN CLI.BEMPESSOACOMPARTILHAMENTO BPC ON BPC.IDBEM = B.IDBEM
				LEFT JOIN CLI.BEMIMOVEL BI ON BI.IDBEM = B.IDBEM
				LEFT JOIN CLI.BEMIMOVELAVALIACAO BIA ON BIA.IDBEM = B.IDBEM
				LEFT JOIN CLI.BEMMOVEL BM ON BM.IDBEM = B.IDBEM
				LEFT JOIN CLI.BEMMOVELAVALIACAO BMA ON BMA.IDBEM = B.IDBEM
				LEFT JOIN CLI.TIPOBEMIMOVEL TBI ON TBI.CODTIPOBEMIMOVEL = BI.CODTIPOBEMIMOVEL
				LEFT JOIN CLI.TIPOBEMMOVEL TBM ON TBM.CODTIPOBEMMOVEL = BM.CODTIPOBEMMOVEL
				LEFT JOIN CLI.TIPOCLASSIFICACAOBEM TCB ON TCB.CODTIPOCLASSIFICACAOBEM = B.CODTIPOCLASSIFICACAOBEM
				LEFT JOIN CLI.TIPOINFUTILIZAINFPESSOA TI ON TI.IDINFORMACAOPESSOA = B.IDBEM AND TI.IDUTILIZAINFORMACAOPESSOA = 4 AND TI.IDTIPOINFORMACAOPESSOA = 6
				LEFT JOIN CLI.AUTORIZACAO A ON (A.IDREGISTROANTIGO = B.IDBEM OR A.IDREGISTRONOVO = B.IDBEM) AND A.DESCTIPOAUTORIZACAO = 'BEM_NOVO'
				WHERE BPC.IDPESSOACOMPARTILHAMENTO = <bancoob:valor valor="${idPessoaCompartilhamento}" tipo="Long" />
				ORDER BY B.CODTIPOCLASSIFICACAOBEM
			]]>
		</command>
	</query>
	
	<query name="OBTER_DADOS_LISTAGEM_PARCERIAS_BEM">
		<use-case name="Bem" />
		<description>Obtém os dados para a listagem das parcerias dos bens</description>
		<command>
			<![CDATA[
				SELECT B.IDBEM,
					B.DESCBEM,
					B.BOLBEMINTERNO,
					B.CODTIPOCLASSIFICACAOBEM,
					B.DATAHORAINICIO,
			        B.IDINSTITUICAOATUALIZACAO,
					TCB.DESCTIPOCLASSIFICACAOBEM,
					TBI.DESCTIPOBEMIMOVEL,
					BI.DESCDENOMINACAO,
					BI.AREATOTALIMOVEL,
					BITRP.TAMAREAPOSSE,
					BI.IDLOCALIDADE,
					LOC.NOMELIMPOLOCALIDADE,
					BI.DESCMATRICULA,
					BI.DESCNIRF,
					BI.DESCINCRA,
					COALESCE((A.DESCTIPOAUTORIZACAO || '#' || TO_CHAR(A.IDREGISTROANTIGO)), 'BEM_NOVO#' || B.IDBEM) as IDREGISTROCONTROLADO,
			        B.IDUSUARIOAPROV,
			        CASE WHEN (B.DATAHORAINICIO IS NOT NULL AND B.IDINSTITUICAOATUALIZACAO IS NOT NULL) THEN 1
						WHEN (A.IDAUTORIZACAO IS NULL) THEN 0
						WHEN (A.IDAUTORIZACAO IS NOT NULL AND A.DATAHORASOLICITACAO IS NOT NULL AND A.BOLDEVOLVIDO = 0) THEN 2
						WHEN (A.IDAUTORIZACAO IS NOT NULL AND A.DATAHORASOLICITACAO IS NOT NULL AND A.BOLDEVOLVIDO = 1) THEN 3 
						WHEN (A.IDAUTORIZACAO IS NOT NULL AND A.DATAHORASOLICITACAO IS NULL) THEN 4 
			        END AS CODIGOSITUACAOAPROVACAO
				FROM CLI.BEM B
				INNER JOIN CLI.BEMIMOVEL BI ON BI.IDBEM = B.IDBEM
				INNER JOIN CLI.BEMIMOVELTIPORELACIONAMENTOPESSOA BITRP ON BITRP.IDBEM = B.IDBEM
				INNER JOIN CLI.TIPOCLASSIFICACAOBEM TCB ON TCB.CODTIPOCLASSIFICACAOBEM = B.CODTIPOCLASSIFICACAOBEM
				INNER JOIN CLI.TIPOBEMIMOVEL TBI ON TBI.CODTIPOBEMIMOVEL = BI.CODTIPOBEMIMOVEL
				INNER JOIN LOC.VIW_LOCALIDADE LOC ON LOC.IDLOCALIDADE = BI.IDLOCALIDADE
				LEFT JOIN CLI.AUTORIZACAO A ON (A.IDREGISTROANTIGO = B.IDBEM OR A.IDREGISTRONOVO = B.IDBEM) AND A.DESCTIPOAUTORIZACAO = 'BEM_NOVO'
				WHERE BITRP.IDPESSOACOMPARTILHAMENTO = <bancoob:valor valor="${idPessoaCompartilhamento}" tipo="Long" />
				AND B.DATAHORAINICIO IS NOT NULL
				AND B.IDINSTITUICAOATUALIZACAO IS NULL
			]]>
		</command>
	</query>

	<query name="OBTER_BENS_IMOVEIS_RURAIS">
		<use-case name="Bem"></use-case>
		<description>Obtém os imóveis rurais da pessoa.</description>
		<command>
			<![CDATA[
			SELECT B.IDBEM, B.DESCBEM, BI.DESCDENOMINACAO
			FROM CLI.BEM B
			INNER JOIN CLI.BEMIMOVEL BI ON BI.IDBEM = B.IDBEM
			INNER JOIN CLI.BEMPESSOACOMPARTILHAMENTO BPC ON BPC.IDBEM = BI.IDBEM   
			WHERE B.DATAHORAINICIO IS NOT NULL AND B.IDINSTITUICAOATUALIZACAO IS NULL
			AND BI.CODTIPOLOCALIZACAOBEM = 2
			AND BPC.IDPESSOACOMPARTILHAMENTO = <bancoob:valor valor="${idPessoaCompartilhamento}" tipo="Long" />
			
			UNION
			
			SELECT B.IDBEM, B.DESCBEM, BI.DESCDENOMINACAO
			FROM CLI.BEM B
			INNER JOIN CLI.BEMIMOVEL BI ON BI.IDBEM = B.IDBEM
			INNER JOIN CLI.BEMIMOVELTIPORELACIONAMENTOPESSOA BITRP ON BITRP.IDBEM = BI.IDBEM 
			WHERE B.DATAHORAINICIO IS NOT NULL AND B.IDINSTITUICAOATUALIZACAO IS NULL
			AND BI.CODTIPOLOCALIZACAOBEM = 2
			AND BITRP.IDPESSOACOMPARTILHAMENTO = <bancoob:valor valor="${idPessoaCompartilhamento}" tipo="Long" />
			]]>
		</command>
	</query>

	<query name="VERIFICAR_EXISTENCIA_BEM_INTERNO">
		<use-case name="Bem"></use-case>
		<description>Verifica a existência de um bem interno para a pessoa informada.</description>
		<command>
			<![CDATA[
				SELECT B.IDBEM
				FROM CLI.BEM B
				INNER JOIN CLI.BEMPESSOACOMPARTILHAMENTO BPC ON BPC.IDBEM = B.IDBEM
				WHERE B.BOLBEMINTERNO = 1 
				AND B.DATAHORAINICIO IS NOT NULL
				AND B.IDINSTITUICAOATUALIZACAO IS NULL
				AND BPC.IDPESSOACOMPARTILHAMENTO = <bancoob:valor valor="${idPessoaCompartilhamento}" tipo="Long" />
				
				<j:if test="${idBem != null}">
					AND B.IDBEM = <bancoob:valor valor="${idBem}" tipo="Long" />
				</j:if>
				
			]]>
		</command>
	</query>

	<query name="INCLUIR_BEM_MOVEL_AVALIACAO">
		<use-case name="Bem" />
		<description>Faz a inclusão de um bem móvel avaliação</description>
		<command>
			<![CDATA[
				INSERT INTO CLI.BEMMOVELAVALIACAO (IDBEM, VALORCOMPRAVENDA, DATACOMPRAVENDA, VALORAVALIACAO, DATAAVALIACAO, IDPESSOACOMPARTILHAMENTOAVALIADOR, BOLEMPROCESSOAQUISICAO, CODTIPOESTADOCONSERVACAOBEM) 
				VALUES (?, ?, ?, ?, ?, ?, ?, ?)
			]]>
		</command>
	</query>

	<query name="INCLUIR_BEM_IMOVEL_AVALIACAO">
		<use-case name="Bem" />
		<description>Faz a inclusão de um bem imóvel avaliação</description>
		<command>
			<![CDATA[
				INSERT INTO CLI.BEMIMOVELAVALIACAO (IDBEM, VALORCOMPRAVENDA, DATACOMPRAVENDA, VALORAVALIACAO, DATAAVALIACAO, IDPESSOACOMPARTILHAMENTOAVALIADOR, BOLEMPROCESSOAQUISICAO) 
				VALUES (?, ?, ?, ?, ?, ?, ?)
			]]>
		</command>
	</query>

	<query name="INCLUIR_BEM_IMOVEL_AVALIACAO_RURAL">
		<use-case name="Bem" />
		<description>Faz a inclusão de um bem imóvel avaliação rural
		</description>
		<command>
			<![CDATA[
				INSERT INTO CLI.BEMIMOVELAVALIACAORURAL (IDBEM, DESCBENFEITORIA, VALORBENFEITORIA) 
				VALUES (?, ?, ?)
			]]>
		</command>
	</query>

	<query name="INCLUIR_BEM_IMOVEL_AVALIACAO_URBANO">
		<use-case name="Bem" />
		<description>Faz a inclusão de um bem imóvel avaliação urbano
		</description>
		<command>
			<![CDATA[
				INSERT INTO CLI.BEMIMOVELAVALIACAOURBANO (IDBEM, CODTIPOIMPLANTACAOBEMIMOVEL, CODTIPOESTADOCONSERVACAOBEM, CODTIPOPADRAOACABAMENTOBEMIMOVEL, CODTIPOSERVICOCONDOMINIALBEMIMOVEL, AREAPRIVATIVA, QTDDORMITORIO, QTDVAGAGARAGEM, AREATERRENO, AREATESTADA) 
				VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
			]]>
		</command>
	</query>

	<query name="INCLUIR_TIPO_ONUS_BEM_IMOVEL_AVALIACAO">
		<use-case name="Bem" />
		<description>Faz a inclusão de um tipo de ônus de um bem imóvel
			avaliação</description>
		<command>
			<![CDATA[
				INSERT INTO CLI.TIPOONUSBEMIMOVELAVALIACAO(CODTIPOONUSBEM, IDBEM)
				VALUES (?, ?)
			]]>
		</command>
	</query>

	<query name="INCLUIR_TIPO_ONUS_BEM_MOVEL_AVALIACAO">
		<use-case name="Bem" />
		<description>Faz a inclusão de um tipo de ônus de um bem móvel
			avaliação</description>
		<command>
			<![CDATA[
				INSERT INTO CLI.TIPOONUSBEMMOVELAVALIACAO(CODTIPOONUSBEM, IDBEM)
				VALUES (?, ?)
			]]>
		</command>
	</query>

	<query name="REMOVER_BEM_IMOVEL_AVALIACAO">
		<use-case name="Bem" />
		<description>Remove o registro de bem imóvel avaliação</description>
		<command>
			<![CDATA[
				DELETE FROM CLI.BEMIMOVELAVALIACAO
				WHERE IDBEM = <bancoob:valor valor="${idBem}" tipo="Long" />
			]]>
		</command>
	</query>

	<query name="REMOVER_BEM_IMOVEL_AVALIACAO_RURAL">
		<use-case name="Bem" />
		<description>Remove o registro de bem imóvel avaliação rural
		</description>
		<command>
			<![CDATA[
				DELETE FROM CLI.BEMIMOVELAVALIACAORURAL
				WHERE IDBEM = <bancoob:valor valor="${idBem}" tipo="Long" />
			]]>
		</command>
	</query>

	<query name="REMOVER_BEM_IMOVEL_AVALIACAO_URBANO">
		<use-case name="Bem" />
		<description>Remove o registro de bem imóvel avaliação urbano
		</description>
		<command>
			<![CDATA[
				DELETE FROM CLI.BEMIMOVELAVALIACAOURBANO
				WHERE IDBEM = <bancoob:valor valor="${idBem}" tipo="Long" />
			]]>
		</command>
	</query>

	<query name="REMOVER_BEM_MOVEL_AVALIACAO">
		<use-case name="Bem" />
		<description>Remove o registro de bem móvel avaliação</description>
		<command>
			<![CDATA[
				DELETE FROM CLI.BEMMOVELAVALIACAO
				WHERE IDBEM = <bancoob:valor valor="${idBem}" tipo="Long" />
			]]>
		</command>
	</query>

	<query name="REMOVER_TIPO_ONUS_BEM_IMOVEL_AVALIACAO">
		<use-case name="Bem" />
		<description>Remove um tipo de ônus de um bem imóvel avaliação
		</description>
		<command>
			<![CDATA[
				DELETE FROM CLI.TIPOONUSBEMIMOVELAVALIACAO
				WHERE IDBEM = <bancoob:valor valor="${idBem}" tipo="Long" />
			]]>
		</command>
	</query>

	<query name="REMOVER_TIPO_ONUS_BEM_MOVEL_AVALIACAO">
		<use-case name="Bem" />
		<description>Remove um tipo de ônus de um bem móvel avaliação
		</description>
		<command>
			<![CDATA[
				DELETE FROM CLI.TIPOONUSBEMMOVELAVALIACAO
				WHERE IDBEM = <bancoob:valor valor="${idBem}" tipo="Long" />
			]]>
		</command>
	</query>

	<query name="PESQUISA_BENS_POR_ID_PESSOA_COMPARTILHAMENTO">
		<use-case name="Bem" />
		<description>Obtém os bens NOVO por id de pessoa compartilhamento.
		</description>
		<command>
			<![CDATA[
				SELECT bem
				FROM br.com.sicoob.capes.negocio.entidades.bem.BemPessoaCompartilhamento bemPessaoCompartilhamento
				inner join bemPessaoCompartilhamento.bem bem
				inner join bem.tipoClassificacaoBem tipoClassificacao
				left join fetch bem.pessoaCompartilhamentoCartorio cartorio
				WHERE bemPessaoCompartilhamento.idPessoaCompartilhamento = <bancoob:valorOql valor="${idPessoaCompartilhamento}" tipo="Long" />
				and tipoClassificacao.codigo = <bancoob:valorOql valor="${tipoClassificacao}" tipo="Short" />
				and bem.dataHoraInicio is not null 
				and bem.idInstituicaoAtualizacao is null
			]]>
		</command>
	</query>

	<query name="PESQUISAR_GRUPOS_TIPO_ANOTACAO">
		<use-case name="Grupo tipo anotação" />
		<description>Pesquisa os grupos de tipos de anotação</description>
		<command>
      <![CDATA[
        FROM br.com.sicoob.capes.negocio.entidades.GrupoTipoAnotacao grupoTipoAnotacao
        WHERE 1 = 1
            
        <j:if test="${criterios.filtro.nome != null}">
          AND grupoTipoAnotacao.nome like <bancoob:valorOql valor="${criterios.filtro.nome}" tipo="LikeDireita" />
	    </j:if>
      ]]>
		</command>
		<projecao>
			SELECT grupoTipoAnotacao
		</projecao>
		<ordenacoes>
			<ordenacao chave="codigo" default="true">
				ORDER BY grupoTipoAnotacao.idGrupoTipoAnotacao
			</ordenacao>
		</ordenacoes>
	</query>
	
	<query name="OBTER_ANOTACOES_VENCIDAS_POR_GRUPO_TIPO_ANOTACAO">
		<use-case name="Anotação" />
		<description>Obtém as anotações vencidas por grupo tipo anotação</description>
		<command>
        <![CDATA[
        	FROM br.com.sicoob.capes.negocio.entidades.Anotacao anotacao,
        		 br.com.sicoob.capes.negocio.entidades.GrupoTipoAnotacao grupoTipoAnotacao
        	INNER JOIN grupoTipoAnotacao.tiposAnotacao tiposAnotacao
        	WHERE anotacao.dataHoraBaixa IS NULL
        	AND tiposAnotacao.codTipoAnotacao = anotacao.tipoAnotacao.codTipoAnotacao
        	AND anotacao.dataHoraAnotacao &lt;= <bancoob:valorOql valor="${dataLimite}" tipo="Date" />
        	AND grupoTipoAnotacao.idGrupoTipoAnotacao = <bancoob:valorOql valor="${idGrupoTipoAnotacao}" tipo="Short" />
        ]]>
		</command>
		<projecao>SELECT anotacao</projecao>
	</query>
	
	<query name="OBTER_ANOTACOES_POR_GRUPO_TIPO_ANOTACAO">
		<use-case name="Anotação" />
		<description>Obtém as anotações por grupo tipo anotação</description>
		<command>
        <![CDATA[
        	SELECT anotacao
        	FROM br.com.sicoob.capes.negocio.entidades.Anotacao anotacao,
        		 br.com.sicoob.capes.negocio.entidades.GrupoTipoAnotacao grupoTipoAnotacao
        	INNER JOIN grupoTipoAnotacao.tiposAnotacao tiposAnotacao
        	WHERE anotacao.dataHoraBaixa IS NULL
        	AND tiposAnotacao.codTipoAnotacao = anotacao.tipoAnotacao.codTipoAnotacao
        	AND anotacao.pessoaCompartilhamento.idPessoaCompartilhamento = <bancoob:valorOql valor="${idPessoaCompartilhamento}" tipo="Long" />
        	AND grupoTipoAnotacao.idGrupoTipoAnotacao = <bancoob:valorOql valor="${idGrupoTipoAnotacao}" tipo="Short" />
        ]]>
		</command>
	</query>
	
	<query name="OBTER_GRUPOS_TIPO_ANOTACAO_POR_TIPO_ANOTACAO">
		<use-case name="Grupo tipo anotação" />
		<description>Obtém os grupos de tipo de anotação por id do tipo da anotação</description>
		<command>
        <![CDATA[
        	SELECT grupoTipoAnotacao
        	FROM br.com.sicoob.capes.negocio.entidades.GrupoTipoAnotacao grupoTipoAnotacao
        	INNER JOIN grupoTipoAnotacao.tiposAnotacao tiposAnotacao
        	WHERE tiposAnotacao.codTipoAnotacao = <bancoob:valorOql valor="${idTipoAnotacao}" tipo="Integer" />
        ]]>
		</command>
	</query>
	
	<query name="OBTER_GRUPOS_TIPO_ANOTACAO_POR_TIPOS_ANOTACAO">
		<use-case name="Grupo tipo anotação" />
		<description>Obtém os grupos de tipo de anotação por tipos de anotação</description>
		<command>
        <![CDATA[
        	SELECT grupoTipoAnotacao
        	FROM br.com.sicoob.capes.negocio.entidades.GrupoTipoAnotacao grupoTipoAnotacao
        	INNER JOIN grupoTipoAnotacao.tiposAnotacao tiposAnotacao
        	WHERE tiposAnotacao IN (<bancoob:valorOql valor="${tiposAnotacao}" tipo="List"/>)
        ]]>
		</command>
	</query>
	
	<query name="VERIFICAR_BEM_EM_GARANTIA">
		<use-case name="Bem" />
		<description>Verifica se o bem está em garantia.</description>
		<command>
        <![CDATA[
        	SELECT COUNT(1) AS CONTADOR
        	FROM CLI.TIPOINFUTILIZAINFPESSOA TI
        	WHERE TI.IDINFORMACAOPESSOA = <bancoob:valor valor="${idBem}" tipo="Long"/>
        	AND TI.IDUTILIZAINFORMACAOPESSOA = 4 AND TI.IDTIPOINFORMACAOPESSOA = 6
        ]]>
		</command>
	</query>
	
	<query name="PESSOA_POSSUI_BENS_CADASTRADOS">
		<use-case name="Bem" />
		<description>Verifica se a pessoa possui bens cadastrados</description>
		<command>
			<![CDATA[
				SELECT COUNT(1) AS CONTADOR
				FROM CLI.BEM B
				INNER JOIN CLI.BEMPESSOACOMPARTILHAMENTO BPC ON BPC.IDBEM = B.IDBEM
				WHERE BPC.IDPESSOACOMPARTILHAMENTO = <bancoob:valor valor="${idPessoaCompartilhamento}" tipo="Long" />
			]]>
		</command>
	</query>
	
	<query name="OBTER_BEM_PESSOA_COMPARTILHAMENTO_INTERNO_POR_IDPESSOACOMPARTILHAMENTO">
		<use-case name="Bem" />
		<description>Obtém o bemPessoaCompartilhamento interno por idPessoaCompartilhamento</description>
		<command>
			<![CDATA[
				SELECT bpc
				FROM br.com.sicoob.capes.negocio.entidades.bem.BemPessoaCompartilhamento bpc
				INNER JOIN bpc.bem bem
				WHERE bem.interno = TRUE
				AND bpc.idPessoaCompartilhamento = <bancoob:valorOql valor="${idPessoaCompartilhamento}" tipo="Long" />
			]]>
		</command>
	</query>
	
	<query name="CONSULTA_IDREGISTROSCONTRALADOS_AUTORIZACOES_PENDENTES_AUTO_ATENDIMENTO">
		<use-case name="Autorizar Alterações Auto Atendimento" />
		<description>Recupera as alterações a aprovar  somente de auto atendimento, InternetBanking e Mobile</description>
		<command>
			<![CDATA[
				SELECT AUT.CODREGISTROCONTROLADO FROM CLI.AUTORIZACAO AUT
		                INNER JOIN CLI.PESSOACOMPARTILHAMENTO PC ON AUT.IDREGISTROANTIGO = PC.IDPESSOACOMPARTILHAMENTO
		                WHERE
		                      PC.IDUSUARIOENVIO IN ('INTERNETB0300_00', 'MOBILE0300_00')
		                      AND AUT.DESCTIPOAUTORIZACAO LIKE 'PESSOA'
		                      AND AUT.CODREGISTROCONTROLADO IN(<bancoob:valor valor="${idsRegistroControladoPessoa}" />)
							  AND AUT.IDREGISTRONOVO IS NULL
		 
		        UNION ALL
		            
		        SELECT AUT.CODREGISTROCONTROLADO FROM CLI.AUTORIZACAO AUT
		                INNER JOIN CLI.ENDERECOPESSOA EN ON AUT.IDREGISTROANTIGO = EN.IDENDERECOPESSOA
		                WHERE
		                      EN.IDUSUARIOENVIO IN ('INTERNETB0300_00', 'MOBILE0300_00')
		                      AND AUT.DESCTIPOAUTORIZACAO LIKE 'ENDERECO'
		                      AND AUT.CODREGISTROCONTROLADO IN(<bancoob:valor valor="${idsRegistroControladoEndereco}" />)
							  AND AUT.IDREGISTRONOVO IS NULL
		      
		       UNION ALL
		      
		       SELECT AUT.CODREGISTROCONTROLADO FROM CLI.AUTORIZACAO AUT
		                INNER JOIN CLI.FONTERENDA FR ON AUT.IDREGISTROANTIGO = FR.IDFONTERENDA   
		                WHERE
		                      FR.IDUSUARIOENVIO IN ('INTERNETB0300_00', 'MOBILE0300_00')
		                      AND AUT.DESCTIPOAUTORIZACAO LIKE 'FONTE_RENDA'
		                      AND AUT.CODREGISTROCONTROLADO IN(<bancoob:valor valor="${idsRegistroControladoFonteRenda}" /> )
							  AND AUT.IDREGISTRONOVO IS NULL
							  
				UNION ALL			  
							  
				SELECT AUT.CODREGISTROCONTROLADO FROM CLI.AUTORIZACAO AUT
		                INNER JOIN CLI.PESSOACOMPARTILHAMENTO PC ON AUT.IDREGISTRONOVO = PC.IDPESSOACOMPARTILHAMENTO
		                WHERE
		                      PC.IDUSUARIOENVIO IN ('INTERNETB0300_00', 'MOBILE0300_00')
		                      AND AUT.DESCTIPOAUTORIZACAO LIKE 'PESSOA'
		                      AND AUT.CODREGISTROCONTROLADO IN(<bancoob:valor valor="${idsRegistroControladoPessoa}" />)
							  AND AUT.IDREGISTROANTIGO IS NOT NULL
		 
		        UNION ALL
		            
		        SELECT AUT.CODREGISTROCONTROLADO FROM CLI.AUTORIZACAO AUT
		                INNER JOIN CLI.ENDERECOPESSOA EN ON AUT.IDREGISTRONOVO = EN.IDENDERECOPESSOA
		                WHERE
		                      EN.IDUSUARIOENVIO IN ('INTERNETB0300_00', 'MOBILE0300_00')
		                      AND AUT.DESCTIPOAUTORIZACAO LIKE 'ENDERECO'
		                      AND AUT.CODREGISTROCONTROLADO IN(<bancoob:valor valor="${idsRegistroControladoEndereco}" />)
							  AND AUT.IDREGISTROANTIGO IS NOT NULL
		      
		       UNION ALL
		      
		       SELECT AUT.CODREGISTROCONTROLADO FROM CLI.AUTORIZACAO AUT
		                INNER JOIN CLI.FONTERENDA FR ON AUT.IDREGISTRONOVO = FR.IDFONTERENDA   
		                WHERE
		                      FR.IDUSUARIOENVIO IN ('INTERNETB0300_00', 'MOBILE0300_00')
		                      AND AUT.DESCTIPOAUTORIZACAO LIKE 'FONTE_RENDA'
		                      AND AUT.CODREGISTROCONTROLADO IN(<bancoob:valor valor="${idsRegistroControladoFonteRenda}" /> )
							  AND AUT.IDREGISTROANTIGO IS NOT NULL
							  				  
				UNION ALL			  
							  
				SELECT AUT.CODREGISTROCONTROLADO FROM CLI.AUTORIZACAO AUT
		                INNER JOIN CLI.PESSOACOMPARTILHAMENTO PC ON AUT.IDREGISTRONOVO = PC.IDPESSOACOMPARTILHAMENTO
		                WHERE
		                      PC.IDUSUARIOENVIO IN ('INTERNETB0300_00', 'MOBILE0300_00')
		                      AND AUT.DESCTIPOAUTORIZACAO LIKE 'PESSOA'
		                      AND AUT.CODREGISTROCONTROLADO IN(<bancoob:valor valor="${idsRegistroControladoPessoa}" />)
							  AND AUT.IDREGISTROANTIGO IS  NULL
		 
		        UNION ALL
		            
		        SELECT AUT.CODREGISTROCONTROLADO FROM CLI.AUTORIZACAO AUT
		                INNER JOIN CLI.ENDERECOPESSOA EN ON AUT.IDREGISTRONOVO = EN.IDENDERECOPESSOA
		                WHERE
		                      EN.IDUSUARIOENVIO IN ('INTERNETB0300_00', 'MOBILE0300_00')
		                      AND AUT.DESCTIPOAUTORIZACAO LIKE 'ENDERECO'
		                      AND AUT.CODREGISTROCONTROLADO IN(<bancoob:valor valor="${idsRegistroControladoEndereco}" />)
							  AND AUT.IDREGISTROANTIGO IS  NULL
		      
		       UNION ALL
		      
		       SELECT AUT.CODREGISTROCONTROLADO FROM CLI.AUTORIZACAO AUT
		                INNER JOIN CLI.FONTERENDA FR ON AUT.IDREGISTRONOVO = FR.IDFONTERENDA   
		                WHERE
		                      FR.IDUSUARIOENVIO IN ('INTERNETB0300_00', 'MOBILE0300_00')
		                      AND AUT.DESCTIPOAUTORIZACAO LIKE 'FONTE_RENDA'
		                      AND AUT.CODREGISTROCONTROLADO IN(<bancoob:valor valor="${idsRegistroControladoFonteRenda}" /> )
							  AND AUT.IDREGISTROANTIGO IS  NULL		
		                      
		                      
		    ]]>
		</command>
	</query>

	<query name="CONSULTA_AUTORIZACOES_PENDENTES_AUTO_ATENDIMENTO">
		<use-case name="Consulta autorizações conforme os  idsRegistroControlados" />
		<description>Consulta autorizações conforme os  idsRegistroControlados</description>
		<command>
			<![CDATA[
			FROM br.com.sicoob.capes.negocio.entidades.Autorizacao a
			INNER JOIN a.pessoa p
			WHERE 
				 a.dataHoraSolicitacao IS NOT NULL
				AND a.devolvido = FALSE
				<j:choose>
					<j:when test="${criterios.tipoProcura == null}">
							AND 
								(
									a.instituicaoDestino.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.instituicaoDestino.idInstituicao}" tipo="Integer" />
							<j:choose>
								<j:when test="${criterios.filtro.instituicaoOrigem != null and criterios.filtro.instituicaoOrigem.idInstituicao != null}">
									AND a.instituicaoOrigem.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.instituicaoOrigem.idInstituicao}" tipo="Integer" />
								</j:when>
								<j:otherwise>
									OR  a.instituicaoOrigem.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.instituicaoDestino.idInstituicao}" tipo="Integer" />
								</j:otherwise>
							</j:choose>
								)
					</j:when>
					<j:otherwise>
						<j:if test="${criterios.filtro.instituicaoOrigem != null and criterios.filtro.instituicaoOrigem.idInstituicao != null}">
							AND a.instituicaoOrigem.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.instituicaoOrigem.idInstituicao}" tipo="Integer" />
						</j:if>
					</j:otherwise>
				</j:choose>
						<j:if test="${criterios.filtro.idAutorizacao != null}">
							AND a.idAutorizacao = <bancoob:valorOql valor="${criterios.filtro.idAutorizacao}" tipo="Long" />
						</j:if>
						<j:if test="${criterios.filtro.pessoa != null and criterios.filtro.pessoa.cpfCnpj != null}">
							AND a.pessoa.cpfCnpj = <bancoob:valorOql valor="${criterios.filtro.pessoa.cpfCnpj}" tipo="String" />
						</j:if>
						<j:if test="${criterios.filtro.instituicaoDestino.idUnidadeInst != null}">
							AND a.instituicaoDestino.idUnidadeInst = <bancoob:valorOql valor="${criterios.filtro.instituicaoDestino.idUnidadeInst}" tipo="Integer" />
						</j:if>
						<j:if test="${criterios.filtro.tipoAutorizacao != null}">
							AND a.tipoAutorizacao = <bancoob:valorOql valor="${criterios.filtro.tipoAutorizacao}" tipo="Object" />
						</j:if>
				
						<j:if test="${empty criterios.idsRegistroControlado}">
							AND 1=0
						</j:if>
						<j:if test="${not empty criterios.idsRegistroControlado}">
							AND a.idRegistroControlado IN (<bancoob:valorOql valor="${criterios.idsRegistroControlado}"  tipo="Colecao"/>
						</j:if>
						)
			]]>
		</command>
		<projecao>
			select a
		</projecao>
		<ordenacoes>
			<ordenacao chave="dataSolicitacao" default="true">
				<![CDATA[order by a.dataHoraSolicitacao]]>
			</ordenacao>
		</ordenacoes>
	</query>
		
	<query name="PESQUISA_BENS_IMOVEL_POR_ID_PESSOA_COMPARTILHAMENTO">
		<use-case name="Bem" />
		<description>Obtém os bensImoveis NOVO por id de pessoa compartilhamento.
		</description>
		<command>
			<![CDATA[
				SELECT bemImovel
				FROM br.com.sicoob.capes.negocio.entidades.bem.BemImovel bemImovel
				LEFT JOIN FETCH bemImovel.proprietarios proprietarios
				LEFT JOIN FETCH bemImovel.pessoaCompartilhamentoCartorio cartorio
				LEFT JOIN FETCH bemImovel.relacionamentoPessoas relacionamentopessoa
				WHERE proprietarios.idPessoaCompartilhamento = <bancoob:valorOql valor="${idPessoaCompartilhamento}" tipo="Long" />
				AND bemImovel.dataHoraInicio is not null
				AND bemImovel.idInstituicaoAtualizacao is null
			]]>
		</command>
	</query>
	
	<query name="INSERIR_HISTORICO_DESBLOQUEIO_BEM">
		<use-case name="Bem"></use-case>
		<description>Insere o histórico de quem desbloqueou o bem.</description>
		<command>
			<![CDATA[
			INSERT INTO CLI.HISTBEMBLOQUEIO (IDBEM, IDUSUARIOAPROV, DATAHORAINICIO, IDUTILIZAINFORMACAOPESSOA)
			SELECT IDINFORMACAOPESSOA, <bancoob:valor valor="${idUsuario}" tipo="String" />, CURRENT_TIMESTAMP, IDUTILIZAINFORMACAOPESSOA
			FROM CLI.TIPOINFUTILIZAINFPESSOA
			WHERE IDTIPOINFORMACAOPESSOA = 6
			AND IDINFORMACAOPESSOA = <bancoob:valor valor="${idBem}" tipo="Long" />
			]]>
		</command>
	</query>
	
	<query name="ADICIONAR_HISTORICO_PESSOACOMPARTILHAMENTO">
		<use-case name="Pessoa"></use-case>
		<description>Insere o histórico da pessoa ao alterar o perfil de cadastro.</description>
		<command>
			<![CDATA[
			INSERT INTO CLI.HISTBEMPESSOACOMPARTILHAMENTO(IDPESSOACOMPARTILHAMENTO, IDPESSOA, NOMEPESSOA, CODCOMPARTILHAMENTOCADASTRO, DATAHORAINICIO, DATAHORAFIM, NOMEAPELIDO, NOMECOMPLETO, CODCNAE, DESCOBSERVACAOPESSOA, CODPERFILCADASTRO, DATAINCLUSAOSFN, BOLAUTORIZACONSULTABACEN, DATAINCLUSAOSISTEMA, CODATIVIDADEECONOMICA, IDUSUARIOAPROV, IDUSUARIOEXCL, DATARENOVACAOCADASTRAL, IDUSUARIORENOVACAO, IDINSTITUICAORENOVACAO, IDUSUARIOENVIO, CODTIPOATUALIZACAORENOVACAO, IDUSUARIOPERFILCADASTRO)
				SELECT IDPESSOACOMPARTILHAMENTO, IDPESSOA, NOMEPESSOA, CODCOMPARTILHAMENTOCADASTRO, DATAHORAINICIO, DATAHORAFIM, NOMEAPELIDO, NOMECOMPLETO, CODCNAE, DESCOBSERVACAOPESSOA, CODPERFILCADASTRO, DATAINCLUSAOSFN, BOLAUTORIZACONSULTABACEN, DATAINCLUSAOSISTEMA, CODATIVIDADEECONOMICA, IDUSUARIOAPROV, IDUSUARIOEXCL, DATARENOVACAOCADASTRAL, IDUSUARIORENOVACAO, IDINSTITUICAORENOVACAO, IDUSUARIOENVIO, CODTIPOATUALIZACAORENOVACAO, IDUSUARIOPERFILCADASTRO
				FROM CLI.PESSOACOMPARTILHAMENTO
				WHERE IDPESSOACOMPARTILHAMENTO = <bancoob:valor valor="${idPessoaCompartilhamento}" tipo="Long" />
				AND DATAHORAINICIO IS NOT NULL
				AND IDINSTITUICAOATUALIZACAO IS NULL
			]]>
		</command>
	</query>
	
	<query name="OBTER_VALOR_PARAMETRO">
		<use-case name="Parametro" />
		<description>Obtém o valor do parâmetro</description>
		<command>
			<![CDATA[
				SELECT p.codparametro, p.descparametro, coalesce(pi.descvalor, p.descvalor) as descvalor
				from cli.PARAMETROCAPES as p 
				left join cli.PARAMETROINSTITUICAO as pi on p.codparametro = pi.codparametro and pi.idinstituicao = <bancoob:valor valor="${idInstituicao}" />
				where p.codparametro = <bancoob:valor valor="${codigo}"/> 
			]]>
		</command>
	</query>
	
	<query name="PESQUISA_GRUPO_ECONOMICO_AUTOMATICO_PESSOA_POR_FILTRO">
		<use-case name="Manter Grupo Econômico Automatico Pessoa"></use-case>
		<description>Obter Grupo Econômico Automatico Pessoa por filtro</description>
		<command>
			<![CDATA[
				FROM
					br.com.sicoob.capes.negocio.entidades.GrupoEconomicoAutomaticoPessoa geap
				WHERE 1 = 1
				<j:if test="${criterios.filtro.grupoEconomico != null and criterios.filtro.grupoEconomico.id != null}">
                	AND geap.grupoEconomico.id = <bancoob:valorOql valor="${criterios.filtro.grupoEconomico.id}" tipo="Integer" />
				</j:if>
				<j:if test="${criterios.filtro.bolControlador != null}">
                	AND geap.bolControlador = <bancoob:valorOql valor="${criterios.filtro.bolControlador}" tipo="Boolean" />
				</j:if>
				<j:if test="${criterios.procurarPor != null and criterios.procurarPor == 'pessoaRelacionada'}">
                	AND	geap.pessoaCompartilhamento.pessoa.idPessoa = geap.relacionamentoPessoa.pessoaRelacionada.idPessoa
				</j:if>
				<j:if test="${criterios.filtro.pessoaCompartilhamento != null and criterios.filtro.pessoaCompartilhamento.idPessoaCompartilhamento != null}">
   					AND	geap.pessoaCompartilhamento.idPessoaCompartilhamento = <bancoob:valorOql valor="${criterios.filtro.pessoaCompartilhamento.idPessoaCompartilhamento}" tipo="Long" />
				</j:if>
				<j:if test="${criterios.filtro.relacionamentoPessoa != null and criterios.filtro.relacionamentoPessoa.idRelacionamento != null}">
   					AND	geap.relacionamentoPessoa.idRelacionamento = <bancoob:valorOql valor="${criterios.filtro.relacionamentoPessoa.idRelacionamento}" tipo="Long" />
				</j:if>
			]]>
		</command>
		<projecao>SELECT geap</projecao>
		<ordenacoes>
			<ordenacao default="true" chave="id">
				<![CDATA[ORDER BY geap.id]]>
			</ordenacao>
			<ordenacao chave="elegerControlador">
				<![CDATA[ORDER BY geap.relacionamentoPessoa.percentualCapitalEmpresa DESC, dataInicioMandato, dataInicioRelacionamento, geap.relacionamentoPessoa.idRelacionamento]]>
			</ordenacao>
		</ordenacoes>
	</query>
	
	<query name="PESQUISAR_GRUPO_ECONOMICO_NOVO_POR_FILTRO">
		<use-case name="Manter Grupo Econômico"></use-case>
		<description>Obter grupo econômico por filtro</description>
		<command>
			<![CDATA[
				FROM
					br.com.sicoob.capes.negocio.entidades.GrupoEconomicoNovo ge
				WHERE 1=1
				<j:if test="${criterios.filtro.id != null}">
					AND ge.id =  <bancoob:valorOql valor="${criterios.filtro.id}" tipo="Integer" />
				</j:if>
				<j:if test="${criterios.filtro.nome != null}">
					<j:if test="${criterios.tipoProcura == null}">
						AND ge.nome like  <bancoob:valorOql valor="${criterios.filtro.nome}" tipo="LikeDireitaEsquerda" />
					</j:if>
					<j:if test="${criterios.tipoProcura == 'LikeDireita'}">
						AND ge.nome like  <bancoob:valorOql valor="${criterios.filtro.nome}" tipo="LikeDireita" />
					</j:if>
					<j:if test="${criterios.tipoProcura == 'igual'}">
						AND ge.nome = <bancoob:valorOql valor="${criterios.filtro.nome}"/>
					</j:if>
				</j:if>
				<j:if test="${criterios.filtro.tipo != null and criterios.filtro.tipo.codigo != null}">
					AND ge.tipo.codigo = <bancoob:valorOql valor="${criterios.filtro.tipo.codigo}" tipo="Short" />
				</j:if>
				<j:if test="${criterios.filtro.idInstituicao != null}">
					AND EXISTS (SELECT gi.idGrupo FROM br.com.sicoob.capes.negocio.entidades.GrupoEconomicoInstituicao gi WHERE ge.id = gi.idGrupo AND gi.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.idInstituicao}" tipo="Integer" />)
				</j:if>
				<j:if test="${criterios.procurarPor == 'excluirAutomaticosComManual'}">
					AND not exists (
						FROM br.com.sicoob.capes.negocio.entidades.GrupoEconomicoNovo ge2
						inner join ge2.integrantesManual integrantesManual2
						where 1 = 1
						<j:if test="${criterios.filtro.idInstituicao != null}">
							AND EXISTS (SELECT gi2.idGrupo FROM br.com.sicoob.capes.negocio.entidades.GrupoEconomicoInstituicao gi2 WHERE ge2.id = gi2.idGrupo AND gi2.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.idInstituicao}" tipo="Integer" />)
						</j:if>
							AND integrantesManual2.grupoEconomicoAutomatico is not null
							AND ge = integrantesManual2.grupoEconomicoAutomatico
					)
				</j:if>
			]]>
		</command>
		<projecao>SELECT ge</projecao>
		<ordenacoes>
			<ordenacao default="true" chave="nome">
				<![CDATA[ORDER BY ge.nome]]>
			</ordenacao>
		</ordenacoes>
	</query>
	
	<query name="PESQUISAR_GRUPO_ECONOMICO_LIMPO_POR_FILTRO">
		<use-case name="Manter Grupo Econômico Limpo"></use-case>
		<description>Obter grupo econômico Limpo por filtro</description>
		<command>
			<![CDATA[
				FROM
					br.com.sicoob.capes.negocio.entidades.GrupoEconomicoNovoLimpo ge
				WHERE 1=1
				<j:if test="${criterios.filtro.id != null}">
					AND ge.id =  <bancoob:valorOql valor="${criterios.filtro.id}" tipo="Integer" />
				</j:if>
				<j:if test="${criterios.filtro.nome != null}">
					<j:if test="${criterios.tipoProcura == null}">
						AND ge.nome like  <bancoob:valorOql valor="${criterios.filtro.nome}" tipo="LikeDireitaEsquerda" />
					</j:if>
					<j:if test="${criterios.tipoProcura == 'LikeDireita'}">
						AND ge.nome like  <bancoob:valorOql valor="${criterios.filtro.nome}" tipo="LikeDireita" />
					</j:if>
					<j:if test="${criterios.tipoProcura == 'igual'}">
						AND ge.nome = <bancoob:valorOql valor="${criterios.filtro.nome}"/>
					</j:if>
				</j:if>
				<j:if test="${criterios.filtro.tipo != null and criterios.filtro.tipo.codigo != null}">
					AND ge.tipo.codigo = <bancoob:valorOql valor="${criterios.filtro.tipo.codigo}" tipo="Short" />
				</j:if>
				<j:if test="${criterios.filtro.idInstituicao != null}">
					AND EXISTS (SELECT gi.idGrupo FROM br.com.sicoob.capes.negocio.entidades.GrupoEconomicoInstituicao gi WHERE ge.id = gi.idGrupo AND gi.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.idInstituicao}" tipo="Integer" />)
				</j:if>
				<j:if test="${criterios.procurarPor == 'excluirAutomaticosComManual'}">
					AND not exists (
						FROM br.com.sicoob.capes.negocio.entidades.GrupoEconomicoNovoLimpo ge2
						inner join ge2.integrantesManual integrantesManual2
						where 1 = 1
						<j:if test="${criterios.filtro.idInstituicao != null}">
							AND EXISTS (SELECT gi2.idGrupo FROM br.com.sicoob.capes.negocio.entidades.GrupoEconomicoInstituicao gi2 WHERE ge2.id = gi2.idGrupo AND gi2.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.idInstituicao}" tipo="Integer" />)
						</j:if>
							AND integrantesManual2.grupoEconomicoAutomatico is not null
							AND ge = integrantesManual2.grupoEconomicoAutomatico
					)
				</j:if>
			]]>
		</command>
		<projecao>SELECT ge</projecao>
		<ordenacoes>
			<ordenacao default="true" chave="nome">
				<![CDATA[ORDER BY ge.nome]]>
			</ordenacao>
		</ordenacoes>
	</query>
	
	<query name="PESQUISA_GRUPO_ECONOMICO_MANUAL_PESSOA_POR_FILTRO">
		<use-case name="Manter Grupo Econômico Manual Pessoa"></use-case>
		<description>Obter Grupo Econômico Manual Pessoa por filtro</description>
		<command>
			<![CDATA[
				FROM
					br.com.sicoob.capes.negocio.entidades.GrupoEconomicoManualPessoa gemp
				WHERE 1 = 1
				<j:if test="${criterios.filtro.grupoEconomico != null and criterios.filtro.grupoEconomico.idInstituicao != null}">
   					AND EXISTS (SELECT gi.idGrupo FROM br.com.sicoob.capes.negocio.entidades.GrupoEconomicoInstituicao gi WHERE gemp.grupoEconomico.id = gi.idGrupo AND gi.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.grupoEconomico.idInstituicao}" tipo="Integer" />)
				</j:if>
				<j:if test="${criterios.filtro.pessoaCompartilhamento != null and criterios.filtro.pessoaCompartilhamento.idPessoaCompartilhamento != null}">
   					AND	gemp.pessoaCompartilhamento.idPessoaCompartilhamento = <bancoob:valorOql valor="${criterios.filtro.pessoaCompartilhamento.idPessoaCompartilhamento}" tipo="Long" />
				</j:if>
				<j:if test="${criterios.filtro.grupoEconomicoAutomatico != null and criterios.filtro.grupoEconomicoAutomatico.id != null}">
   					AND	gemp.grupoEconomicoAutomatico.id = <bancoob:valorOql valor="${criterios.filtro.grupoEconomicoAutomatico.id}" tipo="Integer" />
				</j:if>
			]]>
		</command>
		<projecao>SELECT gemp</projecao>
	</query>
	
	<query name="PESQUISA_GRUPO_ECONOMICO_NOVO_POR_PESSOA">
		<use-case name="Manter dados do cliente" />
		<description>Recupera os grupos da pessoa</description>
		<command>
			<![CDATA[
			SELECT IDGRUPOECONOMICO, DESCGRUPOECONOMICO 
			FROM cli.VIW_GRUPO_ECONOMICO
			WHERE 1=1
				AND IDINSTITUICAO = <bancoob:valor valor="${idInstituicao}" />
				AND IDPESSOA = <bancoob:valor valor="${idPessoa}" />
			ORDER BY DESCGRUPOECONOMICO DESC
			]]>
		</command>
	</query>
	<query name="PESQUISAR_PESSOAS_SEM_BEM">
		<use-case name="Bem"></use-case>
		<description>Obeter a lista de pessoas sem bem.</description>
		<command>
			<![CDATA[
			WITH START
			     AS (SELECT PC.IDPESSOACOMPARTILHAMENTO
			         FROM   CLI.PESSOACOMPARTILHAMENTO PC
			                INNER JOIN CLI.PESSOAFISICA PF
			                        ON PF.IDPESSOACOMPARTILHAMENTO = PC.IDPESSOACOMPARTILHAMENTO
			                INNER JOIN CLI.BEMPESSOACOMPARTILHAMENTO BPC
			                        ON BPC.IDPESSOACOMPARTILHAMENTO = PC.IDPESSOACOMPARTILHAMENTO
			                INNER JOIN CLI.VALIDACAOCADASTRAL VA
			                        ON VA.IDPESSOACOMPARTILHAMENTO = PC.IDPESSOACOMPARTILHAMENTO
			         WHERE  VA.DATAHORAULTIMAATUALIZACAO > CURRENT_TIMESTAMP - 30 MINUTES
			                AND PC.CODCOMPARTILHAMENTOCADASTRO = 1
			         FETCH FIRST 9999999 ROWS ONLY),
			     START2
			     AS (SELECT PC.IDPESSOACOMPARTILHAMENTO
			         FROM   CLI.PESSOACOMPARTILHAMENTO PC
			                INNER JOIN CLI.PESSOAFISICA PF
			                        ON PF.IDPESSOACOMPARTILHAMENTO = PC.IDPESSOACOMPARTILHAMENTO
			                INNER JOIN CLI.BEMIMOVELTIPORELACIONAMENTOPESSOA BPC
			                        ON BPC.IDPESSOACOMPARTILHAMENTO = PC.IDPESSOACOMPARTILHAMENTO
			                INNER JOIN CLI.VALIDACAOCADASTRAL VA
			                        ON VA.IDPESSOACOMPARTILHAMENTO = PC.IDPESSOACOMPARTILHAMENTO
			         WHERE  VA.DATAHORAULTIMAATUALIZACAO > CURRENT_TIMESTAMP - 30 MINUTES
			                AND PC.CODCOMPARTILHAMENTOCADASTRO = 1
			         FETCH FIRST 9999999 ROWS ONLY),
			     UNIONSTART
			     AS (SELECT IDPESSOACOMPARTILHAMENTO
			         FROM   START
			         UNION
			         SELECT IDPESSOACOMPARTILHAMENTO
			         FROM   START2),
			     SOURCE
			     AS (SELECT PC.IDPESSOACOMPARTILHAMENTO
			         FROM   CLI.PESSOACOMPARTILHAMENTO PC
			                INNER JOIN CLI.PESSOAFISICA PF
			                        ON PF.IDPESSOACOMPARTILHAMENTO = PC.IDPESSOACOMPARTILHAMENTO
			                INNER JOIN CLI.VALIDACAOCADASTRAL VA
			                        ON VA.IDPESSOACOMPARTILHAMENTO = PC.IDPESSOACOMPARTILHAMENTO
			         WHERE  PC.CODCOMPARTILHAMENTOCADASTRO = 1
			                AND VA.DATAHORAULTIMAATUALIZACAO >
			                    CURRENT_TIMESTAMP - 30 MINUTES
			         EXCEPT
			         SELECT IDPESSOACOMPARTILHAMENTO
			         FROM   UNIONSTART)
			SELECT IR.IDPESSOACOMPARTILHAMENTO,
			       IR.IDINSTITUICAO
			FROM   CLI.INSTITUICAORESPONSAVELCADASTRO IR
			       INNER JOIN SOURCE SRC
			               ON SRC.IDPESSOACOMPARTILHAMENTO = IR.IDPESSOACOMPARTILHAMENTO   
			]]>
		</command>
	</query>
	
	<query name="PESQUISAR_QUANTIDADE_PESSOAS_SEM_BEM">
		<use-case name="Bem"></use-case>
		<description>Obeter a quantidade de pessoas sem bem.</description>
		<command>
			<![CDATA[
			WITH START AS (

				SELECT  
				                PC.IDPESSOACOMPARTILHAMENTO 
				        FROM 
				                CLI.PESSOACOMPARTILHAMENTO PC
				                INNER JOIN CLI.PESSOAFISICA PF ON PF.IDPESSOACOMPARTILHAMENTO = PC.IDPESSOACOMPARTILHAMENTO
				                INNER JOIN CLI.BEMPESSOACOMPARTILHAMENTO BPC ON BPC.IDPESSOACOMPARTILHAMENTO = PC.IDPESSOACOMPARTILHAMENTO
				                INNER JOIN CLI.VALIDACAOCADASTRAL VA ON VA.IDPESSOACOMPARTILHAMENTO = PC.IDPESSOACOMPARTILHAMENTO        
				                WHERE
				                        VA.DATAHORAULTIMAATUALIZACAO > CURRENT_TIMESTAMP - 30 MINUTE   
				                        AND  PC.CODCOMPARTILHAMENTOCADASTRO = 1
				                        FETCH FIRST 9999999 ROWS ONLY
				), 
				START2 AS (
				
				        SELECT  
				               PC.IDPESSOACOMPARTILHAMENTO 
				        FROM 
				                CLI.PESSOACOMPARTILHAMENTO PC
				                INNER JOIN CLI.PESSOAFISICA PF ON PF.IDPESSOACOMPARTILHAMENTO = PC.IDPESSOACOMPARTILHAMENTO
				                INNER JOIN CLI.BEMIMOVELTIPORELACIONAMENTOPESSOA BPC ON BPC.IDPESSOACOMPARTILHAMENTO = PC.IDPESSOACOMPARTILHAMENTO
				                INNER JOIN CLI.VALIDACAOCADASTRAL VA ON VA.IDPESSOACOMPARTILHAMENTO = PC.IDPESSOACOMPARTILHAMENTO        
				                WHERE
				                        VA.DATAHORAULTIMAATUALIZACAO > CURRENT_TIMESTAMP - 30 MINUTE 
				                        AND  PC.CODCOMPARTILHAMENTOCADASTRO = 1
				                        FETCH FIRST 9999999 ROWS ONLY
				),
				UNIONSTART AS (
				        SELECT IDPESSOACOMPARTILHAMENTO FROM START 
				        UNION 
				        SELECT IDPESSOACOMPARTILHAMENTO FROM START2 
				),
				SOURCE AS (
				SELECT 
				        PC.IDPESSOACOMPARTILHAMENTO 
				        FROM 
				                CLI.PESSOACOMPARTILHAMENTO PC
				        INNER JOIN CLI.PESSOAFISICA PF ON PF.IDPESSOACOMPARTILHAMENTO = PC.IDPESSOACOMPARTILHAMENTO
				        INNER JOIN CLI.VALIDACAOCADASTRAL VA ON VA.IDPESSOACOMPARTILHAMENTO = PC.IDPESSOACOMPARTILHAMENTO
				WHERE 
				        PC.CODCOMPARTILHAMENTOCADASTRO = 1
				        AND VA.DATAHORAULTIMAATUALIZACAO > CURRENT_TIMESTAMP - 30 MINUTE 
				
				EXCEPT 
				SELECT IDPESSOACOMPARTILHAMENTO FROM UNIONSTART
				)
				SELECT COUNT(*) FROM CLI.INSTITUICAORESPONSAVELCADASTRO IR
				INNER JOIN SOURCE SRC ON SRC.IDPESSOACOMPARTILHAMENTO = IR.IDPESSOACOMPARTILHAMENTO   
			]]>
		</command>
	</query>
	<query name="PESQUISA_GRUPO_ECONOMICO_INSTITUICAO_POR_FILTRO">
		<use-case name="Manter Grupo Econômico Manual Pessoa"></use-case>
		<description>Obter Grupo Econômico Manual Pessoa por filtro</description>
		<command>
			<![CDATA[
				FROM
					br.com.sicoob.capes.negocio.entidades.GrupoEconomicoInstituicao gi
				WHERE 1 = 1
				<j:if test="${criterios.filtro.idInstituicao != null}">
   					AND	gi.idInstituicao = <bancoob:valorOql valor="${criterios.filtro.idInstituicao}" tipo="Integer" />
				</j:if>
				<j:if test="${criterios.filtro.idGrupo != null}">
   					AND	gi.idGrupo = <bancoob:valorOql valor="${criterios.filtro.idGrupo}" tipo="Integer" />
				</j:if>
			]]>
		</command>
		<projecao>SELECT gi</projecao>
	</query>
	<query name="EXCLUIR_RELACIONAMENTO_CONJUGES">
		<use-case name="RelacionamentoPessoa"></use-case>
		<description>Exclui relacionamento de conjuge e gera seus historicos</description>
		<command>
			<![CDATA[
				DELETE FROM CLI.RELACIONAMENTOPESSOA RP
				WHERE RP.IDRELACIONAMENTOPESSOA IN(<bancoob:valor valor="${idRelacionamento}" tipo="Long" />, <bancoob:valor valor="${idRelacionamentoOposto}" tipo="Long" />)
			]]>
		</command>
	</query>
		<query name="GERAR_HISTRELACIONAMENTO_CONJUGES">
		<use-case name="RelacionamentoPessoa"></use-case>
		<description>Gera historico de relacionamentos de conjuge  o atual e o oposto.</description>
		<command>
			<![CDATA[
				INSERT INTO CLI.HISTRELACIONAMENTOPESSOA
					(
					        IDRELACIONAMENTOPESSOA,
					        IDPESSOA,
					        IDPESSOARELACIONADA,
					        DATAHORAINICIO,
					        DATAHORAFIM,
					        CODTIPORELACIONAMENTOPESSOA,
					        PERCCAPITALEMPRESA,
					        DATAINICIORELACIONAMENTO,
					        DATAFIMMANDATO,
					        IDINSTITUICAO,
					        IDUSUARIOAPROV,
					        IDUSUARIOEXCL,
					        DATAINICIOMANDATO,
					        IDPESSOACOMPARTILHAMENTO,
					        IDUSUARIOENVIO
					    )
					 
					        SELECT 
							IDRELACIONAMENTOPESSOA,
					        IDPESSOA,
					        IDPESSOARELACIONADA,
					        DATAHORAINICIO,
					        CURRENT_TIMESTAMP DATAHORAFIM,
					        CODTIPORELACIONAMENTOPESSOA,
					        PERCCAPITALEMPRESA,
					        DATAINICIORELACIONAMENTO,
					        DATAFIMMANDATO,
					        IDINSTITUICAO,
					        IDUSUARIOAPROV,
					        <bancoob:valor valor="${usuarioExclusao}" tipo="String" /> IDUSUARIOEXCL,
					        DATAINICIOMANDATO,
					        IDPESSOACOMPARTILHAMENTO,
					        IDUSUARIOENVIO
							FROM CLI.RELACIONAMENTOPESSOA 
							WHERE IDRELACIONAMENTOPESSOA IN(<bancoob:valor valor="${idRelacionamento}" tipo="Long" />, <bancoob:valor valor="${idRelacionamentoOposto}" tipo="Long" />)
			]]>
		</command>
	</query>
	<query name="PESQUISAR_AUTORIZACAO_POR_ID_REGISTRO">
		<use-case name="Recupera a autorização por Id" />
		<description>Recupera a autorização por IdRegistro novo</description>
		<command>
			<![CDATA[			
				FROM br.com.sicoob.capes.negocio.entidades.Autorizacao a
				WHERE a.idRegistroNovo = <bancoob:valorOql valor="${idRegistroNovo}"/>
				AND a.devolvido = <bancoob:valorOql valor="${devolvido}"/>
			]]>
		</command>
	</query>
	<query name="PESQUISAR_PRODUTIVIDADE_POR_ID_BEM">
		<use-case name="Recupera as produtividades por id"></use-case>
		<description>Pesquisa as produtividades por id do bem</description>
		<command>
			<![CDATA[
				SELECT DISTINCT PC.NOMEPESSOA
				FROM CLI.PESSOAPRODUTIVIDADE PP
				INNER JOIN CLI.PESSOACOMPARTILHAMENTO PC ON PC.IDPESSOACOMPARTILHAMENTO = PP.IDPESSOACOMPARTILHAMENTO
				INNER JOIN CLI.BEMPESSOA BP ON BP.IDBEMPESSOA = PP.IDBEMPESSOA
				WHERE BP.IDBEMPESSOA = <bancoob:valor valor="${idBem}" tipo="Long" />
			]]>
		</command>
	</query>
	<query name="OBTER_GERENTE_POR_INSTITUICAO">
      <use-case name="" />
      <description></description>
      <command>
          <![CDATA[
            SELECT
				new br.com.sicoob.capes.cadastro.negocio.dto.FuncionarioDTO( 
				    t.idPessoaLegado as idPessoaLegado, 
				    t.nomePessoaLegado as nomePessoaLegado 
				) 
				FROM br.com.sicoob.capes.negocio.entidades.Funcionario f
					INNER JOIN f.pessoa p
					INNER JOIN p.compartilhamentos c
					INNER JOIN c.transicoes t 
				WHERE 1=1
					AND t.instituicao.idInstituicao = f.instituicao.idInstituicao
					AND f.instituicao.idInstituicao = <bancoob:valorOql valor="${idInstituicao}" tipo="Integer" />
					AND f.funcao.idFuncao = <bancoob:valorOql valor="${idFuncao}" tipo="Short" />
				ORDER BY
				    t.nomePessoaLegado
          ]]>
      </command>
    </query>
    <query name="PESQUISAR_GRUPO_ECONOMICO_POR_INSTITUICAO">
		<use-case name="Pesquisar Grupo Econômico"></use-case>
		<description>Pesquisa os grupos econômicos por instituição</description>
		<command>
			<![CDATA[
			SELECT 
			   new br.com.sicoob.capes.negocio.entidades.GrupoEconomico(
			       g.idGrupoEconomico,			       
			       g.descricao
			)
			FROM br.com.sicoob.capes.negocio.entidades.GrupoEconomico g
			WHERE 1=1
			    AND g.idInstituicao = <bancoob:valorOql valor="${idInstituicao}" tipo="Integer" />
			    AND g.dataHoraCadastro is not null
			]]>
		</command>
	</query>
	<query name="LISTAR_LOCALIDADE">
		<use-case name="Localidade" />
		<description>Listar localidade.</description>
		<command>
			<![CDATA[
			    SELECT municipio.idMunicipioRecor, municipio.descMunicipio, municipio.uf 
				FROM dbo.MunicipioRecor municipio
				WHERE 1=1 ORDER BY municipio.descMunicipio
			]]>
		</command>
	</query>
	<query name="UPDATE_LOTE_PESSOA_INSTITUICAO_CPFCNPJ">
		<use-case name="ATUALIZA UPDATE_LOTE_PESSOA_INSTITUICAO"></use-case>
		<description>Update na PessoaInstituicao</description>
		<command>
			<![CDATA[
				UPDATE 
					CLI.PESSOAINSTITUICAO pi
				SET 
					pi.IDUNIDADEINST = ? ,
					pi.IDFUNCIONARIORESPONSAVEL = ?,
					pi.IDUSUARIOAPROV = ?,
					pi.IDNUCLEO = ?
				WHERE 
					pi.idPessoaInstituicao = ?
			]]>
		</command>
	</query>
	<query name="UPDATE_LOTE_PESSOA_INSTITUICAO">
		<use-case name="ATUALIZA UPDATE_LOTE_PESSOA_INSTITUICAO"></use-case>
		<description>Update na PessoaInstituicao</description>
		<command>
			<![CDATA[
				UPDATE 
					CLI.PESSOAINSTITUICAO pi
				SET 
					pi.IDUNIDADEINST = ? ,
					pi.IDFUNCIONARIORESPONSAVEL = ?,
					pi.IDUSUARIOAPROV = ? 
				WHERE 
					pi.idPessoaInstituicao = ?
			]]>
		</command>
	</query>
	<query name="UPDATE_LOTE_PESSOA_NUCLEO">
		<use-case name="UPDATE_LOTE_PESSOA_NUCLEO"></use-case>
		<description>Update na PessoaInstituicao nucleo</description>
		<command>
			<![CDATA[
				UPDATE 
					CLI.PESSOAINSTITUICAO pi
				SET 
					pi.IDNUCLEO = ?,
					pi.IDUSUARIOAPROV = ?
				WHERE 
					pi.idPessoaInstituicao = ?
			]]>
		</command>
	</query>
	<query name="GERAR_HISTORICO_PESSOA_INSTITUICAO">
		<use-case name="GERAR_HISTORICO_PESSOA_INSTITUICAO"></use-case>
		<description>Inclusão de histPessoaInstituicao</description>
		<command>
			<![CDATA[
				INSERT INTO CLI.HISTPESSOAINSTITUICAO
				 (IDPESSOA,
				  IDINSTITUICAO,
				  IDUNIDADEINST,
				  IDFUNCIONARIORESPONSAVEL,
				  CODPERFILTARIFARIO,
				  DESCPARECERGERENCIA,
				  BOLEMITEAVISOLANCAMENTO,
				  DATAHORAINICIO,
				  DATAHORAFIM,
				  IDNUCLEO,
				  IDPESSOAINSTITUICAO,
				  IDUSUARIOAPROV,
				  IDUSUARIOEXCL,
				  DATACADASTRO
				 )
				 SELECT DISTINCT 
							 IDPESSOA,
							 IDINSTITUICAO,
							 IDUNIDADEINST,
							 IDFUNCIONARIORESPONSAVEL,
							 CODPERFILTARIFARIO,
							 DESCPARECERGERENCIA,
							 BOLEMITEAVISOLANCAMENTO,
							 DATAHORAINICIO,
							 CURRENT TIMESTAMP,
							 IDNUCLEO,
							 IDPESSOAINSTITUICAO,
							 IDUSUARIOAPROV,
							 ?,
							 DATACADASTRO
				  FROM CLI.PESSOAINSTITUICAO RP
				  WHERE 
					RP.IDPESSOAINSTITUICAO = ? 
			]]>
		</command>
	</query>
	<query name="UPDATE_TRANSICAO_PESSOA">
		<use-case name="ATUALIZA UPDATE_TRANSICAO_PESSOA"></use-case>
		<description>Update na TransicaoPessoa</description>
		<command>
			<![CDATA[
				MERGE INTO CLI.TRANSICAOPESSOA E USING (
			        
					SELECT  TP.IDTRANSICAOPESSOA, PI.IDUNIDADEINST
					FROM CLI.PESSOAINSTITUICAO PI
							INNER JOIN CLI.PESSOACOMPARTILHAMENTO PC                ON      PC.IDPESSOA                     = PI.IDPESSOA
							INNER JOIN CLI.TRANSICAOPESSOA TP                       ON      TP.IDPESSOACOMPARTILHAMENTO     = PC.IDPESSOACOMPARTILHAMENTO
																					AND     TP.IDINSTITUICAO                = PI.IDINSTITUICAO
					WHERE 
					PI.IDUNIDADEINST &lt;&gt; TP.IDUNIDADEINST
					
			        
			) R ON  E.IDTRANSICAOPESSOA = R.IDTRANSICAOPESSOA
			WHEN MATCHED THEN 
			        UPDATE  SET     E.IDUNIDADEINST = R.IDUNIDADEINST
			]]>
		</command>
	</query>
</queries>